<?xml version="1.0" encoding="UTF-8"?>
<Settings xmlns="http://v8.1c.ru/8.3/config/merge/settings" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.2" platformVersion="8.3.11">
	<MainConfiguration>
		<Name>УправлениеПредприятием</Name>
		<Version>2.4.13.103</Version>
		<Vendor>Фирма "1С"</Vendor>
	</MainConfiguration>
	<SecondConfiguration>
		<Name>УправлениеПредприятием</Name>
		<Version>2.4.13.103</Version>
		<Vendor>Фирма "1С"</Vendor>
	</SecondConfiguration>
	<Parameters>
		<ConfigurationsRelation>ConfigurationsNotRelated</ConfigurationsRelation>
		<AllowMainConfigurationObjectDeletion>false</AllowMainConfigurationObjectDeletion>
		<CopyObjectsMode>false</CopyObjectsMode>
	</Parameters>
	<Objects>
		<Object fullName="CommonModule.Рубэг_ДавальческаяСхема">
			<Properties>
				<Property name="Module">
					<MergeRule>GetFromSecondConfiguration</MergeRule>
					<Module>
						<Methods>
							<MainArea>
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</MainArea>
							<Method name="ЗаполнитьЦеныПоВидуЦенСервер" nameInSecondConfiguration="ЗаполнитьЦеныПоВидуЦенСервер">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="КоличествоВыпускаПоЗаказуПереработчика" nameInSecondConfiguration="КоличествоВыпускаПоЗаказуПереработчика">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ОбработатьЗавершениеЗадания" nameInSecondConfiguration="ОбработатьЗавершениеЗадания">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПараметрыПересчетаСуммыНДСВТЧ" nameInSecondConfiguration="ПараметрыПересчетаСуммыНДСВТЧ">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПолучитьНазначениеПоЗаказуДавальца" nameInSecondConfiguration="ПолучитьНазначениеПоЗаказуДавальца">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПолучитьНазначениеПоЗаказуПокупателя" nameInSecondConfiguration="ПолучитьНазначениеПоЗаказуПокупателя">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПолучитьНастройкиДавальческойСхемы" nameInSecondConfiguration="ПолучитьНастройкиДавальческойСхемы">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПолучитьСериюПересчет" nameInSecondConfiguration="ПолучитьСериюПересчет">
								<MergeRule>DoNotMerge</MergeRule>
								<Patch/>
							</Method>
							<Method name="ПолучитьСобственнуюОрганизациюПоПартнеру" nameInSecondConfiguration="ПолучитьСобственнуюОрганизациюПоПартнеру">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПолучитьСтоимостьУслугиПоПереработке" nameInSecondConfiguration="ПолучитьСтоимостьУслугиПоПереработке">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПолучитьЦеныЗакупки" nameInSecondConfiguration="ПолучитьЦеныЗакупки">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПредварительнаяСебестоимостьНоменклатуры" nameInSecondConfiguration="ПредварительнаяСебестоимостьНоменклатуры">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="РазузловатьМатериалыПоЭтапам" nameInSecondConfiguration="РазузловатьМатериалыПоЭтапам">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="СтоимостьАктаПереработчика" nameInSecondConfiguration="СтоимостьАктаПереработчика">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="СтоимостьАктаПереработчикаПоАнкете" nameInSecondConfiguration="СтоимостьАктаПереработчикаПоАнкете">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ДобавитьСтрокуОприходования">
								<MergeRule>DoNotMerge</MergeRule>
							</Method>
							<Method name="ЗаполнитьНазначениеВЗаказеНаПроизводствоПоЗаказуДавальца" nameInSecondConfiguration="ЗаполнитьНазначениеВЗаказеНаПроизводствоПоЗаказуДавальца">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ЗаполнитьЦеныОприходованиеТоваров" nameInSecondConfiguration="ЗаполнитьЦеныОприходованиеТоваров">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ОбработатьЦепочкуСформированныхДокументовПоПересчету" nameInSecondConfiguration="ОбработатьЦепочкуСформированныхДокументовПоПересчету">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ОтменитьВсеРанееСозданныеДокументыВыпускаПоПересчету">
								<MergeRule>DoNotMerge</MergeRule>
							</Method>
							<Method name="ОтменитьВсеРанееСозданныеДокументыВыпускаСырьяИзЗаготовок">
								<MergeRule>DoNotMerge</MergeRule>
							</Method>
							<Method name="ОтменитьПроведениеДокумента" nameInSecondConfiguration="ОтменитьПроведениеДокумента">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ОтменитьЦепочкуСформированныхДокументовПоПересчету" nameInSecondConfiguration="ОтменитьЦепочкуСформированныхДокументовПоПересчету">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПередЗаписьюСвязанныеДокументы" nameInSecondConfiguration="ПередЗаписьюСвязанныеДокументы">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПриЗаписиВозвратаДавальцу" nameInSecondConfiguration="ПриЗаписиВозвратаДавальцу">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПриЗаписиПеремещениеПоДавальческойСхеме" nameInSecondConfiguration="ПриЗаписиПеремещениеПоДавальческойСхеме">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПроведениеОтменаДокументаПоИсточнику" nameInSecondConfiguration="ПроведениеОтменаДокументаПоИсточнику">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="РазузловатьСтрокуМатериала" nameInSecondConfiguration="РазузловатьСтрокуМатериала">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="РасчитатьЦеныВДокументеПоСебестоимости" nameInSecondConfiguration="РасчитатьЦеныВДокументеПоСебестоимости">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="Рубэг_ЗаписатьЦеныВПередачуСырьяПередЗаписьюПередЗаписью" nameInSecondConfiguration="Рубэг_ЗаписатьЦеныВПередачуСырьяПередЗаписьюПередЗаписью">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="СкорректироватьОтчетПереработчикаПоВедомостиКроя" nameInSecondConfiguration="СкорректироватьОтчетПереработчикаПоВедомостиКроя">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="СформироватьВозвратСырьяДавальцу" nameInSecondConfiguration="СформироватьВозвратСырьяДавальцу">
								<MergeRule>DoNotMerge</MergeRule>
								<Patch/>
							</Method>
							<Method name="СформироватьВозвратСырьяОтПереработчика" nameInSecondConfiguration="СформироватьВозвратСырьяОтПереработчика">
								<MergeRule>DoNotMerge</MergeRule>
								<Patch/>
							</Method>
							<Method name="СформироватьВыпускПФИзСырья">
								<MergeRule>DoNotMerge</MergeRule>
							</Method>
							<Method name="СформироватьВыпускСырьяИзЗаготовок" nameInSecondConfiguration="СформироватьВыпускСырьяИзЗаготовок">
								<MergeRule>DoNotMerge</MergeRule>
								<Patch/>
							</Method>
							<Method name="СформироватьДокументыПередачиПриемкиВПереработку" nameInSecondConfiguration="СформироватьДокументыПередачиПриемкиВПереработку">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="СформироватьЗаказДавальца" nameInSecondConfiguration="СформироватьЗаказДавальца">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="СформироватьЗаказНаПроизводство" nameInSecondConfiguration="СформироватьЗаказНаПроизводство">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
								<Patch>@@ -103,7 +103,8 @@
 			Док.Дата,
 			Док.Подразделение,
 			УправлениеДаннымиОбИзделиях.ПараметрыВыбораСпецификаций(Док, Документы.ЗаказНаПроизводство2_2),
-			СтрокаПродукция.Спецификация);
+			//СтрокаПродукция.Спецификация);
+			Док.Рубэг_Анкета.ПроизводственнаяСпецификация);
 	
 	Если ЗаказПереработчику &lt;&gt; Неопределено И ЗначениеЗаполнено(ДанныеСпецификации) Тогда	
 		ЗаполнитьЗначенияСвойств(СтрокаПродукция, ДанныеСпецификации);	
</Patch>
							</Method>
							<Method name="СформироватьОприходованиеТоваров" nameInSecondConfiguration="СформироватьОприходованиеТоваров">
								<MergeRule>DoNotMerge</MergeRule>
								<Patch/>
							</Method>
							<Method name="СформироватьОтчетДавальцу" nameInSecondConfiguration="СформироватьОтчетДавальцу">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="СформироватьОтчетПереработчика" nameInSecondConfiguration="СформироватьОтчетПереработчика">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="СформироватьПередачуВКладовую" nameInSecondConfiguration="СформироватьПередачуВКладовую">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="СформироватьПередачуВПереработку" nameInSecondConfiguration="СформироватьПередачуВПереработку">
								<MergeRule>DoNotMerge</MergeRule>
								<Patch/>
							</Method>
							<Method name="СформироватьПередачуДавальцу" nameInSecondConfiguration="СформироватьПередачуДавальцу">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="СформироватьПередачуСтороннемуПереработчику" nameInSecondConfiguration="СформироватьПередачуСтороннемуПереработчику">
								<MergeRule>DoNotMerge</MergeRule>
								<Patch/>
							</Method>
							<Method name="СформироватьПеремещениеТоваров" nameInSecondConfiguration="СформироватьПеремещениеТоваров">
								<MergeRule>DoNotMerge</MergeRule>
								<Patch/>
							</Method>
							<Method name="СформироватьПоступлениеОтПереработчика" nameInSecondConfiguration="СформироватьПоступлениеОтПереработчика">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="СформироватьПриемВПереработку" nameInSecondConfiguration="СформироватьПриемВПереработку">
								<MergeRule>DoNotMerge</MergeRule>
								<Patch/>
							</Method>
							<Method name="СформироватьРезультатПересчетаУДавальца" nameInSecondConfiguration="СформироватьРезультатПересчетаУДавальца">
								<MergeRule>DoNotMerge</MergeRule>
								<Patch/>
							</Method>
							<Method name="СформироватьСписаниеТоваров" nameInSecondConfiguration="СформироватьСписаниеТоваров">
								<MergeRule>DoNotMerge</MergeRule>
								<Patch/>
							</Method>
							<Method name="СформироватьЭтапыПроизводства" nameInSecondConfiguration="СформироватьЭтапыПроизводства">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<DirectiveArea name="АвтоматическоеФормированиеСвязанныхДокументов" nameInSecondConfiguration="АвтоматическоеФормированиеСвязанныхДокументов">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</DirectiveArea>
							<DirectiveArea name="ФормированиеОтчетовПереработчика" nameInSecondConfiguration="ФормированиеОтчетовПереработчика">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</DirectiveArea>
							<DirectiveArea name="ОбщиеФункции" nameInSecondConfiguration="ОбщиеФункции">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</DirectiveArea>
							<DirectiveArea name="ПересчетТоваров" nameInSecondConfiguration="ПересчетТоваров">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</DirectiveArea>
							<DirectiveArea name="ФормированиеЭтапов" nameInSecondConfiguration="ФормированиеЭтапов">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</DirectiveArea>
							<DirectiveArea name="ПередачаВОскол" nameInSecondConfiguration="ПередачаВОскол">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</DirectiveArea>
						</Methods>
					</Module>
				</Property>
			</Properties>
		</Object>
		<Object fullName="Document.ПриобретениеТоваровУслуг">
			<Properties>
				<Property name="RegisterRecords">
					<MergeRule>DoNotMerge</MergeRule>
				</Property>
			</Properties>
		</Object>
		<Object fullName="Document.ПриобретениеУслугПрочихАктивов">
			<Properties>
				<Property name="RegisterRecords">
					<MergeRule>DoNotMerge</MergeRule>
				</Property>
			</Properties>
		</Object>
		<Object fullName="Document.Числа_НоваяАнкета">
			<Properties>
				<Property name="ObjectModule">
					<MergeRule>GetFromSecondConfiguration</MergeRule>
					<Module>
						<Methods>
							<VariableDeclarationArea>
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</VariableDeclarationArea>
							<MainArea>
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</MainArea>
							<Method name="ОбработкаПроведения" nameInSecondConfiguration="ОбработкаПроведения">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
								<Patch>@@ -19,7 +19,12 @@
 	Движение.Номенклатура 	  = Продукция; 
 	Движение.Характеристика	  = ХарактеристикаПродукции;
 	
-	Движение.Цена 		  	  = ?(ЗначениеЗаполнено(СредняяЦена), СредняяЦена, Цена);
+	Если ЗначениеЗаполнено(СпецификацияЗамены) Тогда
+		Движение.Цена = ЦенаСУчетомЗамен;
+	Иначе
+		Движение.Цена = ?(ЗначениеЗаполнено(СредняяЦена), СредняяЦена, Цена);
+	КонецЕсли;	
+	
     Движение.Валюта 		  = мВалюта;
 	Движение.Упаковка 		  = Справочники.УпаковкиЕдиницыИзмерения.ПустаяСсылка();
 	
</Patch>
							</Method>
							<Method name="ОбработкаПроверкиЗаполнения" nameInSecondConfiguration="ОбработкаПроверкиЗаполнения">
								<MergeRule>GetFromSecondConfiguration</MergeRule>
							</Method>
							<Method name="ПриКопировании" nameInSecondConfiguration="ПриКопировании">
								<MergeRule>DoNotMerge</MergeRule>
								<Patch/>
							</Method>
							<Method name="РассчитатьСебетоимостьПошива">
								<MergeRule>DoNotMerge</MergeRule>
							</Method>
						</Methods>
					</Module>
				</Property>
			</Properties>
		</Object>
		<Object fullName="Document.Числа_НоваяАнкета.Form.УправляемаяФормаДокумента">
			<Properties>
				<Property name="Form">
					<MergeRule>GetFromSecondConfiguration</MergeRule>
					<FormModule>
						<MergeRule>GetFromSecondConfiguration</MergeRule>
						<Module>
							<Methods>
								<VariableDeclarationArea>
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</VariableDeclarationArea>
								<MainArea>
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</MainArea>
								<Method name="АртикулНоменклатурыНаСервере" nameInSecondConfiguration="АртикулНоменклатурыНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="АртикулОбъектаНаСервере" nameInSecondConfiguration="АртикулОбъектаНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВидимостьВсехРодителейЭФ" nameInSecondConfiguration="ВидимостьВсехРодителейЭФ">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВсеРеквизитыЗаполнены" nameInSecondConfiguration="ВсеРеквизитыЗаполнены">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВыделенныйТекстЭлементовФормы" nameInSecondConfiguration="ВыделенныйТекстЭлементовФормы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДанныеФормыВДеревоЗначенийПоместитьВоВременноеХранилище">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,10 @@
 
+&amp;НаСервере
+Функция ДанныеФормыВДеревоЗначенийПоместитьВоВременноеХранилище(ИмяДанныхФормы)
+
+	ДеревоЗначение = РеквизитФормыВЗначение(ИмяДанныхФормы, Тип("ДеревоЗначений"));
+	АдресДерева    = ПоместитьВоВременноеХранилище(ДеревоЗначение, Новый УникальныйИдентификатор);
+	
+	Возврат АдресДерева;
+
+КонецФункции
</Patch>
								</Method>
								<Method name="ДляКомплектовкиКомлектующаяПриИзмененииНаСервере" nameInSecondConfiguration="ДляКомплектовкиКомлектующаяПриИзмененииНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЕстьОшибкаДиаметраКлапанаДляЗУХ">
									<MergeRule>DoNotMerge</MergeRule>
								</Method>
								<Method name="ЕстьПолуфабрикатыБезСпецификаций" nameInSecondConfiguration="ЕстьПолуфабрикатыБезСпецификаций">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЕстьРольПроведениеАнкеты" nameInSecondConfiguration="ЕстьРольПроведениеАнкеты">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗначениеРеквизитаОбъектаСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,7 @@
 
+&amp;НаСервереБезКонтекста
+Функция ЗначениеРеквизитаОбъектаСервер(СсылкаНаОбъект, ИмяРеквизита)
+
+	Возврат СсылкаНаОбъект[ИмяРеквизита];
+
+КонецФункции
</Patch>
								</Method>
								<Method name="МатериалыТехОперацииЗаготовкиЛоготипа" nameInSecondConfiguration="МатериалыТехОперацииЗаготовкиЛоготипа">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="НитиДляСтроп" nameInSecondConfiguration="НитиДляСтроп">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,15 +1,4 @@
 
-// &lt;Описание функции&gt;
-//
-// Параметры:
-//  &lt;Параметр1&gt;  - &lt;Тип.Вид&gt; - &lt;описание параметра&gt;
-//                 &lt;продолжение описания параметра&gt;
-//  &lt;Параметр2&gt;  - &lt;Тип.Вид&gt; - &lt;описание параметра&gt;
-//                 &lt;продолжение описания параметра&gt;
-//
-// Возвращаемое значение:
-//   &lt;Тип.Вид&gt;   - &lt;описание возвращаемого значения&gt;
-//
 &amp;НаСервере
 Функция НитиДляСтроп()
 
</Patch>
								</Method>
								<Method name="ОсновнаяСпецификацияПроизводствоВоронеж">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,29 @@
 
+&amp;НаСервере
+Функция ОсновнаяСпецификацияПроизводствоВоронеж(Номенклатура)
+
+	Запрос = Новый Запрос;
+	Запрос.Текст = 
+	"ВЫБРАТЬ
+	|	ОсновныеСпецификации.Спецификация КАК Спецификация
+	|ИЗ
+	|	РегистрСведений.ОсновныеСпецификации КАК ОсновныеСпецификации
+	|ГДЕ
+	|	ОсновныеСпецификации.Номенклатура = &amp;Номенклатура
+	|	И (ОсновныеСпецификации.Подразделение = &amp;Подразделение
+	|			ИЛИ ОсновныеСпецификации.Подразделение = ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка))
+	|	И ОсновныеСпецификации.Спецификация.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСпецификаций.Действует)";
+	Запрос.УстановитьПараметр("Номенклатура", Номенклатура);
+	Запрос.УстановитьПараметр("Подразделение", Справочники.Рубэг_Настройки.ПодразделениеПроизводствоВоронеж.ЗначениеНастройки);
+	
+	Выборка = Запрос.Выполнить().Выбрать();
+	Если Не Выборка.Следующий() Тогда
+		Сообщение = Новый СообщениеПользователю;
+		Сообщение.Текст = "Не найдено спецификции у указанного полуфабриката!";
+		Сообщение.Сообщить();
+		Возврат Неопределено;
+	КонецЕсли;	
+	
+	Возврат Выборка.Спецификация;
+
+КонецФункции
</Patch>
								</Method>
								<Method name="ПараметрыДереваСпецификаций">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,23 @@
 
+&amp;НаСервере
+Функция ПараметрыДереваСпецификаций(Номенклатура, Спецификация)
+	
+	ПараметрыДерева = УправлениеДаннымиОбИзделияхКлиентСервер.ПараметрыДереваСпецификаций();
+	
+	ПараметрыДерева.Номенклатура = Номенклатура;
+	//ПараметрыДерева.ХарактеристикаНоменклатуры = ДеревоХарактеристикаНоменклатуры;
+	
+	ПараметрыДерева.Спецификация = Спецификация;
+	ПараметрыДерева.Дата = Объект.Дата;
+	
+	ПараметрыДерева.ВыводитьЭтапы 				 = Ложь;
+	ПараметрыДерева.ВыводитьВыходныеИзделия 	 = Истина;
+	ПараметрыДерева.ВыводитьМатериалы 			 = Истина;
+	ПараметрыДерева.ВыводитьТрудозатраты 		 = Истина;
+	ПараметрыДерева.ВыводитьЗаголовкиГруппировок = Истина;
+	ПараметрыДерева.ДинамическоеСчитывание 		 = Ложь;
+	ПараметрыДерева.РазузловыватьПолуфабрикаты 	 = Истина;
+	
+	Возврат ПараметрыДерева;
+	
+КонецФункции
</Patch>
								</Method>
								<Method name="ПодобраныНеВсеМатериалыИРаботы" nameInSecondConfiguration="ПодобраныНеВсеМатериалыИРаботы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПолучитьАдресДереваУзлаВоВременноеХранилище" nameInSecondConfiguration="ПолучитьАдресДереваУзлаВоВременноеХранилище">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПолучитьГруппуПродукции" nameInSecondConfiguration="ПолучитьГруппуПродукции">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПолучитьДеревоСпецификацииДляРазузлования">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,36 @@
 
+&amp;НаСервере
+Функция ПолучитьДеревоСпецификацииДляРазузлования()
+
+	Дерево = Новый ДеревоЗначений;
+	
+	ОПНоменклатура = Новый Массив;
+	ОПНоменклатура.Добавить(Тип("СправочникСсылка.Номенклатура"));
+	ОПНоменклатура.Добавить(Тип("СправочникСсылка.ВидыРаботСотрудников"));
+	ОПНоменклатура.Добавить(Тип("Строка"));
+	Дерево.Колонки.Добавить("Номенклатура", Новый ОписаниеТипов(ОПНоменклатура));
+	
+	ОПСпецификция = Новый Массив;
+	ОПСпецификция.Добавить(Тип("СправочникСсылка.РесурсныеСпецификации"));
+	ОПСпецификция.Добавить(Тип("СправочникСсылка.МаршрутныеКарты"));
+	Дерево.Колонки.Добавить("Спецификация", Новый ОписаниеТипов(ОПСпецификция));
+	
+	Дерево.Колонки.Добавить("Количество", Новый ОписаниеТипов("Число"));
+	Дерево.Колонки.Добавить("Характеристика", Новый ОписаниеТипов("СправочникСсылка.ХарактеристикиНоменклатуры"));
+	Дерево.Колонки.Добавить("ВидСтроки", Новый ОписаниеТипов("ПеречислениеСсылка.ВидыСтрокДереваСпецификаций"));
+	Дерево.Колонки.Добавить("Идентификатор", Новый ОписаниеТипов("УникальныйИдентификатор"));
+	Дерево.Колонки.Добавить("ЕдиницаИзмерения", Новый ОписаниеТипов("СправочникСсылка.УпаковкиЕдиницыИзмерения"));
+	Дерево.Колонки.Добавить("ИндексКартинки", Новый ОписаниеТипов("Число"));
+	Дерево.Колонки.Добавить("ПроизводитсяВПроцессе", Новый ОписаниеТипов("Булево"));
+	Дерево.Колонки.Добавить("ПрименениеМатериалаРедактирование", Новый ОписаниеТипов("Строка"));
+	Дерево.Колонки.Добавить("ХарактеристикиИспользуются", Новый ОписаниеТипов("Булево"));
+	Дерево.Колонки.Добавить("СпособАвтовыбораНоменклатуры", Новый ОписаниеТипов("ПеречислениеСсылка.СпособыАвтовыбораНоменклатуры"));
+	Дерево.Колонки.Добавить("СпособАвтовыбораХарактеристики", Новый ОписаниеТипов("ПеречислениеСсылка.СпособыАвтовыбораХарактеристики"));
+	Дерево.Колонки.Добавить("КоличествоУпаковок", Новый ОписаниеТипов("Число"));
+	Дерево.Колонки.Добавить("Упаковка", Новый ОписаниеТипов("СправочникСсылка.УпаковкиЕдиницыИзмерения"));
+	Дерево.Колонки.Добавить("ЕстьСпецификация", Новый ОписаниеТипов("Булево"));
+	Дерево.Колонки.Добавить("СпецификацияПрочитана", Новый ОписаниеТипов("Булево"));
+	
+	Возврат Дерево;
+
+КонецФункции
</Patch>
								</Method>
								<Method name="ПолучитьДеревоУзла" nameInSecondConfiguration="ПолучитьДеревоУзла">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПолучитьСтруктуруРеквизитовТекущегоДокумента" nameInSecondConfiguration="ПолучитьСтруктуруРеквизитовТекущегоДокумента">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -11,6 +11,7 @@
 	КонецЦикла;
 	
 	Структура.Вставить("Дата", Объект.Дата);
+	Структура.Вставить("Продукция", Объект.Продукция);
 	Структура.Вставить("СписокТехМатериалов", ПоместитьВоВременноеХранилище(Объект.СписокТехМатериалов.Выгрузить(),Новый УникальныйИдентификатор));
 	Структура.Вставить("СписокТехОпераций", ПоместитьВоВременноеХранилище(Объект.СписокТехОпераций.Выгрузить(), Новый УникальныйИдентификатор));
 	Структура.Вставить("СписокМатериаловЗамены", ПоместитьВоВременноеХранилище(Объект.СписокМатериаловЗамены.Выгрузить(), Новый УникальныйИдентификатор));
</Patch>
								</Method>
								<Method name="ПоместитьВоВременноеХранилищеДеревоАналогов" nameInSecondConfiguration="ПоместитьВоВременноеХранилищеДеревоАналогов">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПоместитьВоВременноеХранилищеДеревоПроизводство" nameInSecondConfiguration="ПоместитьВоВременноеХранилищеДеревоПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПоместитьВоВременоеХранилищеДеревоМатериаловЗамен" nameInSecondConfiguration="ПоместитьВоВременоеХранилищеДеревоМатериаловЗамен">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -8,6 +8,9 @@
 	
 	ДокументОбъект = РеквизитФормыВЗначение("Объект");
 	ДеревоЗначение = ДокументОбъект.МатериалыЗаменХранилище.Получить();
+	Если ДеревоЗначение = Неопределено Тогда
+		ДеревоЗначение = РеквизитФормыВЗначение("ДеревоМатериаловv11", Тип("ДеревоЗначений"));
+	КонецЕсли;	
 	АдресДерева = ПоместитьВоВременноеХранилище(ДеревоЗначение, Новый УникальныйИдентификатор);
 	
 	Возврат АдресДерева;
</Patch>
								</Method>
								<Method name="ПоместитьВоВременоеХранилищеДеревоРаботЗамен" nameInSecondConfiguration="ПоместитьВоВременоеХранилищеДеревоРаботЗамен">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -8,6 +8,9 @@
 	
 	ДокументОбъект = РеквизитФормыВЗначение("Объект");
 	ДеревоЗначение = ДокументОбъект.РаботыЗаменХранилище.Получить();
+	Если ДеревоЗначение = Неопределено Тогда
+		ДеревоЗначение = РеквизитФормыВЗначение("ДеревоВидовРаботv11", Тип("ДеревоЗначений"));
+	КонецЕсли;	
 	АдресДерева = ПоместитьВоВременноеХранилище(ДеревоЗначение, Новый УникальныйИдентификатор);
 	
 	Возврат АдресДерева;
</Patch>
								</Method>
								<Method name="ПоместитьВХранилищеСтруктуруПолуфабриката" nameInSecondConfiguration="ПоместитьВХранилищеСтруктуруПолуфабриката">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -10,12 +10,15 @@
 	СтруктураПолуфабриката.Колонки.Добавить("ИмяТабЧастиСпецификации");
 	СтруктураПолуфабриката.Колонки.Добавить("НоменклатураРабота");
 	СтруктураПолуфабриката.Колонки.Добавить("Количество");
+	СтруктураПолуфабриката.Колонки.Добавить("КоличествоНаПартию");
 	СтруктураПолуфабриката.Колонки.Добавить("СпособПолученияМатериала");
 	СтруктураПолуфабриката.Колонки.Добавить("ВидСтроки");
 	СтруктураПолуфабриката.Колонки.Добавить("ЧастьБЭГА");
 	СтруктураПолуфабриката.Колонки.Добавить("ПорядокЧастьБЭГА");
 	СтруктураПолуфабриката.Колонки.Добавить("ПорядокРукавПолотно", Новый ОписаниеТипов("Число"));
 	СтруктураПолуфабриката.Колонки.Добавить("ЗУ");
+	СтруктураПолуфабриката.Колонки.Добавить("ИдентификаторСтроки");
+	СтруктураПолуфабриката.Колонки.Добавить("ТаблицаИсключений");
 	
 	ДанныеСтроки = ДеревоПроизводство.НайтиПоИдентификатору(ТекущаяСтрока);
 	Для каждого СтрокаДерева Из ДанныеСтроки.ПолучитьЭлементы() Цикл
@@ -26,9 +29,11 @@
 			СтрокаСтруктуры.ИмяТабЧастиСпецификации	 = "МатериалыИУслуги";
 			СтрокаСтруктуры.НоменклатураРабота 	     = СтрокаДерева.ВыходноеИзделие;
 			СтрокаСтруктуры.Количество		   		 = СтрокаДерева.Количество;
+			СтрокаСтруктуры.КоличествоНаПартию 		 = СтрокаДерева.КоличествоНаПартию;
 			СтрокаСтруктуры.СпособПолученияМатериала = Перечисления.СпособыПолученияМатериаловВСпецификации.Обеспечивать;
 			СтрокаСтруктуры.ВидСтроки		   		 = СтрокаДерева.ВидСтроки;
 			СтрокаСтруктуры.ЧастьБЭГА		   		 = СтрокаДерева.ЧастьБЭГА;
+			СтрокаСтруктуры.ИдентификаторСтроки		 = СтрокаДерева.ПолучитьИдентификатор();
 			Если СтрокаДерева.ЧастьБЭГА.Наименование = "Верх" Тогда
 				СтрокаСтруктуры.ПорядокЧастьБЭГА = 2.1;
 			ИначеЕсли СтрокаДерева.ЧастьБЭГА.Наименование = "Низ" Тогда
@@ -72,9 +77,29 @@
 				СтрокаСтруктуры.ИмяТабЧастиСпецификации	 = "МатериалыИУслуги";
 				СтрокаСтруктуры.НоменклатураРабота 	     = СтрокаДерева_1.Этап;
 				СтрокаСтруктуры.Количество		   		 = СтрокаДерева_1.Количество;
+				СтрокаСтруктуры.КоличествоНаПартию  	 = СтрокаДерева_1.КоличествоНаПартию;
 				СтрокаСтруктуры.СпособПолученияМатериала = Перечисления.СпособыПолученияМатериаловВСпецификации.Обеспечивать;
 				СтрокаСтруктуры.ВидСтроки		   		 = СтрокаДерева_1.ВидСтроки;
 				СтрокаСтруктуры.ЧастьБЭГА				 = СтрокаДерева_1.ЧастьБЭГА;
+				СтрокаСтруктуры.ИдентификаторСтроки		 = СтрокаДерева_1.ПолучитьИдентификатор();
+				
+				СтрокиИсключений = СтрокаДерева_1.ПолучитьЭлементы();
+				Если СтрокиИсключений.Количество() Тогда
+					
+					СтрокаСтруктуры.ТаблицаИсключений = Новый ТаблицаЗначений;
+					СтрокаСтруктуры.ТаблицаИсключений.Колонки.Добавить("Заготовка");
+					СтрокаСтруктуры.ТаблицаИсключений.Колонки.Добавить("Количество");
+					СтрокаСтруктуры.ТаблицаИсключений.Колонки.Добавить("ИдентификаторСтроки");
+					
+					Для каждого СтрокаИсключений Из СтрокиИсключений Цикл
+						НоваяСтрока = СтрокаСтруктуры.ТаблицаИсключений.Добавить();
+						НоваяСтрока.Заготовка 			= СтрокаИсключений.Этап;
+						НоваяСтрока.Количество 		    = СтрокаИсключений.КоличествоНаПартию;
+						НоваяСтрока.ИдентификаторСтроки = СтрокаСтруктуры.ИдентификаторСтроки;
+					КонецЦикла;
+					
+				КонецЕсли;
+				
 			КонецЦикла;
 			
 		Иначе //Работы
@@ -85,8 +110,10 @@
 				СтрокаСтруктуры.ИмяТабЧастиСпецификации	 = "Трудозатраты";
 				СтрокаСтруктуры.НоменклатураРабота 	     = СтрокаДерева_1.Этап;
 				СтрокаСтруктуры.Количество		   		 = СтрокаДерева_1.Количество;
+				СтрокаСтруктуры.КоличествоНаПартию 		 = СтрокаДерева_1.КоличествоНаПартию;
 				СтрокаСтруктуры.ВидСтроки		   		 = СтрокаДерева_1.ВидСтроки;
 				СтрокаСтруктуры.ЧастьБЭГА				 = СтрокаДерева_1.ЧастьБЭГА;
+				СтрокаСтруктуры.ИдентификаторСтроки		 = СтрокаДерева_1.ПолучитьИдентификатор();
 				
 				Если СтрокаСтруктуры.НоменклатураРабота = ОперацияПокраска Тогда
 					ВидЗаготовки = "КрашеныйПолуфабрикат";	
</Patch>
								</Method>
								<Method name="ПорядокСортировкиРукавПолотно" nameInSecondConfiguration="ПорядокСортировкиРукавПолотно">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПроверитьАктуальностьЦен" nameInSecondConfiguration="ПроверитьАктуальностьЦен">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПроверитьДостаточностьМатериалов" nameInSecondConfiguration="ПроверитьДостаточностьМатериалов">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ПроверитьЗаполнениеРеквизитов" nameInSecondConfiguration="ПроверитьЗаполнениеРеквизитов">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -42,7 +42,7 @@
 				Продолжить;
 			КонецЕсли;	
 			
-			Если ЭлементФормы.Видимость И ТипЗнч(ЭлементФормы.Родитель) &lt;&gt; Тип("ТаблицаФормы") И ВидимостьВсехРодителейЭФ(ЭлементФормы.Родитель) И Не ЗначениеЗаполнено(Вычислить(ЭлементФормы.ПутьКДанным)) Тогда
+			Если ЭлементФормы.Видимость И ТипЗнч(ЭлементФормы.Родитель) &lt;&gt; Тип("ТаблицаФормы") И ЭлементФормы.Вид = ВидПоляФормы.ПолеВвода И ВидимостьВсехРодителейЭФ(ЭлементФормы.Родитель) И Не ЗначениеЗаполнено(Вычислить(ЭлементФормы.ПутьКДанным)) Тогда
 				
 				Попытка 
 					ЭлементФормы.АвтоОтметкаНезаполненного = Истина;
</Patch>
								</Method>
								<Method name="ПроверитьЗаполнениеСвояФункция" nameInSecondConfiguration="ПроверитьЗаполнениеСвояФункция">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПродукцияНайдена" nameInSecondConfiguration="ПродукцияНайдена">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РасценкаНаСервере" nameInSecondConfiguration="РасценкаНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РасчитатьДопРасходы" nameInSecondConfiguration="РасчитатьДопРасходы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -38,6 +38,8 @@
 	ИначеЕсли Объект.ПошивКомплектовка = "РасчетСтроп" Тогда
 		Массив.Добавить(Справочники.РУБЭГ_СтатьиРасходов.НайтиПоКоду("000000024"));
 		Запрос.УстановитьПараметр("Группа", Массив);
+	Иначе
+		Запрос.УстановитьПараметр("Группа", Неопределено);
 	КонецЕсли;	
 	Запрос.УстановитьПараметр("ПустойМассив", Массив.Количество() = 0);
 	Запрос.УстановитьПараметр("Период", Объект.Дата);
</Patch>
								</Method>
								<Method name="РасчитатьДопРасходыОскол" nameInSecondConfiguration="РасчитатьДопРасходыОскол">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="РасчитатьРасходПоФормуле" nameInSecondConfiguration="РасчитатьРасходПоФормуле">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -28,4 +28,4 @@
 
 	Возврат Результат;
 	
-КонецФункции // РасчитатьРасходПоФормуле(ФормулаРасчета)()
+КонецФункции
</Patch>
								</Method>
								<Method name="СписокВыбораЦветовКрасок" nameInSecondConfiguration="СписокВыбораЦветовКрасок">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СтруктураРеквизитовЭлементаБЭГа" nameInSecondConfiguration="СтруктураРеквизитовЭлементаБЭГа">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СуммыУзловПодчиненныхСтрок" nameInSecondConfiguration="СуммыУзловПодчиненныхСтрок">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ФормированиеИмениЗаготовкиЛоготипа" nameInSecondConfiguration="ФормированиеИмениЗаготовкиЛоготипа">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ФормированиеИмениПолуфабриката" nameInSecondConfiguration="ФормированиеИмениПолуфабриката">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЦеныУзловПодчиненныхСтрок" nameInSecondConfiguration="ЦеныУзловПодчиненныхСтрок">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЭлементПринадлежитРодителю" nameInSecondConfiguration="ЭлементПринадлежитРодителю">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="АнализПодборТехМатериала" nameInSecondConfiguration="АнализПодборТехМатериала">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="АнализПодборТехОперацииМатериала" nameInSecondConfiguration="АнализПодборТехОперацииМатериала">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -17,7 +17,8 @@
 			СтрокаТЧ = МассивСтрокТЧ[0];
 		Иначе
 			СтрокаТЧ = Объект[Выборка.ИмяТабЧасти].Добавить();
-			СтрокаТЧ.Объект = Выборка.Владелец;
+			СтрокаТЧ.Объект   = Выборка.Владелец;
+			СтрокаТЧ.ИдСтроки = Новый УникальныйИдентификатор;
 		КонецЕсли;	
 		
 		СтрокаТЧ.Количество = СтрокаТЧ.Количество + Количество;
@@ -48,6 +49,7 @@
 			Для каждого Элемент Из МассивДопРезультатов Цикл
 				СтрокаТЧ = Объект[Выборка.ИмяТабЧасти].Добавить();
 				СтрокаТЧ.Объект 	= Выборка.Владелец;
+				СтрокаТЧ.ИдСтроки   = Новый УникальныйИдентификатор;
 				СтрокаТЧ.Количество = Элемент;
 				Если ТипЗнч(Выборка.Владелец) = Тип("СправочникСсылка.ВидыРаботСотрудников") Тогда
 					СтрокаТЧ.Расценка = Выборка.РасценкаРабот;
</Patch>
								</Method>
								<Method name="АнализПодборТехОперацииМатериалаПоЭлементуБЭГа" nameInSecondConfiguration="АнализПодборТехОперацииМатериалаПоЭлементуБЭГа">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -17,6 +17,7 @@
 		Иначе
 			СтрокаТЧ = Объект[Выборка.ИмяТабЧасти].Добавить();
 			СтрокаТЧ.ЧастьБЭГА = Выборка.ЧастьБЭГА;
+			СтрокаТЧ.ИдСтроки  = Новый УникальныйИдентификатор;
 			
 			СтрокаТЧ.Объект 	 = Выборка.Владелец;
 		КонецЕсли;	
</Patch>
								</Method>
								<Method name="АнализПотребностей" nameInSecondConfiguration="АнализПотребностей">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="АнтистатическаяДобавкаПриИзменении" nameInSecondConfiguration="АнтистатическаяДобавкаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="АнтистатическаяНитьПриИзменении" nameInSecondConfiguration="АнтистатическаяНитьПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="БандажИзТканиТелоБЭГАПриИзменении" nameInSecondConfiguration="БандажИзТканиТелоБЭГАПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="БигБЭГСбандажемПриИзменении" nameInSecondConfiguration="БигБЭГСбандажемПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВариантПришиваЛенточныхСтропыПриИзменении" nameInSecondConfiguration="ВариантПришиваЛенточныхСтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВвестиЗамены" nameInSecondConfiguration="ВвестиЗамены">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -4,20 +4,22 @@
 
 	СтруктураТекущегоДокумента = ПолучитьСтруктуруРеквизитовТекущегоДокумента();
 	
-	АдресДерева		 = ПоместитьВоВременноеХранилищеДеревоПроизводство();
-	АдресДереваЗамен = ПоместитьВоВременноеХранилищеДеревоАналогов();
+	АдресДереваНормативного    = ПоместитьВоВременноеХранилищеДеревоПроизводство();
+	АдресДереваЗамен 		   = ПоместитьВоВременноеХранилищеДеревоАналогов();
 	АдресДереваМатериаловЗамен = ПоместитьВоВременоеХранилищеДеревоМатериаловЗамен();
 	АдресДереваРаботЗамен      = ПоместитьВоВременоеХранилищеДеревоРаботЗамен();
-	СтруктураТекущегоДокумента.Вставить("АдресДерева", АдресДерева);
-	СтруктураТекущегоДокумента.Вставить("АдресДереваАналогов", АдресДереваЗамен);
+	АдресДереваМатериалов      = ДанныеФормыВДеревоЗначенийПоместитьВоВременноеХранилище("ДеревоМатериаловv11");
+	АдресДереваРабот           = ДанныеФормыВДеревоЗначенийПоместитьВоВременноеХранилище("ДеревоВидовРаботv11");
 	
 	ПараметрыФормы = Новый Структура;
 	ПараметрыФормы.Вставить("РазметкаСтропы",Элементы.ДекорацияРазметкаСтропы.Заголовок);
-	ПараметрыФормы.Вставить("СтруктураТекущегоДокумента",СтруктураТекущегоДокумента);
-	ПараметрыФормы.Вставить("АдресДерева",АдресДерева);
-	ПараметрыФормы.Вставить("АдресДереваАналогов",АдресДереваЗамен);
-	ПараметрыФормы.Вставить("АдресДереваМатериаловЗамен",АдресДереваМатериаловЗамен);
-	ПараметрыФормы.Вставить("АдресДереваРаботЗамен",АдресДереваРаботЗамен);
+	ПараметрыФормы.Вставить("СтруктураТекущегоДокумента" ,СтруктураТекущегоДокумента);
+	ПараметрыФормы.Вставить("АдресДереваНормативного"    ,АдресДереваНормативного);
+	ПараметрыФормы.Вставить("АдресДереваЗамен"			 ,АдресДереваЗамен);
+	ПараметрыФормы.Вставить("АдресДереваМатериаловЗамен" ,АдресДереваМатериаловЗамен);
+	ПараметрыФормы.Вставить("АдресДереваРаботЗамен"		 ,АдресДереваРаботЗамен);
+	ПараметрыФормы.Вставить("АдресДереваМатериалов"		 ,АдресДереваМатериалов);
+	ПараметрыФормы.Вставить("АдресДереваРабот"			 ,АдресДереваРабот);
 	
 	ОткрытьФорму("Документ.Числа_НоваяАнкета.Форма.ФормаАналогов",ПараметрыФормы,ЭтаФорма,,,,Новый ОписаниеОповещения("ЗакрытиеФормыПодбораАналогов",ЭтаФорма),РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
 	
</Patch>
								</Method>
								<Method name="ВводНаименованияУзлаЗавершение" nameInSecondConfiguration="ВводНаименованияУзлаЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВидПошиваПриИзменении" nameInSecondConfiguration="ВидПошиваПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВидСтропСтрокойНачалоВыбора" nameInSecondConfiguration="ВидСтропСтрокойНачалоВыбора">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВидСтропСтрокойПриИзменении" nameInSecondConfiguration="ВидСтропСтрокойПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВидыСтропНачалоВыбора" nameInSecondConfiguration="ВидыСтропНачалоВыбора">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВкладышВшитКомплектовкаПриИзменении" nameInSecondConfiguration="ВкладышВшитКомплектовкаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВкладышРаздутКомплектовкаПриИзменении" nameInSecondConfiguration="ВкладышРаздутКомплектовкаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВопросЗаписатьДокументПередВводомЗамены" nameInSecondConfiguration="ВопросЗаписатьДокументПередВводомЗамены">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВопросЗаполнитьТехМатериалыЗавершение" nameInSecondConfiguration="ВопросЗаполнитьТехМатериалыЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -3,10 +3,15 @@
 Процедура ВопросЗаполнитьТехМатериалыЗавершение(Результат, ДопПараметры) Экспорт
 
 	Если Результат = КодВозвратаДиалога.Да Тогда
-		Объект.СписокТехМатериалов.Очистить();
 		
-		ЗаполнитьТехОперацииМатериалы("Номенклатура", ВыделенныйТекстЭлементовФормы());
-		ЗаполнитьТехМатериалыДерево("");
+		Если Объект.ПошивКомплектовка = "Доработка" Тогда
+			ЗаполнитьМатериалыУпаковкиДляДоработки(ВыделенныйТекстЭлементовФормы());
+			РаскрытьДеревоТехМатериалов();
+		Иначе
+			Объект.СписокТехМатериалов.Очистить();
+			ЗаполнитьТехОперацииМатериалы("Номенклатура", ВыделенныйТекстЭлементовФормы());
+			ЗаполнитьТехМатериалыДерево("");
+		КонецЕсли;
 	КонецЕсли;	
 
 КонецПроцедуры // ВопросЗаполнитьТехОперацииЗавершение()
</Patch>
								</Method>
								<Method name="ВопросЗаполнитьТехОперацииЗавершение" nameInSecondConfiguration="ВопросЗаполнитьТехОперацииЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВопросСоздатьПродукциюЗавершение" nameInSecondConfiguration="ВопросСоздатьПродукциюЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВопросУказанияСпецификацииДляПроизводстваЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,13 @@
 
+&amp;НаКлиенте
+Процедура ВопросУказанияСпецификацииДляПроизводстваЗавершение(Результат, ДопПараметры) Экспорт
+
+	Если Результат = КодВозвратаДиалога.Да Тогда
+		Объект.ПроизводственнаяСпецификация = Объект.СпецификацияЗамены;
+	Иначе
+		Объект.ПроизводственнаяСпецификация = Объект.Спецификация;
+	КонецЕсли;	
+	
+	ЗаписатьПроизводственнуюСпецификациюНаСервере();
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ВыборГотовойПродукцииЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,15 @@
 
+&amp;НаКлиенте
+Процедура ВыборГотовойПродукцииЗавершение(Результат, ДопПараметры) Экспорт
+
+	Если ТипЗнч(Результат) = Тип("СправочникСсылка.Номенклатура") Тогда
+		ПараметрыФормы = Новый Структура;
+		ПараметрыФормы.Вставить("Номенклатура", Результат);
+		ПараметрыФормы.Вставить("ПараметрВладелец", ЗначениеРеквизитаОбъектаСервер(Результат,"ВидНоменклатуры"));
+		ОткрытьФорму("Справочник.ХарактеристикиНоменклатуры.Форма.ФормаВыбора", ПараметрыФормы, ЭтаФорма,,,,Новый ОписаниеОповещения("ВыборХарактеристикиПоОстаткамЗавершение", ЭтаФорма, Результат));
+	Иначе
+		Объект.Продукция 			   = "";
+		Объект.ХарактеристикаПродукции = "";
+	КонецЕсли;	
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ВыборКомплектующейЗавершение">
									<MergeRule>DoNotMerge</MergeRule>
								</Method>
								<Method name="ВыборСписокВидовСтроп" nameInSecondConfiguration="ВыборСписокВидовСтроп">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВыборХарактеристикиПоОстаткамЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,15 @@
 
+&amp;НаКлиенте
+Процедура ВыборХарактеристикиПоОстаткамЗавершение(Результат, ДопПараметры) Экспорт
+	
+	Если ТипЗнч(Результат) = Тип("Структура") Тогда
+		Объект.Продукция 			   = ДопПараметры;
+		Объект.ХарактеристикаПродукции = Результат.Характеристика;
+		ЗаполнитьМатериалыУпаковкиДляДоработки(ВыделенныйТекстЭлементовФормы());
+		РаскрытьДеревоТехМатериалов();
+	Иначе
+		Объект.Продукция 			   = "";
+		Объект.ХарактеристикаПродукции = "";
+	КонецЕсли;	
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ВысотаВерхКлапанДругоеПриИзменении" nameInSecondConfiguration="ВысотаВерхКлапанДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВысотаВрехКлапанПриИзменении" nameInSecondConfiguration="ВысотаВрехКлапанПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВысотаНизДругоеПриИзменении" nameInSecondConfiguration="ВысотаНизДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВысотаНизПриИзменении" nameInSecondConfiguration="ВысотаНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВысотаОтпечаткаЛоготипПриИзменении" nameInSecondConfiguration="ВысотаОтпечаткаЛоготипПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВысотаПриИзменении" nameInSecondConfiguration="ВысотаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ГлубинаПриИзменении" nameInSecondConfiguration="ГлубинаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ГрузоподъемностьЛенточныеСтропыДругоеПриИзменении" nameInSecondConfiguration="ГрузоподъемностьЛенточныеСтропыДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ГрузоподъемностьЛенточныеСтропыПриИзменении" nameInSecondConfiguration="ГрузоподъемностьЛенточныеСтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ГрузоподъемностьСтропыПриИзменении" nameInSecondConfiguration="ГрузоподъемностьСтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ГруппаОсновноеПроизводствоПриСменеСтраницы" nameInSecondConfiguration="ГруппаОсновноеПроизводствоПриСменеСтраницы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДвойноеУплотнениеУШПриИзменении" nameInSecondConfiguration="ДвойноеУплотнениеУШПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДействияПриДефицитеЗавершение" nameInSecondConfiguration="ДействияПриДефицитеЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДекорацияОшибкаНажатие" nameInSecondConfiguration="ДекорацияОшибкаНажатие">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоВидовРаботВТабличнуюЧасть" nameInSecondConfiguration="ДеревоВидовРаботВТабличнуюЧасть">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоВыбратьУзел" nameInSecondConfiguration="ДеревоПроизводствоВыбратьУзел">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоКоличествоНаПартиюПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,16 @@
 
+&amp;НаКлиенте
+Процедура ДеревоПроизводствоКоличествоНаПартиюПриИзменении(Элемент)
+	
+	ДанныеСтроки = Элементы.ДеревоПроизводство.ТекущиеДанные;
+	Если ДанныеСтроки &lt;&gt; Неопределено И Объект.ПошивКомплектовка = "Доработка" Тогда
+		Коэффициент = ДанныеСтроки.КоличествоНаПартию/мКоличествоДоИзменения;
+		ПересчитатьПодчиненныеСтрокиДереваПроизводство(ДанныеСтроки.ПолучитьИдентификатор(), Коэффициент);
+		ТабличнаяЧастьВДеревоТехМатериалов("СписокТехМатериалов");
+		ТабличнаяЧастьВДеревоВидовРабот("СписокТехОпераций");
+		РаскрытьДеревоТехМатериалов();
+		РаскрытьДеревоВидоРабот();
+		ОтметитьПодбранныеМатериалыИРаботыСервер(ДеревоПроизводство.ПолучитьЭлементы()[0].ПолучитьИдентификатор());
+	КонецЕсли; 	
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ДеревоПроизводствоКоличествоПриИзменении" nameInSecondConfiguration="ДеревоПроизводствоКоличествоПриИзменении">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ДеревоПроизводствоНачалоПеретаскивания" nameInSecondConfiguration="ДеревоПроизводствоНачалоПеретаскивания">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоОбработкаВыбора" nameInSecondConfiguration="ДеревоПроизводствоОбработкаВыбора">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоПередНачаломДобавления" nameInSecondConfiguration="ДеревоПроизводствоПередНачаломДобавления">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоПередУдалением" nameInSecondConfiguration="ДеревоПроизводствоПередУдалением">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -2,26 +2,14 @@
 &amp;НаКлиенте
 Процедура ДеревоПроизводствоПередУдалением(Элемент, Отказ)
 	
-	УстановитьПризнакНеактуальностиУРодительскойСтроки(Элементы.ДеревоПроизводство.ТекущаяСтрока)
-	
-	//ДанныеСтроки = Элемент.ТекущиеДанные;
-	//Если ДанныеСтроки = Неопределено Тогда
-	//	Возврат;
-	//КонецЕсли;	
-	//
-	//ОбнулитьПодобранныеСтроки();
-	//ОтметитьПодбранныеМатериалыИРаботы(0);
+	Если Объект.ПошивКомплектовка = "Доработка" Тогда
+		ДанныеСтроки = Элементы.ДеревоПроизводство.ТекущиеДанные;
+		ИдСтроки = ДанныеСтроки.ПолучитьИдентификатор();
+		ОбработатьУдалениеВеткиДереваПроизводствоДляДоработки(ИдСтроки);
+		РаскрытьДеревоТехМатериалов();
+		РаскрытьДеревоВидоРабот();
+	КонецЕсли;	
 	
-	//Если Не ЗначениеЗаполнено(ДанныеСтроки.СтрокаИсточника) Тогда
-	//	Возврат;
-	//КонецЕсли;	
-	//
-	//Если ТипЗнч(Элемент.ТекущиеДанные.Этап) = Тип("СправочникСсылка.Номенклатура") Тогда
-	//	СтрокаДереваМатериалов = ДеревоМатериаловv11.НайтиПоИдентификатору(ДанныеСтроки.СтрокаИсточника);
-	//	СтрокаДереваМатериалов.КоличествоПодобрано = 0;
-	//ИначеЕсли ТипЗнч(Элемент.ТекущиеДанные.Этап) = Тип("СправочникСсылка.ВидыРаботСотрудников") Тогда
-	//	СтрокаДереваРабот = ДеревоВидовРаботv11.НайтиПоИдентификатору(ДанныеСтроки.СтрокаИсточника);
-	//	СтрокаДереваРабот.КоличествоПодобрано = 0;
-	//КонецЕсли;	
+	УстановитьПризнакНеактуальностиУРодительскойСтроки(Элементы.ДеревоПроизводство.ТекущаяСтрока)
 	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="ДеревоПроизводствоПеретаскивание" nameInSecondConfiguration="ДеревоПроизводствоПеретаскивание">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -30,12 +30,14 @@
 			СтрокиТекущейСтроки = СтрокаДереваПриемник.ПолучитьЭлементы();
 			
 			НоваяСтрокаДерева = СтрокиТекущейСтроки.Добавить();
-			НоваяСтрокаДерева.Артикул 	      = АртикулОбъектаНаСервере(Элемент.Объект);
-			НоваяСтрокаДерева.Этап 	 	      = Элемент.Объект;
-			НоваяСтрокаДерева.ВидСтроки       = "ДетальнаяЗапись";
-			НоваяСтрокаДерева.Количество      = Элемент.Количество;
-			НоваяСтрокаДерева.СтрокаИсточника = Элемент.ПолучитьИдентификатор();
-			НоваяСтрокаДерева.ЧастьБЭГА 	  = Элемент.ПолучитьРодителя().ЧастьБЭГА;
+			НоваяСтрокаДерева.Артикул 	      	 = АртикулОбъектаНаСервере(Элемент.Объект);
+			НоваяСтрокаДерева.Этап 	 	      	 = Элемент.Объект;
+			НоваяСтрокаДерева.ВидСтроки       	 = "ДетальнаяЗапись";
+			НоваяСтрокаДерева.Количество      	 = Элемент.Количество;
+			НоваяСтрокаДерева.КоличествоНаПартию = Элемент.Количество*Объект.Количество;
+			НоваяСтрокаДерева.СтрокаИсточника 	 = Элемент.ПолучитьИдентификатор();
+			НоваяСтрокаДерева.ЧастьБЭГА 	  	 = Элемент.ПолучитьРодителя().ЧастьБЭГА;
+			НоваяСтрокаДерева.ИдСтроки		  	 = Элемент.ИдСтроки;
 			
 			НоваяСтрокаДерева.ПолучитьРодителя().ПолучитьРодителя().ЧастьБЭГА = НоваяСтрокаДерева.ЧастьБЭГА;
 			
@@ -51,6 +53,4 @@
 	
 	КонецЦикла;
 	
-	ПересчитатьПодобранныеСтрокиВПроизводство();
-	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="ДеревоПроизводствоПослеУдаления" nameInSecondConfiguration="ДеревоПроизводствоПослеУдаления">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоПриАктивизацииСтроки" nameInSecondConfiguration="ДеревоПроизводствоПриАктивизацииСтроки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -7,12 +7,14 @@
 	КонецЕсли;	
 	
 	Элементы.ДеревоПроизводствоКонтекстноеМенюДобавитьРезанныйПолуфабрикат.Видимость 	= Элемент.ТекущиеДанные.ВидСтроки = "Полуфабрикат";
-	Элементы.ДеревоПроизводствоКнопка1.Видимость 									 	= Элемент.ТекущиеДанные.ВидСтроки = "Полуфабрикат";
+	Элементы.ДеревоПроизводствоДобавитьПолуфабрикат.Видимость 							= Элемент.ТекущиеДанные.ВидСтроки = "Полуфабрикат";
 	Элементы.ДеревоПроизводствоКонтекстноеМенюСоздатьГотовуюПродукцию.Видимость      	= Элемент.ТекущиеДанные.ВидСтроки = "Этап" И Не Объект.Ссылка.Пустая();
 	Элементы.ДеревоПроизводствоСоздатьГотовуюПродукцию.Видимость						= Элемент.ТекущиеДанные.ВидСтроки = "Этап" И Не Объект.Ссылка.Пустая();
-	Элементы.ДеревоПроизводствоКонтекстноеМенюКнопкаУдалить.Видимость				 	= Элемент.ТекущиеДанные.ВидСтроки &lt;&gt; "Этап" И Элемент.ТекущиеДанные.ВидСтроки &lt;&gt; "Материалы" И Элемент.ТекущиеДанные.ВидСтроки &lt;&gt; "Работы";
+	Элементы.ДеревоПроизводствоКонтекстноеМенюКнопкаУдалить.Видимость				 	= Элемент.ТекущиеДанные.ВидСтроки &lt;&gt; "Этап";
 	Элементы.ДеревоПроизводствоКонтекстноеМенюДеревоПроизводствоСохранитьУзел.Видимость = Элемент.ТекущиеДанные.ВидСтроки = "Полуфабрикат" Или Элемент.ТекущиеДанные.ВидСтроки = "Этап";
 	Элементы.ДеревоПроизводствоКонтекстноеМенюДеревоПроизводствоВыбратьУзел.Видимость	= Элемент.ТекущиеДанные.ВидСтроки = "Полуфабрикат" Или Элемент.ТекущиеДанные.ВидСтроки = "Этап";
 	Элементы.ДеревоПроизводствоКонтекстноеМенюДобавитьКрашеныйПолуфабрикат.Видимость	= Элемент.ТекущиеДанные.ВидСтроки = "Полуфабрикат";
+	Элементы.ДеревоПроизводствоПересоздатьПолуфабрикатДоработка.Видимость				= Элемент.ТекущиеДанные.ЭтоУзелДоработки И Объект.ПошивКомплектовка = "Доработка";
+	Элементы.ДеревоПроизводствоКонтекстноеМенюРазобратьПолуфабрикат.Видимость			= Элемент.ТекущиеДанные.ВидСтроки = "Полуфабрикат";
 	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="ДеревоПроизводствоПриИзменении" nameInSecondConfiguration="ДеревоПроизводствоПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоПриНачалеРедактирования">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,9 @@
 
+&amp;НаКлиенте
+Процедура ДеревоПроизводствоПриНачалеРедактирования(Элемент, НоваяСтрока, Копирование)
+	
+	Если Элемент.ТекущийЭлемент.Имя = "ДеревоПроизводствоКоличествоНаПартию" Тогда
+		мКоличествоДоИзменения = Элемент.ТекущиеДанные.КоличествоНаПартию;
+	КонецЕсли;	
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ДеревоПроизводствоПриСменеТекущегоРодителя" nameInSecondConfiguration="ДеревоПроизводствоПриСменеТекущегоРодителя">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоПроверенПриИзменении" nameInSecondConfiguration="ДеревоПроизводствоПроверенПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоПроверенПриИзмененииСервер" nameInSecondConfiguration="ДеревоПроизводствоПроверенПриИзмененииСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоПроверкаПеретаскивания" nameInSecondConfiguration="ДеревоПроизводствоПроверкаПеретаскивания">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоСохранитьУзел" nameInSecondConfiguration="ДеревоПроизводствоСохранитьУзел">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоСохранитьУзелНаСервере" nameInSecondConfiguration="ДеревоПроизводствоСохранитьУзелНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоТехМатериаловВТабличнуюЧасть" nameInSecondConfiguration="ДеревоТехМатериаловВТабличнуюЧасть">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоТехМатериаловОбъектПриИзменении" nameInSecondConfiguration="ДеревоТехМатериаловОбъектПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДиаметрТуннеляСтропыТуннельныеДругоеПриИзменении" nameInSecondConfiguration="ДиаметрТуннеляСтропыТуннельныеДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДиаметрТуннеляСтропыТуннельныеПриИзменении" nameInSecondConfiguration="ДиаметрТуннеляСтропыТуннельныеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДлинаРадугиСтропыРадугойПриИзменении" nameInSecondConfiguration="ДлинаРадугиСтропыРадугойПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДлинаСтропы4СтропыПриИзменении" nameInSecondConfiguration="ДлинаСтропы4СтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДлинаСтропыДлиннаяЧасть4СтропыПриИзменении" nameInSecondConfiguration="ДлинаСтропыДлиннаяЧасть4СтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДлинаСтропыКороткаяЧасть4СтропыПриИзменении" nameInSecondConfiguration="ДлинаСтропыКороткаяЧасть4СтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДлинаСтропыПоТелу4СтропыЧерезУголПриИзменении" nameInSecondConfiguration="ДлинаСтропыПоТелу4СтропыЧерезУголПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДлинаСтропыПоТелуСтропыРадугойПриИзменении" nameInSecondConfiguration="ДлинаСтропыПоТелуСтропыРадугойПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДлинаСтропыПриИзменении" nameInSecondConfiguration="ДлинаСтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДляКомплектовкиКомлектующаяОбработкаВыбора">
									<MergeRule>DoNotMerge</MergeRule>
								</Method>
								<Method name="ДляКомплектовкиКомлектующаяПриИзменении" nameInSecondConfiguration="ДляКомплектовкиКомлектующаяПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДляКомплектовкиПриИзменении" nameInSecondConfiguration="ДляКомплектовкиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьБлокСтрокВыходноеИзделие" nameInSecondConfiguration="ДобавитьБлокСтрокВыходноеИзделие">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьВыпускПроизводство" nameInSecondConfiguration="ДобавитьВыпускПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьКрашеныйПолуфабрикат" nameInSecondConfiguration="ДобавитьКрашеныйПолуфабрикат">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьКрашеныйПолуфабрикатНаСервере" nameInSecondConfiguration="ДобавитьКрашеныйПолуфабрикатНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьОбновитьНитьВМатериалыv11" nameInSecondConfiguration="ДобавитьОбновитьНитьВМатериалыv11">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьПолуфабрикатДоработка">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,7 @@
 
+&amp;НаКлиенте
+Процедура ДобавитьПолуфабрикатДоработка(Команда)
+	
+	ОткрытьФорму("Справочник.РУБЭГ_ЧастиБЭГОВ.Форма.ФормаВыбора", Новый Структура("Автозаголовок, Заголовок", Ложь, "К какой части бэга относится полуфабрикат?"),ЭтаФорма,,,, Новый ОписаниеОповещения("ПоказатьВыборЧастиБэгаЗавершение", ЭтаФорма));
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ДобавитьПолуфабрикатДоработкаЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,11 @@
 
+&amp;НаКлиенте
+Процедура ДобавитьПолуфабрикатДоработкаЗавершение(Результат, ДопПараметры) Экспорт
+	
+	Если ТипЗнч(Результат) = Тип("СправочникСсылка.Номенклатура") Тогда
+		ДобавитьПолуфабрикатИРазузлованиеВДеревоПроизводствоСервер(Результат, ДопПараметры);
+		РаскрытьДеревоТехМатериалов();
+		РаскрытьДеревоВидоРабот();
+	КонецЕсли;	
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ДобавитьПолуфабрикатИРазузлованиеВДеревоПроизводствоСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,35 @@
 
+&amp;НаСервере
+Процедура ДобавитьПолуфабрикатИРазузлованиеВДеревоПроизводствоСервер(Номенклатура, ЧастьБЭГА)
+
+	СпецификацияПолуфабриката = ОсновнаяСпецификацияПроизводствоВоронеж(Номенклатура);
+	Если СпецификацияПолуфабриката = Неопределено Тогда
+		Возврат;
+	КонецЕсли;	
+	
+	Дерево = ПолучитьДеревоСпецификацииДляРазузлования();
+	ПараметрыДерева = ПараметрыДереваСпецификаций(Номенклатура, СпецификацияПолуфабриката);
+	УправлениеДаннымиОбИзделиях.ЗаполнитьСтрокиДерева(ПараметрыДерева, Дерево, Неопределено);
+	
+	СтрокиПроизводства = ДеревоПроизводство.ПолучитьЭлементы()[0].ПолучитьЭлементы();
+	НоваяСтрока = СтрокиПроизводства.Добавить();
+	НоваяСтрока.ЧастьБЭГА		 = ЧастьБЭГА;
+	НоваяСтрока.Этап 	  		 = Номенклатура;
+	НоваяСтрока.Артикул	  		 = Номенклатура.Артикул;
+	НоваяСтрока.ВидСтроки 		 = "Полуфабрикат";
+	НоваяСтрока.ВыходноеИзделие  = Номенклатура;
+	НоваяСтрока.Спецификация       = СпецификацияПолуфабриката;
+	НоваяСтрока.Количество	 	   = 1;
+	НоваяСтрока.КоличествоНаПартию = Объект.Количество;
+	НоваяСтрока.Картинка  		   = БиблиотекаКартинок.ТребуетсяОтметитьВыполненным;
+	НоваяСтрока.ЭтоУзелДоработки   = Истина;
+	
+	СтрокиИсточника  = Дерево.Строки;
+	СтрокиПолучателя = НоваяСтрока.ПолучитьЭлементы();
+	ПереписатьДеревоСпецификацииВДеревоПроизводство(СтрокиИсточника, СтрокиПолучателя, ЧастьБЭГА);
+	
+	ТабличнаяЧастьВДеревоТехМатериалов("СписокТехМатериалов");
+	ТабличнаяЧастьВДеревоВидовРабот("СписокТехОпераций");
+	ОтметитьПодбранныеМатериалыИРаботы(ДеревоПроизводство.ПолучитьЭлементы()[0].ПолучитьИдентификатор());	
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ДобавитьПредопределеннуюСтрокуДереваПроизводство" nameInSecondConfiguration="ДобавитьПредопределеннуюСтрокуДереваПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьРезанныйПолуфабрикат" nameInSecondConfiguration="ДобавитьРезанныйПолуфабрикат">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -51,6 +51,7 @@
 	ПараметрыДляФормы.Вставить("Полуфабрикат", ДанныеСтроки.ВыходноеИзделие);
 	ПараметрыДляФормы.Вставить("Спецификация", ДанныеСтроки.Спецификация);
 	ПараметрыДляФормы.Вставить("Количество",   ?(ДанныеСтроки.Количество = 0, 1, ДанныеСтроки.Количество));
+	ПараметрыДляФормы.Вставить("КоличествоНаПартию",   ?(ДанныеСтроки.КоличествоНаПартию = 0, Объект.Количество, ДанныеСтроки.КоличествоНаПартию));
 	ПараметрыДляФормы.Вставить("ЕстьПолуфабрикаты", ЕстьПолуфабрикаты);
 	ПараметрыДляФормы.Вставить("Аббревиатура", "");
 	ПараметрыДляФормы.Вставить("НаименованиеПолуфабриката", "");
</Patch>
								</Method>
								<Method name="ДобавитьСтрокиДереваСервер" nameInSecondConfiguration="ДобавитьСтрокиДереваСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЕстьЛоготипПриИзменении" nameInSecondConfiguration="ЕстьЛоготипПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -7,4 +7,5 @@
 	
 	ОчиститьПродукциюИДеревоПроизводство();
 	ОчиститьМатериалыИРаботы();
+	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="ЕстьУплотнительныйШнурПриИзменении" nameInSecondConfiguration="ЕстьУплотнительныйШнурПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаготовкаТелоБЭГАПриИзменении" nameInSecondConfiguration="ЗаготовкаТелоБЭГАПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗакрытиеФормыПодбораАналогов" nameInSecondConfiguration="ЗакрытиеФормыПодбораАналогов">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗакрытиеФормыПодбораАналоговСервер" nameInSecondConfiguration="ЗакрытиеФормыПодбораАналоговСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -4,9 +4,10 @@
 
 	Объект.ЦенаСУчетомЗамен = Результат.ЦенаСУчетомЗамен;
 	Элементы.ДекорацияНадписьЦенаСУчетомЗамен.Заголовок = "Цена с учетом замен: "+Результат.ЦенаСУчетомЗамен;
-	АдресДереваЗамен 		   = Результат.АдресДереваЗамен;
-	АдресДереваМатериаловЗамен = Результат.АдресМатериаловЗамены;
-	АдресДереваРаботЗамен      = Результат.АдресРаботЗамены;
-	СоздатьСпецификациюЗаменыСервер();
+	Объект.СпецификацияЗамены  	   = Результат.СпецификацияЗамены;
+	Объект.СпецификацияЗаменыРубэг = Результат.СпецификацияЗаменыРубэг;
+	АдресДереваЗамен 		   	   = Результат.АдресДереваЗамен;
+	АдресДереваМатериаловЗамен     = Результат.АдресМатериаловЗамены;
+	АдресДереваРаботЗамен          = Результат.АдресРаботЗамены;
 
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="ЗаписатьДеревоПроизводствоВТабличнуюЧасть" nameInSecondConfiguration="ЗаписатьДеревоПроизводствоВТабличнуюЧасть">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаписатьДокумент" nameInSecondConfiguration="ЗаписатьДокумент">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаписатьПроизводственнуюСпецификациюНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,9 @@
 
+&amp;НаСервере
+Процедура ЗаписатьПроизводственнуюСпецификациюНаСервере()
+
+	
+	ДокументОбъект = РеквизитФормыВЗначение("Объект");
+	ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ЗаполнитьДеревоВидыРабот" nameInSecondConfiguration="ЗаполнитьДеревоВидыРабот">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьЗначенияПоУмолчаниюВерх" nameInSecondConfiguration="ЗаполнитьЗначенияПоУмолчаниюВерх">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьЗначенияПоУмолчаниюГруппаСтропы" nameInSecondConfiguration="ЗаполнитьЗначенияПоУмолчаниюГруппаСтропы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьЗначенияПоУмолчаниюНаСервере" nameInSecondConfiguration="ЗаполнитьЗначенияПоУмолчаниюНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьЗначенияПоУмолчаниюСтропы" nameInSecondConfiguration="ЗаполнитьЗначенияПоУмолчаниюСтропы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьМатериалыПоЭлементуБЭГа" nameInSecondConfiguration="ЗаполнитьМатериалыПоЭлементуБЭГа">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -4,4 +4,4 @@
 	
 	ЗаполнитьТехОперацииМатериалыПоЭлементуБЭГа("Номенклатура",СтруктураПараметровБЭГа);
 
-КонецПроцедуры // ЗаполнитьМатериалыПоЭлементуБЭГа()
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ЗаполнитьМатериалыУпаковкиДляДоработки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,15 @@
 
+&amp;НаСервере
+Процедура ЗаполнитьМатериалыУпаковкиДляДоработки(СтруктураЗначенийЭФ)
+
+	ЧастьБЭГАУпаковка = Справочники.РУБЭГ_ЧастиБЭГОВ.НайтиПоНаименованию("Упаковка");
+	СтрокиУпаковки = Объект.СписокТехМатериалов.НайтиСтроки(Новый Структура("ЧастьБЭГА", ЧастьБЭГАУпаковка));
+	Для каждого Элемент Из СтрокиУпаковки Цикл
+		Объект.СписокТехМатериалов.Удалить(Элемент);
+	КонецЦикла;
+	
+	ЗаполнитьТехОперацииМатериалы("Номенклатура", СтруктураЗначенийЭФ, ЧастьБЭГАУпаковка);	
+	ТабличнаяЧастьВДеревоТехМатериалов("СписокТехМатериалов");
+	ОтметитьПодбранныеМатериалыИРаботы();
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ЗаполнитьОдноэтапныйВыпуск" nameInSecondConfiguration="ЗаполнитьОдноэтапныйВыпуск">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьОставшимися" nameInSecondConfiguration="ЗаполнитьОставшимися">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -18,10 +18,12 @@
 		Для каждого СтрокаДереваМатериалы_1 Из СтрокаДереваМатериалы.ПолучитьЭлементы() Цикл
 			Если СтрокаДереваМатериалы_1.КоличествоПодобрано = 0 Тогда
 				СтрокаМатериалов = СтрокиМатериалов.Добавить();
-				СтрокаМатериалов.Этап 	 	= СтрокаДереваМатериалы_1.Объект;
-				СтрокаМатериалов.ВидСтроки  = "ДетальнаяЗапись";
-				СтрокаМатериалов.Количество = СтрокаДереваМатериалы_1.Количество;
-				СтрокаМатериалов.ЧастьБЭГА 	= СтрокаДереваМатериалы.ЧастьБЭГА;
+				СтрокаМатериалов.Этап 	 					= СтрокаДереваМатериалы_1.Объект;
+				СтрокаМатериалов.ВидСтроки 					= "ДетальнаяЗапись";
+				СтрокаМатериалов.Количество 				= СтрокаДереваМатериалы_1.Количество;
+				СтрокаМатериалов.КоличествоНаПартию 		= СтрокаДереваМатериалы_1.Количество*Объект.Количество;
+				СтрокаМатериалов.ЧастьБЭГА 					= СтрокаДереваМатериалы.ЧастьБЭГА;
+				СтрокаМатериалов.ИдСтроки					= СтрокаДереваМатериалы_1.ИдСтроки;
 				СтрокаДереваМатериалы_1.КоличествоПодобрано = СтрокаДереваМатериалы_1.Количество;
 			КонецЕсли;
 		КонецЦикла;	
@@ -31,10 +33,12 @@
 		Для каждого СтрокаДереваРаботы_1 Из СтрокаДереваРаботы.ПолучитьЭлементы() Цикл
 			Если СтрокаДереваРаботы_1.КоличествоПодобрано = 0 Тогда
 				СтрокаРабот = СтрокиРабот.Добавить();
-				СтрокаРабот.Этап 	   = СтрокаДереваРаботы_1.Объект;
-				СтрокаРабот.ВидСтроки  = "ДетальнаяЗапись";
-				СтрокаРабот.Количество = СтрокаДереваРаботы_1.Количество;
-				СтрокаРабот.ЧастьБЭГА  = СтрокаДереваРаботы.ЧастьБЭГА;
+				СтрокаРабот.Этап 	   					 = СтрокаДереваРаботы_1.Объект;
+				СтрокаРабот.ВидСтроки  					 = "ДетальнаяЗапись";
+				СтрокаРабот.Количество 					 = СтрокаДереваРаботы_1.Количество;
+				СтрокаРабот.КоличествоНаПартию 			 = СтрокаДереваРаботы_1.Количество*Объект.Количество;
+				СтрокаРабот.ЧастьБЭГА  					 = СтрокаДереваРаботы.ЧастьБЭГА;
+				СтрокаРабот.ИдСтроки  					 = СтрокаДереваРаботы_1.ИдСтроки;
 				СтрокаДереваРаботы_1.КоличествоПодобрано = СтрокаДереваРаботы_1.Количество;
 			КонецЕсли;
 		КонецЦикла;	
</Patch>
								</Method>
								<Method name="ЗаполнитьРаботыПоЭлементуБЭГа" nameInSecondConfiguration="ЗаполнитьРаботыПоЭлементуБЭГа">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьРеквизитФормыВидСтропСтрокой" nameInSecondConfiguration="ЗаполнитьРеквизитФормыВидСтропСтрокой">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьТаблицуПолуфабрикатовПоДеревуПроизводства" nameInSecondConfiguration="ЗаполнитьТаблицуПолуфабрикатовПоДеревуПроизводства">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьТехМатериалы" nameInSecondConfiguration="ЗаполнитьТехМатериалы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -5,8 +5,13 @@
 	Если Объект.СписокТехМатериалов.Количество() Тогда
 		ПоказатьВопрос(Новый ОписаниеОповещения("ВопросЗаполнитьТехМатериалыЗавершение",ЭтаФорма),"Перед заполнением, текущие тех. материалы будут очищены? Продолжть?",РежимДиалогаВопрос.ДаНет);
 	Иначе
-		ЗаполнитьТехОперацииМатериалы("Номенклатура", ВыделенныйТекстЭлементовФормы());
-		ЗаполнитьТехМатериалыДерево("");
+		Если Объект.ПошивКомплектовка = "Доработка" Тогда
+			ЗаполнитьМатериалыУпаковкиДляДоработки(ВыделенныйТекстЭлементовФормы());
+			РаскрытьДеревоТехМатериалов();
+		Иначе
+			ЗаполнитьТехОперацииМатериалы("Номенклатура", ВыделенныйТекстЭлементовФормы());
+			ЗаполнитьТехМатериалыДерево("");
+		КонецЕсли;	
 	КонецЕсли;	
 	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="ЗаполнитьТехМатериалыДерево" nameInSecondConfiguration="ЗаполнитьТехМатериалыДерево">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьТехМатериалыНаСервере" nameInSecondConfiguration="ЗаполнитьТехМатериалыНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьТехОперации" nameInSecondConfiguration="ЗаполнитьТехОперации">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьТехОперацииМатериалы" nameInSecondConfiguration="ЗаполнитьТехОперацииМатериалы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -2,10 +2,6 @@
 &amp;НаСервере
 Процедура ЗаполнитьТехОперацииМатериалы(ТипСправочника, СтруктураЗначенийЭФ, ЭлементБЭГа = "")
 	
-	//Если Не ВсеРеквизитыЗаполнены() Тогда
-	//	Возврат;
-	//КонецЕсли;	
-	
 	Запрос = Новый Запрос;
 	Запрос.Текст = 
 	"ВЫБРАТЬ
@@ -73,10 +69,17 @@
 	|	
 	|ГДЕ
 	|	НЕ Числа_КонструкторБЭГОВ.ПометкаУдаления
+	|	И ВЫБОР
+	|		КОГДА &amp;ЧастьБЭГА &lt;&gt; """"
+	|			ТОГДА Числа_КонструкторБЭГОВ.ЧастьБЭГА = &amp;ЧастьБЭГА
+	|		ИНАЧЕ
+	|			ИСТИНА
+	|	КОНЕЦ
 	|	И Числа_КонструкторБЭГОВ.Владелец ССЫЛКА Справочник."+ТипСправочника;
 	Запрос.УстановитьПараметр("ВидЦены",Справочники.ВидыЦен.НайтиПоРеквизиту("Идентификатор","РасчетнаяДляАнкетыБезНДС"));
 	Запрос.УстановитьПараметр("ПериодТехопераций", ?(ЗначениеЗаполнено(Объект.Дата),КонецДня(Объект.Дата), ТекущаяДата()));
 	Запрос.УстановитьПараметр("Дата", ?(ЗначениеЗаполнено(Объект.Дата),КонецДня(Объект.Дата), ТекущаяДата()));
+	Запрос.УстановитьПараметр("ЧастьБЭГА", ЭлементБЭГа);
 	
 	РеквизитыКонструктора = Метаданные.Справочники.Числа_КонструкторБЭГОВ.Реквизиты;
 	ТабЧастиКонструктора  = Метаданные.Справочники.Числа_КонструкторБЭГОВ.ТабличныеЧасти;
</Patch>
								</Method>
								<Method name="ЗаполнитьТехОперацииМатериалыКлиент" nameInSecondConfiguration="ЗаполнитьТехОперацииМатериалыКлиент">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -4,4 +4,4 @@
 
 	
 
-КонецПроцедуры // ЗаполнитьТехОперацииМатериалыКлиент()
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ЗаполнитьТехОперацииМатериалыПоЭлементуБЭГа" nameInSecondConfiguration="ЗаполнитьТехОперацииМатериалыПоЭлементуБЭГа">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -87,4 +87,4 @@
 		
 	КонецЦикла;
 
-КонецПроцедуры // ЗаполнитьТехОперацииМатериалыПоЭлементуБЭГа()
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ЗаполнитьЧастиБЭГОВВДереве" nameInSecondConfiguration="ЗаполнитьЧастиБЭГОВВДереве">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗапускВПроизводство" nameInSecondConfiguration="ЗапускВПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗапускВПроизводствоСервер" nameInSecondConfiguration="ЗапускВПроизводствоСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗащитноеУстройствоВерхПриИзменении" nameInSecondConfiguration="ЗащитноеУстройствоВерхПриИзменении">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ЗащитноеУстройствоНизПриИзменении" nameInSecondConfiguration="ЗащитноеУстройствоНизПриИзменении">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ЗначенияПоУмолчаниюДляВерха" nameInSecondConfiguration="ЗначенияПоУмолчаниюДляВерха">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗначенияПоУмолчаниюДляЛоготипа" nameInSecondConfiguration="ЗначенияПоУмолчаниюДляЛоготипа">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗначенияПоУмолчаниюДляСтроп" nameInSecondConfiguration="ЗначенияПоУмолчаниюДляСтроп">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗначенияПоУмолчаниюДляТипаНиза" nameInSecondConfiguration="ЗначенияПоУмолчаниюДляТипаНиза">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗначенияПоУмолчаниюДляУпаковки" nameInSecondConfiguration="ЗначенияПоУмолчаниюДляУпаковки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗначенияПоУмолчаниюДляУплотнительногоШнура" nameInSecondConfiguration="ЗначенияПоУмолчаниюДляУплотнительногоШнура">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КлапанЗавязанВерхПриИзменении" nameInSecondConfiguration="КлапанЗавязанВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КлапанЗавязанКомплектовкаПриИзменении" nameInSecondConfiguration="КлапанЗавязанКомплектовкаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КлапанЗавязанНизПриИзменении" nameInSecondConfiguration="КлапанЗавязанНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КоличествоБобинДляСтропыПриИзменении" nameInSecondConfiguration="КоличествоБобинДляСтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КоличествоЗавязокНизПриИзменении" nameInSecondConfiguration="КоличествоЗавязокНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КоличествоЛоготипПриИзменении" nameInSecondConfiguration="КоличествоЛоготипПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КоличествоПриИзменении" nameInSecondConfiguration="КоличествоПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,6 +1,23 @@
 
 &amp;НаКлиенте
 Процедура КоличествоПриИзменении(Элемент)
+	
 	ОчиститьПродукциюИДеревоПроизводство();
 	ОчиститьМатериалыИРаботы();
+	
+	СтрокаДереваПроизводство = ДеревоПроизводство.ПолучитьЭлементы()[0];
+	СтрокаДереваПроизводство.Количество 		= 1;
+	СтрокаДереваПроизводство.КоличествоНаПартию = Объект.Количество;
+	
+	Если Объект.ПошивКомплектовка = "Доработка" Тогда
+		Коэффициент = Объект.Количество/мКоличествоАнкетыДоИзменения;
+		ПересчитатьПодчиненныеСтрокиДереваПроизводство(СтрокаДереваПроизводство.ПолучитьИдентификатор(), Коэффициент, Ложь);
+		ТабличнаяЧастьВДеревоТехМатериалов("СписокТехМатериалов");
+		ТабличнаяЧастьВДеревоВидовРабот("СписокТехОпераций");
+		РаскрытьДеревоТехМатериалов();
+		РаскрытьДеревоВидоРабот();
+		ОтметитьПодбранныеМатериалыИРаботыСервер(ДеревоПроизводство.ПолучитьЭлементы()[0].ПолучитьИдентификатор());
+		мКоличествоАнкетыДоИзменения = Объект.Количество;
+	КонецЕсли;	
+	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="КоличествоСлоевПанелиНизПриИзменении" nameInSecondConfiguration="КоличествоСлоевПанелиНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КоличествоСлоевТканиПриИзменении" nameInSecondConfiguration="КоличествоСлоевТканиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КоличествоСторонЛоготипПриИзменении" nameInSecondConfiguration="КоличествоСторонЛоготипПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КоличествоЦветовЛоготипПриИзменении" nameInSecondConfiguration="КоличествоЦветовЛоготипПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КоличествоЦенаДляСчетаНажатие" nameInSecondConfiguration="КоличествоЦенаДляСчетаНажатие">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КороткаяЧастьКрестомПоДнуПриИзменении" nameInSecondConfiguration="КороткаяЧастьКрестомПоДнуПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КрайЮбкиПодшитНизПриИзменении" nameInSecondConfiguration="КрайЮбкиПодшитНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КрестомПоДну4СтропыПриИзменении" nameInSecondConfiguration="КрестомПоДну4СтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КрышкаКоличествоЗавязокВерхПриИзменении" nameInSecondConfiguration="КрышкаКоличествоЗавязокВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КрышкаСОтверстиемВерхПриИзменении" nameInSecondConfiguration="КрышкаСОтверстиемВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛаминированнаяНизПриИзменении" nameInSecondConfiguration="ЛаминированнаяНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛаминированнаяПанельВерхПриИзменении" nameInSecondConfiguration="ЛаминированнаяПанельВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛаминированнаяПанельНиз1ПриИзменении" nameInSecondConfiguration="ЛаминированнаяПанельНиз1ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛаминированнаяПанельНиз2ПриИзменении" nameInSecondConfiguration="ЛаминированнаяПанельНиз2ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛаминированнаяПанельНиз3ПриИзменении" nameInSecondConfiguration="ЛаминированнаяПанельНиз3ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛаминированнаяПанельНиз4ПриИзменении" nameInSecondConfiguration="ЛаминированнаяПанельНиз4ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛаминированнаяПриИзменении" nameInSecondConfiguration="ЛаминированнаяПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛаминированнаяЮбкаНизПриИзменении" nameInSecondConfiguration="ЛаминированнаяЮбкаНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛаминированныйКлапанВерхПриИзменении" nameInSecondConfiguration="ЛаминированныйКлапанВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛаминированныйКлапанНизПриИзменении" nameInSecondConfiguration="ЛаминированныйКлапанНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛоготипЦвет1ДругоеПриИзменении" nameInSecondConfiguration="ЛоготипЦвет1ДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛоготипЦвет1ПриИзменении" nameInSecondConfiguration="ЛоготипЦвет1ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛоготипЦвет2ДругоеПриИзменении" nameInSecondConfiguration="ЛоготипЦвет2ДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛоготипЦвет2ПриИзменении" nameInSecondConfiguration="ЛоготипЦвет2ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛоготипЦвет3ДругоеПриИзменении" nameInSecondConfiguration="ЛоготипЦвет3ДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛоготипЦвет3ПриИзменении" nameInSecondConfiguration="ЛоготипЦвет3ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛоготипЦвет4ДругоеПриИзменении" nameInSecondConfiguration="ЛоготипЦвет4ДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛоготипЦвет4ПриИзменении" nameInSecondConfiguration="ЛоготипЦвет4ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="МаркировкаКарман2ПриИзменении" nameInSecondConfiguration="МаркировкаКарман2ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="МаркировкаКарман3ПриИзменении" nameInSecondConfiguration="МаркировкаКарман3ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="МаркировкаКарман4ПриИзменении" nameInSecondConfiguration="МаркировкаКарман4ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="МаркировкаКарманДругое1ПриИзменении" nameInSecondConfiguration="МаркировкаКарманДругое1ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="МаркировкаКарманДругое2ПриИзменении" nameInSecondConfiguration="МаркировкаКарманДругое2ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="МаркировкаКарманДругое3ПриИзменении" nameInSecondConfiguration="МаркировкаКарманДругое3ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="МаркировкаКарманДругое4ПриИзменении" nameInSecondConfiguration="МаркировкаКарманДругое4ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="МаркировкаЛоготипПриИзменении" nameInSecondConfiguration="МаркировкаЛоготипПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="НаборНитейДляСтропыВесНитейПриИзменении" nameInSecondConfiguration="НаборНитейДляСтропыВесНитейПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="НаборНитейДляСтропыКоличествоПриИзменении" nameInSecondConfiguration="НаборНитейДляСтропыКоличествоПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="НаборНитейДляСтропыНоменклатураПриИзменении" nameInSecondConfiguration="НаборНитейДляСтропыНоменклатураПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="НаборНитейДляСтропыНоменклатураПриИзмененииНаСервере" nameInSecondConfiguration="НаборНитейДляСтропыНоменклатураПриИзмененииНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="НаборНитейДляСтропыОбработкаВыбора" nameInSecondConfiguration="НаборНитейДляСтропыОбработкаВыбора">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="НаименованиеЛоготипПриИзменении" nameInSecondConfiguration="НаименованиеЛоготипПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="НюансТелоБЭГАПриИзменении" nameInSecondConfiguration="НюансТелоБЭГАПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="НюансыВерхПриИзменении" nameInSecondConfiguration="НюансыВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="НюансыСтропыПриИзменении" nameInSecondConfiguration="НюансыСтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбновитьДеревоПроизводствоСУчетомАналоговСервер" nameInSecondConfiguration="ОбновитьДеревоПроизводствоСУчетомАналоговСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбновитьЗаголовокКоличествоЦенаДляСчета" nameInSecondConfiguration="ОбновитьЗаголовокКоличествоЦенаДляСчета">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбновитьЦену" nameInSecondConfiguration="ОбновитьЦену">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ОбновитьЦенуБезПерезаполнения" nameInSecondConfiguration="ОбновитьЦенуБезПерезаполнения">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбновитьЦенуНаСервере" nameInSecondConfiguration="ОбновитьЦенуНаСервере">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ОбновитьЦенуОсколНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,33 @@
 
+&amp;НаСервере
+Процедура ОбновитьЦенуОсколНаСервере()
+
+	СуммаТехОпераций   = Объект.СписокТехОпераций.Итог("Сумма");
+	Запрос = Новый Запрос;
+	Запрос.Текст = 
+	"ВЫБРАТЬ
+	|	СУММА(ВЫБОР СтатьиРасходов.Процент
+	|			КОГДА ЛОЖЬ
+	|				ТОГДА СтатьиРасходов.Величина
+	|		КОНЕЦ) КАК СуммаВеличин,
+	|	СУММА(ВЫБОР СтатьиРасходов.Процент
+	|			КОГДА ИСТИНА
+	|				ТОГДА СтатьиРасходов.Величина
+	|		КОНЕЦ) КАК СуммаПроцентов
+	|ИЗ
+	|	Справочник.СтатьиРасходов КАК СтатьиРасходов
+	|ГДЕ
+	|	НЕ СтатьиРасходов.ЭтоГруппа
+	|	И СтатьиРасходов.Ссылка В ИЕРАРХИИ(&amp;Группа)";
+	Запрос.УстановитьПараметр("Группа", Справочники.СтатьиРасходов.НайтиПоКоду("000000002"));
+	
+	Выборка = Запрос.Выполнить().Выбрать();
+	Выборка.Следующий();
+	СуммаДопРасходов = ?(Выборка.СуммаВеличин = Null,0,Выборка.СуммаВеличин);
+	
+	Сумма = (СуммаТехОпераций + СуммаДопРасходов);
+	
+	Элементы.ДекорацияСтоимостьАктаОскол.Заголовок = "Стоимость акта: "+Формат((Сумма),"ЧДЦ=2");
+	Объект.ЦенаОскол = Сумма;
+
+КонецПроцедуры // ОбновитьЦенуОсколНаСервере()
</Patch>
								</Method>
								<Method name="ОбновитьЦенуСПерезаполнением" nameInSecondConfiguration="ОбновитьЦенуСПерезаполнением">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -3,6 +3,7 @@
 Процедура ОбновитьЦенуСПерезаполнением(Команда)
 	
 	ОчиститьПродукциюИДеревоПроизводство();
+	ОчиститьЗамены();
 	
 	Если Не ПроверитьЗаполнениеРеквизитов() Тогда
 		Возврат;
</Patch>
								</Method>
								<Method name="ОбновитьЦеныМатериаловИРабот" nameInSecondConfiguration="ОбновитьЦеныМатериаловИРабот">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбнулитьПодобранныеСтроки" nameInSecondConfiguration="ОбнулитьПодобранныеСтроки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбработатьДеревоПроизводство" nameInSecondConfiguration="ОбработатьДеревоПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбработатьУдалениеВеткиДереваПроизводствоДляДоработки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,20 @@
 
+&amp;НаСервере
+Процедура ОбработатьУдалениеВеткиДереваПроизводствоДляДоработки(ИдСтроки)
+	
+	СтрокиКУдалениюМатериалы = Новый Массив;
+	СтрокиКУдалениюРаботы	 = Новый Массив;
+	УдалитьМатериалыИРаботыУдаляемойСтроки(ИдСтроки, СтрокиКУдалениюМатериалы, СтрокиКУдалениюРаботы);
+	
+	Для каждого УдаляемаяСтрока Из СтрокиКУдалениюМатериалы Цикл
+		Объект.СписокТехМатериалов.Удалить(УдаляемаяСтрока);
+	КонецЦикла;
+	
+	Для каждого УдаляемаяСтрока Из СтрокиКУдалениюРаботы Цикл
+		Объект.СписокТехОпераций.Удалить(УдаляемаяСтрока);
+	КонецЦикла;
+	
+	ТабличнаяЧастьВДеревоТехМатериалов("СписокТехМатериалов");
+	ТабличнаяЧастьВДеревоВидовРабот("СписокТехОпераций");
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ОбработкаВыбораУзлаАнкеты" nameInSecondConfiguration="ОбработкаВыбораУзлаАнкеты">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбработкаПерехода" nameInSecondConfiguration="ОбработкаПерехода">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбрабочикОжиданияОбновитьСписокНезаполненных" nameInSecondConfiguration="ОбрабочикОжиданияОбновитьСписокНезаполненных">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОповещениеОВыбореПараметровАнкеты" nameInSecondConfiguration="ОповещениеОВыбореПараметровАнкеты">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОповещениеОВыбореПолуфабриката" nameInSecondConfiguration="ОповещениеОВыбореПолуфабриката">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -11,13 +11,48 @@
 		Возврат;
 	КонецЕсли;	
 	
-	ДанныеСтроки.Артикул		   = ЗначениеВыбора.Артикул;
-	ДанныеСтроки.ВыходноеИзделие   = ЗначениеВыбора.Полуфабрикат;
-	ДанныеСтроки.Спецификация      = ЗначениеВыбора.Спецификация;
-	ДанныеСтроки.Количество        = ЗначениеВыбора.Количество;
-	ДанныеСтроки.Этап			   = ЗначениеВыбора.НаименованиеПолное;
-	ДанныеСтроки.Проверен		   = ЗначениеВыбора.Проверен;
-	ДанныеСтроки.СтрокаНеактуальна = Ложь;
+	ДанныеСтроки.Артикул		    = ЗначениеВыбора.Артикул;
+	ДанныеСтроки.ВыходноеИзделие    = ЗначениеВыбора.Полуфабрикат;
+	ДанныеСтроки.Спецификация       = ЗначениеВыбора.Спецификация;
+	ДанныеСтроки.Количество         = ЗначениеВыбора.Количество;
+	ДанныеСтроки.КоличествоНаПартию = ЗначениеВыбора.КоличествоНаПартию;
+	ДанныеСтроки.Этап			    = ЗначениеВыбора.НаименованиеПолное;
+	ДанныеСтроки.Проверен		    = ЗначениеВыбора.Проверен;
+	ДанныеСтроки.СтрокаНеактуальна  = Ложь;
+	
+	Если ЗначениеВыбора.Свойство("СоставПерезаполняемого") Тогда
+		
+		Для каждого Строка Из ЗначениеВыбора.СоставПерезаполняемого Цикл
+			
+			Если Строка.Количество &lt; 0 Тогда
+				СвязанныеСтроки = ЗначениеВыбора.СоставПерезаполняемого.НайтиСтроки(Новый Структура("ИдентификаторСтроки", Строка.ИдентификаторСтроки));
+				Если СвязанныеСтроки.Количество() &gt; 1 Тогда
+					СтрокаДерева = ДеревоПроизводство.НайтиПоИдентификатору(Строка.ИдентификаторСтроки);
+					СтрокаДерева.КоличествоНаПартию = Строка.Количество;
+					СтрокиМатериалов = Объект.СписокТехМатериалов.НайтиСтроки(Новый Структура("ИдСтроки", СтрокаДерева.ИдСтроки));
+					СтрокиМатериалов[0].Количество = Строка.Количество;
+					СтрокиМатериалов[0].Сумма      = СтрокиМатериалов[0].Количество*СтрокиМатериалов[0].Расценка;
+					СтрокиПерезаполнения = СтрокаДерева.ПолучитьЭлементы();
+					Для каждого Элемент Из СвязанныеСтроки Цикл
+						Если Элемент.Количество &lt; 0 Тогда
+							Продолжить;
+						КонецЕсли;
+						НоваяСтрока = СтрокиПерезаполнения.Добавить();
+						ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаДерева,,"Замены");
+						НоваяСтрока.Количество = Элемент.Количество;
+						НоваяСтрока.ВидСтроки = "СтрокаИскл";
+					КонецЦикла;
+					
+				КонецЕсли;	
+			КонецЕсли;	
+		
+		КонецЦикла;
+		
+		ТабличнаяЧастьВДеревоТехМатериалов("СписокТехМатериалов");
+		ОтметитьПодбранныеМатериалыИРаботы();
+		РаскрытьДеревоТехМатериалов();
+		
+	КонецЕсли;	
 	
 	Если ЗначениеВыбора.ПолуфабрикатИзменен Тогда
 		УстановитьПризнакНеактуальностиУРодительскойСтроки(Элементы.ДеревоПроизводство.ТекущаяСтрока);
</Patch>
								</Method>
								<Method name="ОтметитьПодбранныеМатериалыИРаботы" nameInSecondConfiguration="ОтметитьПодбранныеМатериалыИРаботы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,12 +1,22 @@
 
 &amp;НаСервере
-Процедура ОтметитьПодбранныеМатериалыИРаботы(ТекущаяСтрока, ЭтоУдалениеСтроки = Ложь, Отказ = Ложь, ТаблицаДопРасходов = Неопределено)
+Процедура ОтметитьПодбранныеМатериалыИРаботы(ТекущаяСтрока = Неопределено, ЭтоУдалениеСтроки = Ложь, Отказ = Ложь, ТаблицаДопРасходов = Неопределено)
+	
+	Если ТекущаяСтрока = Неопределено Тогда
+		ТекущаяСтрока = ДеревоПроизводство.ПолучитьЭлементы()[0].ПолучитьИдентификатор();
+	КонецЕсли;	
 	
 	Если ТипЗнч(ТекущаяСтрока) = Тип("Число") Тогда
 		СтрокаДерева = ДеревоПроизводство.НайтиПоИдентификатору(ТекущаяСтрока);
 	Иначе
 		СтрокаДерева = ТекущаяСтрока;
 	КонецЕсли;	
+	
+	Если Объект.ПошивКомплектовка = "Доработка" Тогда
+		КолонкаКоличества = "КоличествоНаПартию";
+	Иначе
+		КолонкаКоличества = "Количество";
+	КонецЕсли;	
 
 	Если СтрокаДерева.ВидСтроки = "ДетальнаяЗапись" Тогда
 		
@@ -21,7 +31,7 @@
 				
 					Для каждого СтрокаДереваМатериалы_1 Из СтрокаДереваМатериалы.ПолучитьЭлементы() Цикл
 						
-						Если СтрокаДереваМатериалы_1.Объект = СтрокаДерева.Этап И Окр(СтрокаДереваМатериалы_1.Количество,3) = СтрокаДерева.Количество Тогда
+						Если СтрокаДереваМатериалы_1.Объект = СтрокаДерева.Этап И Окр(СтрокаДереваМатериалы_1.Количество,3) = СтрокаДерева[КолонкаКоличества] И СтрокаДереваМатериалы_1.ИдСтроки = СтрокаДерева.ИдСтроки Тогда
 							Нашел = Истина;
 							СтрокаДереваМатериалы_1.КоличествоПодобрано = СтрокаДереваМатериалы_1.Количество;
 						КонецЕсли;	
@@ -46,15 +56,15 @@
 			СтрокаДерева.Артикул = СтрокаДерева.Этап.Код;
 			
 			Нашел = Ложь;
-			Для каждого СтрокаДереваМатериалы Из ДеревоВидовРаботv11.ПолучитьЭлементы() Цикл
+			Для каждого СтрокаДереваРаботы Из ДеревоВидовРаботv11.ПолучитьЭлементы() Цикл
 				
-				Если СтрокаДереваМатериалы.ЧастьБЭГА = СтрокаДерева.ЧастьБЭГА Или Объект.Площадка = "СтОскол" Тогда
+				Если СтрокаДереваРаботы.ЧастьБЭГА = СтрокаДерева.ЧастьБЭГА Или Объект.Площадка = "СтОскол" Тогда
 					
-					Для каждого СтрокаДереваМатериалы_1 Из СтрокаДереваМатериалы.ПолучитьЭлементы() Цикл
+					Для каждого СтрокаДереваРаботы_1 Из СтрокаДереваРаботы.ПолучитьЭлементы() Цикл
 						
-						Если СтрокаДереваМатериалы_1.Объект = СтрокаДерева.Этап И Окр(СтрокаДереваМатериалы_1.Количество,3) = СтрокаДерева.Количество Тогда
+						Если СтрокаДереваРаботы_1.Объект = СтрокаДерева.Этап И Окр(СтрокаДереваРаботы_1.Количество,3) = СтрокаДерева[КолонкаКоличества] И СтрокаДереваРаботы_1.ИдСтроки = СтрокаДерева.ИдСтроки Тогда
 							Нашел = Истина;
-							СтрокаДереваМатериалы_1.КоличествоПодобрано = СтрокаДереваМатериалы_1.Количество;
+							СтрокаДереваРаботы_1.КоличествоПодобрано = СтрокаДереваРаботы_1.Количество;
 						КонецЕсли;	
 						
 					КонецЦикла;		
</Patch>
								</Method>
								<Method name="ОтметитьПодбранныеМатериалыИРаботыСервер" nameInSecondConfiguration="ОтметитьПодбранныеМатериалыИРаботыСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОчиститьЗамены">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,12 @@
 
+&amp;НаСервере
+Процедура ОчиститьЗамены()
+
+	Объект.ЦенаСУчетомЗамен = 0;	
+	Элементы.ДекорацияНадписьЦенаСУчетомЗамен.Заголовок = "";
+	Объект.СпецификацияЗамены = "";
+	ДокументОбъект = РеквизитФормыВЗначение("Объект");
+	ДокументОбъект.ДеревоАналоговХранилище = Неопределено;
+	АдресДереваЗамен = "";
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ОчиститьМатериалыИРаботы" nameInSecondConfiguration="ОчиститьМатериалыИРаботы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -2,6 +2,10 @@
 &amp;НаКлиенте
 Процедура ОчиститьМатериалыИРаботы()
 
+	Если Объект.ПошивКомплектовка = "Доработка" Тогда
+		Возврат;
+	КонецЕсли;	
+	
 	Объект.СписокТехМатериалов.Очистить();	
 	Объект.СписокТехОпераций.Очистить();	
 	Объект.СписокМатериаловv11.Очистить();
</Patch>
								</Method>
								<Method name="ОчиститьПродукциюИДеревоПроизводство" nameInSecondConfiguration="ОчиститьПродукциюИДеревоПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -2,6 +2,10 @@
 &amp;НаКлиенте
 Процедура ОчиститьПродукциюИДеревоПроизводство()
 
+	Если Объект.ПошивКомплектовка = "Доработка" Тогда
+		Возврат;
+	КонецЕсли;	
+	
 	Если ДеревоПроизводство.ПолучитьЭлементы().Количество() &gt; 0 Тогда
 		ДеревоПроизводство.ПолучитьЭлементы().Очистить();
 	КонецЕсли;	
@@ -15,5 +19,6 @@
 	КонецЕсли;	
 	
 	ДобавитьПредопределеннуюСтрокуДереваПроизводство();
+	ОтметитьПодбранныеМатериалыИРаботы(ДеревоПроизводство.ПолучитьЭлементы()[0].ПолучитьИдентификатор(),,,);
 
 КонецПроцедуры // ОчиститьПродукциюИДеревоПроизводство()
</Patch>
								</Method>
								<Method name="ПередЗакрытием" nameInSecondConfiguration="ПередЗакрытием">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПередЗаписью" nameInSecondConfiguration="ПередЗаписью">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,6 +1,7 @@
 
 &amp;НаКлиенте
 Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
+	ПараметрыЗаписи.Вставить("БлабЛа");
 	
 	ТекстЗапрета = "";
 	Если ПараметрыЗаписи.РежимЗаписи = РежимЗаписиДокумента.Проведение И Не ЕстьРольПроведениеАнкеты() Тогда
@@ -19,4 +20,10 @@
 		Сообщить("Не заполнен вес продукта!");
 	КонецЕсли;	
 	
+	Если ЗначениеЗаполнено(Объект.СпецификацияЗамены) Тогда
+		ПоказатьВопрос(Новый ОписаниеОповещения("ВопросУказанияСпецификацииДляПроизводстваЗавершение", ЭтаФорма), "Введены замены для продукции. Производство будет запускаться по спецификации замены?", РежимДиалогаВопрос.ДаНет);
+	Иначе
+		Объект.ПроизводственнаяСпецификация = Объект.Спецификация;
+	КонецЕсли;	
+	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="ПередЗаписьюНаСервере" nameInSecondConfiguration="ПередЗаписьюНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -10,12 +10,15 @@
 				Если Найти(ЭлементФормы.ПутьКДанным,"Объект") = 0 Тогда
 					Продолжить;
 				КонецЕсли;	
-				Если ТипЗнч(ТекущийОбъект[ЭлементФормы.Имя]) = Тип("Число") Тогда
-					ТекущийОбъект[ЭлементФормы.Имя] = 0;
-				ИначеЕсли ТипЗнч(ТекущийОбъект[ЭлементФормы.Имя]) = Тип("Строка") Тогда
-					ТекущийОбъект[ЭлементФормы.Имя] = "";
-				ИначеЕсли ТипЗнч(ТекущийОбъект[ЭлементФормы.Имя]) = Тип("Булево") Тогда
-					ТекущийОбъект[ЭлементФормы.Имя] = Ложь;
+				
+				ИмяРеквизита = СтрЗаменить(ЭлементФормы.ПутьКДанным,"Объект.","");
+				
+				Если ТипЗнч(ТекущийОбъект[ИмяРеквизита]) = Тип("Число") Тогда
+					ТекущийОбъект[ИмяРеквизита] = 0;
+				ИначеЕсли ТипЗнч(ТекущийОбъект[ИмяРеквизита]) = Тип("Строка") Тогда
+					ТекущийОбъект[ИмяРеквизита] = "";
+				ИначеЕсли ТипЗнч(ТекущийОбъект[ИмяРеквизита]) = Тип("Булево") Тогда
+					ТекущийОбъект[ИмяРеквизита] = Ложь;
 				КонецЕсли;	
 			КонецЕсли;	
 			
</Patch>
								</Method>
								<Method name="ПереименоватьСтрокиПолуфабрикатовДереваПроизводство" nameInSecondConfiguration="ПереименоватьСтрокиПолуфабрикатовДереваПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПереписатьДеревоСпецификацииВДеревоПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,84 @@
 
+&amp;НаСервере
+Процедура ПереписатьДеревоСпецификацииВДеревоПроизводство(СтрокиИсточника, СтрокиПолучателя, ЧастьБЭГА)
+
+	Для каждого Строка Из СтрокиИсточника Цикл
+		
+		Если Строка.ЕстьСпецификация Тогда
+			НоваяСтрока = СтрокиПолучателя[0].ПолучитьРодителя().ПолучитьРодителя().ПолучитьЭлементы().Добавить();
+		Иначе
+			НоваяСтрока = СтрокиПолучателя.Добавить();
+		КонецЕсли;
+		
+		Если Строка.ВидСтроки = Перечисления.ВидыСтрокДереваСпецификаций.МатериалыИУслуги Тогда
+			НоваяСтрока.Этап	  = "Материалы";
+			НоваяСтрока.ВидСтроки = "Материалы";
+			НоваяСтрока.Картинка  = БиблиотекаКартинок.РазделСклад16;
+		ИначеЕсли Строка.ВидСтроки = Перечисления.ВидыСтрокДереваСпецификаций.Трудозатраты Тогда
+			НоваяСтрока.Этап	  = "Работы";
+			НоваяСтрока.ВидСтроки = "Работы";
+			НоваяСтрока.Картинка  = БиблиотекаКартинок.АдминистрированиеСервиса;;
+		ИначеЕсли Строка.ЕстьСпецификация Тогда
+			НоваяСтрока.Этап 	  		   = Строка.Номенклатура;
+			НоваяСтрока.Артикул	  		   = Строка.Номенклатура.Артикул;
+			НоваяСтрока.ВидСтроки 		   = "Полуфабрикат";
+			НоваяСтрока.ВыходноеИзделие    = Строка.Номенклатура;
+			НоваяСтрока.Спецификация       = Строка.Спецификация;
+			НоваяСтрока.Количество		   = Строка.Количество;
+			НоваяСтрока.КоличествоНаПартию = Строка.Количество*Объект.Количество;
+			НоваяСтрока.Картинка  		= БиблиотекаКартинок.ТребуетсяОтметитьВыполненным;
+		ИначеЕсли Строка.ВидСтроки = Перечисления.ВидыСтрокДереваСпецификаций.Материал Тогда
+			НоваяСтрока.Этап 	  		   = Строка.Номенклатура;
+			НоваяСтрока.Артикул	  		   = Строка.Номенклатура.Артикул;
+			НоваяСтрока.ВидСтроки 		   = "ДетальнаяЗапись";
+			НоваяСтрока.Количество		   = Строка.Количество;
+			НоваяСтрока.КоличествоНаПартию = Строка.Количество*Объект.Количество;
+			НоваяСтрока.ЧастьБЭГА		   = ЧастьБЭГА;
+			НоваяСтрока.ИдСтроки		   = Новый УникальныйИдентификатор;
+			
+			СтрокиМатериалов = Объект.СписокТехМатериалов.НайтиСтроки(Новый Структура("Объект, ЧастьБЭГА, ИдСтроки",Строка.Номенклатура, ЧастьБЭГА, НоваяСтрока.ИдСтроки));
+			Если СтрокиМатериалов.Количество() Тогда
+				НоваяСтрокаМатериалов = СтрокиМатериалов[0];
+				НоваяСтрокаМатериалов.Количество = НоваяСтрокаМатериалов.Количество+НоваяСтрока.КоличествоНаПартию;
+				НоваяСтрокаМатериалов.Сумма      = НоваяСтрокаМатериалов.Расценка*НоваяСтрокаМатериалов.Количество;
+			Иначе
+				НоваяСтрокаМатериалов = Объект.СписокТехМатериалов.Добавить();
+				НоваяСтрокаМатериалов.Объект     = Строка.Номенклатура;
+				НоваяСтрокаМатериалов.Количество = НоваяСтрока.КоличествоНаПартию;
+				НоваяСтрокаМатериалов.Расценка   = РасценкаНаСервере(Строка.Номенклатура);
+				НоваяСтрокаМатериалов.Сумма      = НоваяСтрокаМатериалов.Расценка*НоваяСтрокаМатериалов.Количество;
+				НоваяСтрокаМатериалов.ЧастьБЭГА  = ЧастьБЭГА;
+				НоваяСтрокаМатериалов.ИдСтроки	 = НоваяСтрока.ИдСтроки
+			КонецЕсли;
+			
+		ИначеЕсли Строка.ВидСтроки = Перечисления.ВидыСтрокДереваСпецификаций.Трудозатрата Тогда
+			НоваяСтрока.Этап 	  		   = Строка.Номенклатура;
+			НоваяСтрока.Артикул	  		   = Строка.Номенклатура.Код;
+			НоваяСтрока.ВидСтроки 		   = "ДетальнаяЗапись";
+			НоваяСтрока.Количество		   = Строка.Количество;
+			НоваяСтрока.КоличествоНаПартию = Строка.Количество*Объект.Количество;
+			НоваяСтрока.ЧастьБЭГА		   = ЧастьБЭГА;
+			НоваяСтрока.ИдСтроки		   = Новый УникальныйИдентификатор;
+			
+			СтрокиРабот = Объект.СписокТехОпераций.НайтиСтроки(Новый Структура("Объект, ЧастьБЭГА, ИдСтроки",Строка.Номенклатура, ЧастьБЭГА, НоваяСтрока.ИдСтроки));
+			Если СтрокиРабот.Количество() Тогда
+				НоваяСтрокаРабот = СтрокиРабот[0];
+				НоваяСтрокаРабот.Количество = НоваяСтрокаРабот.Количество+НоваяСтрока.КоличествоНаПартию;
+				НоваяСтрокаРабот.Сумма 		= НоваяСтрокаРабот.Расценка*НоваяСтрокаРабот.Количество;
+			Иначе
+				НоваяСтрокаРабот = Объект.СписокТехОпераций.Добавить();
+				НоваяСтрокаРабот.Объект     = Строка.Номенклатура;
+				НоваяСтрокаРабот.Количество = НоваяСтрока.КоличествоНаПартию;
+				НоваяСтрокаРабот.Расценка   = РасценкаНаСервере(Строка.Номенклатура);
+				НоваяСтрокаРабот.Сумма      = НоваяСтрокаРабот.Расценка*НоваяСтрокаРабот.Количество;
+				НоваяСтрокаРабот.ЧастьБЭГА  = ЧастьБЭГА;
+				НоваяСтрокаРабот.ИдСтроки	= НоваяСтрока.ИдСтроки
+			КонецЕсли;	
+			
+		КонецЕсли;	
+		
+		ПереписатьДеревоСпецификацииВДеревоПроизводство(Строка.Строки, НоваяСтрока.ПолучитьЭлементы(), ЧастьБЭГА);
+		
+	КонецЦикла;
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ПересоздатьПолуфабрикатДоработка">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,63 @@
 
+&amp;НаКлиенте
+Процедура ПересоздатьПолуфабрикатДоработка(Команда)
+	
+	ДанныеСтроки = Элементы.ДеревоПроизводство.ТекущиеДанные;
+	Если ДанныеСтроки = Неопределено Тогда
+		Возврат;
+	КонецЕсли;	
+	
+	Если ДанныеСтроки.ВидСтроки &lt;&gt; "Полуфабрикат" Тогда
+		Возврат;
+	КонецЕсли;
+	
+	СообщениеОшибки = "";
+	СтрокиДерева = ДанныеСтроки.ПолучитьЭлементы();
+	Для каждого СтрокаДерева Из СтрокиДерева Цикл
+		Если СтрокаДерева.ВидСтроки = "Материалы" Тогда
+			СтрокиДерева_1 = СтрокаДерева.ПолучитьЭлементы();
+			Если Не СтрокиДерева_1.Количество() Тогда
+				СообщениеОшибки = "Для полуфабриката не указан ни один материал!";
+			КонецЕсли;	
+		ИначеЕсли СтрокаДерева.ВидСтроки = "Полуфабрикат" Тогда
+			СообщениеОшибки = "";
+		КонецЕсли;	
+	КонецЦикла;
+	
+	Если СообщениеОшибки &lt;&gt; "" Тогда
+		Сообщение = Новый СообщениеПользователю;
+		Сообщение.Текст = СообщениеОшибки;
+		Сообщение.Сообщить();
+	КонецЕсли;	
+	
+	ЕстьПолуфабрикаты = Ложь;
+	Материалы = Новый Соответствие;
+	Работы	  = Новый Соответствие;
+	
+	Адрес = Неопределено;
+	ВидЗаготовки = ПоместитьВХранилищеСтруктуруПолуфабриката(Элементы.ДеревоПроизводство.ТекущаяСтрока, Адрес);
+	
+	СтруктураПолуфабриката = Новый Структура("АдресСтруктурыПолуфабриката", Адрес);
+	
+	ПараметрыДляФормы = Новый Структура;
+	//ПараметрыДляФормы.Вставить("Ключ", Объект);
+	ПараметрыДляФормы.Вставить("ПересозданиеПолуфабриката", Истина);
+	ПараметрыДляФормы.Вставить("СтруктураТекущегоДокумента", ПолучитьСтруктуруРеквизитовТекущегоДокумента());
+	ПараметрыДляФормы.Вставить("ВидЗаготовки", ВидЗаготовки);
+	ПараметрыДляФормы.Вставить("СтруктураПолуфабриката", СтруктураПолуфабриката);
+	ПараметрыДляФормы.Вставить("АдресСтруктурыПолуфабриката", Адрес);
+	ПараметрыДляФормы.Вставить("Полуфабрикат", ДанныеСтроки.ВыходноеИзделие);
+	ПараметрыДляФормы.Вставить("Спецификация", ДанныеСтроки.Спецификация);
+	ПараметрыДляФормы.Вставить("Количество",   ?(ДанныеСтроки.Количество = 0, 1, ДанныеСтроки.Количество));
+	ПараметрыДляФормы.Вставить("КоличествоНаПартию",   ?(ДанныеСтроки.КоличествоНаПартию = 0, Объект.Количество, ДанныеСтроки.КоличествоНаПартию));
+	ПараметрыДляФормы.Вставить("ЕстьПолуфабрикаты", ЕстьПолуфабрикаты);
+	ПараметрыДляФормы.Вставить("Аббревиатура", "");
+	ПараметрыДляФормы.Вставить("НаименованиеПолуфабриката", "");
+	ПараметрыДляФормы.Вставить("НаименованиеЛоготип", Объект.НаименованиеЛоготип);
+	ПараметрыДляФормы.Вставить("ЧастьБЭГА", ДанныеСтроки.ЧастьБЭГА);
+	
+	ОповещениеОВыбореПолуфабриката = Новый ОписаниеОповещения("ОповещениеОВыбореПолуфабриката", ЭтаФорма);
+	
+	ОткрытьФорму("Документ.Числа_НоваяАнкета.Форма.ФормаСозданияПолуфабриката", ПараметрыДляФормы, ЭтаФорма,,,,ОповещениеОВыбореПолуфабриката,РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ПересчитатьПодобранныеСтрокиВПроизводство">
									<MergeRule>DoNotMerge</MergeRule>
								</Method>
								<Method name="ПересчитатьПодчиненныеСтрокиДереваПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,39 @@
 
+&amp;НаСервере
+Процедура ПересчитатьПодчиненныеСтрокиДереваПроизводство(ИдСтроки, Коэффициент, ПересчитыватьОтрицательные = Истина)
+	
+	СтрокаДерева = ДеревоПроизводство.НайтиПоИдентификатору(ИдСтроки);
+	Для каждого Строка Из СтрокаДерева.ПолучитьЭлементы() Цикл
+		
+		Если Не ПересчитыватьОтрицательные И Строка.Количество &lt; 0 Тогда
+			Продолжить;
+		КонецЕсли;	
+		
+		КоличествоДоИзменения = Строка.КоличествоНаПартию;
+		Строка.КоличествоНаПартию = Строка.КоличествоНаПартию*Коэффициент;
+		Если Строка.КоличествоНаПартию &lt; 0 И Строка.Количество &gt; 0 Тогда
+			Строка.Количество = -Строка.Количество;
+		ИначеЕсли Строка.КоличествоНаПартию &gt; 0 И Строка.Количество &lt; 0 Тогда
+			Строка.Количество = -Строка.Количество;
+		КонецЕсли;	
+		
+		Дельта = Строка.КоличествоНаПартию - КоличествоДоИзменения;
+		Если Строка.ВидСтроки = "ДетальнаяЗапись" Тогда
+			Если ТипЗнч(Строка.Этап) = Тип("СправочникСсылка.Номенклатура") Тогда
+				СтрокиМатериалов = Объект.СписокТехМатериалов.НайтиСтроки(Новый Структура("Объект, ЧастьБЭГА", Строка.Этап, Строка.ЧастьБЭГА));
+				СтрокиМатериалов[0].Количество = СтрокиМатериалов[0].Количество+Дельта;
+				СтрокиМатериалов[0].Сумма 	   = СтрокиМатериалов[0].Количество*СтрокиМатериалов[0].Расценка;
+			ИначеЕсли ТипЗнч(Строка.Этап) = Тип("СправочникСсылка.ВидыРаботСотрудников") Тогда
+				СтрокиРабот = Объект.СписокТехОпераций.НайтиСтроки(Новый Структура("Объект, ЧастьБЭГА", Строка.Этап, Строка.ЧастьБЭГА));
+				СтрокиРабот[0].Количество = СтрокиРабот[0].Количество+Дельта;
+				СтрокиРабот[0].Сумма 	  = СтрокиРабот[0].Количество*СтрокиРабот[0].Расценка;
+				Если СтрокиРабот[0].Сумма &lt; 0 Тогда
+					СтрокиРабот[0].Сумма = 0;
+				КонецЕсли;	
+			КонецЕсли;	
+		КонецЕсли;	
+		
+		ПересчитатьПодчиненныеСтрокиДереваПроизводство(Строка.ПолучитьИдентификатор(), Коэффициент)
+	КонецЦикла;
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ПересчитатьСуммыРодителей" nameInSecondConfiguration="ПересчитатьСуммыРодителей">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПереформироватьДокументы" nameInSecondConfiguration="ПереформироватьДокументы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПереформироватьДокументыВопросЗавершение" nameInSecondConfiguration="ПереформироватьДокументыВопросЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПереформироватьДокументыСервер" nameInSecondConfiguration="ПереформироватьДокументыСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПерфорированнаяНизПриИзменении" nameInSecondConfiguration="ПерфорированнаяНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПерфорированнаяПанельВерхПриИзменении" nameInSecondConfiguration="ПерфорированнаяПанельВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПерфорированнаяПанельНиз1ПриИзменении" nameInSecondConfiguration="ПерфорированнаяПанельНиз1ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПерфорированнаяПанельНиз2ПриИзменении" nameInSecondConfiguration="ПерфорированнаяПанельНиз2ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПерфорированнаяПанельНиз3ПриИзменении" nameInSecondConfiguration="ПерфорированнаяПанельНиз3ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПерфорированнаяПанельНиз4ПриИзменении" nameInSecondConfiguration="ПерфорированнаяПанельНиз4ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПерфорированнаяПриИзменении" nameInSecondConfiguration="ПерфорированнаяПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПерфорированнаяЮбкаНизПриИзменении" nameInSecondConfiguration="ПерфорированнаяЮбкаНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПерфорированныйКлапанВерхПриИзменении" nameInSecondConfiguration="ПерфорированныйКлапанВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПерфорированныйКлапанНизПриИзменении" nameInSecondConfiguration="ПерфорированныйКлапанНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьКлапанаДругоеПриИзменении" nameInSecondConfiguration="ПлотностьКлапанаДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьКлапанаНизДругоеПриИзменении" nameInSecondConfiguration="ПлотностьКлапанаНизДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьКлапанаНизПриИзменении" nameInSecondConfiguration="ПлотностьКлапанаНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьКлапанаПриИзменении" nameInSecondConfiguration="ПлотностьКлапанаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьКрышкиНизПриИзменении" nameInSecondConfiguration="ПлотностьКрышкиНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьПанелиДругоеПриИзменении" nameInSecondConfiguration="ПлотностьПанелиДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьПанелиНиз1ДругоеПриИзменении" nameInSecondConfiguration="ПлотностьПанелиНиз1ДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьПанелиНиз1ПриИзменении" nameInSecondConfiguration="ПлотностьПанелиНиз1ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьПанелиНиз2ДругоеПриИзменении" nameInSecondConfiguration="ПлотностьПанелиНиз2ДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьПанелиНиз2ПриИзменении" nameInSecondConfiguration="ПлотностьПанелиНиз2ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьПанелиНиз3ДругоеПриИзменении" nameInSecondConfiguration="ПлотностьПанелиНиз3ДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьПанелиНиз3ПриИзменении" nameInSecondConfiguration="ПлотностьПанелиНиз3ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьПанелиНиз4ДругоеПриИзменении" nameInSecondConfiguration="ПлотностьПанелиНиз4ДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьПанелиНиз4ПриИзменении" nameInSecondConfiguration="ПлотностьПанелиНиз4ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьПанелиПриИзменении" nameInSecondConfiguration="ПлотностьПанелиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьТканиПриИзменении" nameInSecondConfiguration="ПлотностьТканиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьТканиСтропыТуннельныеДругоеПриИзменении" nameInSecondConfiguration="ПлотностьТканиСтропыТуннельныеДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьТканиСтропыТуннельныеПриИзменении" nameInSecondConfiguration="ПлотностьТканиСтропыТуннельныеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьЮбкиНизДругоеПриИзменении" nameInSecondConfiguration="ПлотностьЮбкиНизДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьЮбкиНизПриИзменении" nameInSecondConfiguration="ПлотностьЮбкиНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлощадкаПриИзменении" nameInSecondConfiguration="ПлощадкаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПодборТехНитейДляСтроп" nameInSecondConfiguration="ПодборТехНитейДляСтроп">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="Подключаемый_ВыполнитьКоманду" nameInSecondConfiguration="Подключаемый_ВыполнитьКоманду">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="Подключаемый_ВыполнитьКомандуНаСервере" nameInSecondConfiguration="Подключаемый_ВыполнитьКомандуНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="Подключаемый_ВыполнитьПереопределяемуюКоманду" nameInSecondConfiguration="Подключаемый_ВыполнитьПереопределяемуюКоманду">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="Подключаемый_ОбновитьКоманды" nameInSecondConfiguration="Подключаемый_ОбновитьКоманды">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПодобратьСоздатьГотовуюПродукцию" nameInSecondConfiguration="ПодобратьСоздатьГотовуюПродукцию">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПодобратьСоздатьГотовуюПродукциюМногоэтапнаяСпецификация" nameInSecondConfiguration="ПодобратьСоздатьГотовуюПродукциюМногоэтапнаяСпецификация">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПодшитВерхПриИзменении" nameInSecondConfiguration="ПодшитВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПодшитНизПриИзменении" nameInSecondConfiguration="ПодшитНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПоказатьВыборЧастиБэгаЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,9 @@
 
+&amp;НаКлиенте
+Процедура ПоказатьВыборЧастиБэгаЗавершение(Результат, ДопПараметры) Экспорт
+
+	Если ТипЗнч(Результат) = Тип("СправочникСсылка.РУБЭГ_ЧастиБЭГОВ") Тогда
+		ОткрытьФорму("Справочник.Номенклатура.Форма.ФормаВыбора",,ЭтаФорма,,,,Новый ОписаниеОповещения("ДобавитьПолуфабрикатДоработкаЗавершение", ЭтаФорма, Результат));
+	КонецЕсли;	
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ПошивКомплектовкаПриИзменении" nameInSecondConfiguration="ПошивКомплектовкаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -3,9 +3,8 @@
 Процедура ПошивКомплектовкаПриИзменении(Элемент)
 	
 	УправлениеВидимостьюЭФ();
-	ФормированиеИмени();
-	
 	ОчиститьПродукциюИДеревоПроизводство();
 	ОчиститьМатериалыИРаботы();
+	ФормированиеИмени();
 	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="ПриЗаписиНаСервере" nameInSecondConfiguration="ПриЗаписиНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПриИзмененииНоменклатурыДереваМатериаловНаСервере" nameInSecondConfiguration="ПриИзмененииНоменклатурыДереваМатериаловНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПриОткрытии" nameInSecondConfiguration="ПриОткрытии">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПриСозданииНаСервере" nameInSecondConfiguration="ПриСозданииНаСервере">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch>@@ -102,4 +102,6 @@
 	
 	АдресДереваЗамен = ПоместитьВоВременноеХранилищеДеревоАналогов();
 	
+	мКоличествоАнкетыДоИзменения = Объект.Количество;
+	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="ПриСохраненииДанныхВНастройкахНаСервере" nameInSecondConfiguration="ПриСохраненииДанныхВНастройкахНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПриЧтенииНаСервере" nameInSecondConfiguration="ПриЧтенииНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПришивнойЛоготипПриИзменении" nameInSecondConfiguration="ПришивнойЛоготипПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПришивСтропыДоВерха4СтропыДругоеПриИзменении" nameInSecondConfiguration="ПришивСтропыДоВерха4СтропыДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПришивСтропыДоВерха4СтропыПриИзменении" nameInSecondConfiguration="ПришивСтропыДоВерха4СтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПроверитьВозможностьРедактирования" nameInSecondConfiguration="ПроверитьВозможностьРедактирования">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПроверитьЕдиницуХраненияОстатков" nameInSecondConfiguration="ПроверитьЕдиницуХраненияОстатков">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПроверитьЕдиницуХраненияОстатковНоменклатуры" nameInSecondConfiguration="ПроверитьЕдиницуХраненияОстатковНоменклатуры">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПроверитьПолуфабрикатыИИхСпецификации" nameInSecondConfiguration="ПроверитьПолуфабрикатыИИхСпецификации">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПровестиДокумент" nameInSecondConfiguration="ПровестиДокумент">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПровестиДокументНаСервере" nameInSecondConfiguration="ПровестиДокументНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПровестиИЗакрыть" nameInSecondConfiguration="ПровестиИЗакрыть">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПродукцияДоработкиНачалоВыбора">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,8 @@
 
+&amp;НаКлиенте
+Процедура ПродукцияДоработкиНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
+	
+	СтандартнаяОбработка = Ложь;
+	ОткрытьФорму("Справочник.Номенклатура.Форма.ФормаВыбора", Новый Структура("ИспользоватьХарактеристикиНоменклатуры", Истина), ЭтаФорма,,,, Новый ОписаниеОповещения("ВыборГотовойПродукцииЗавершение", ЭтаФорма));
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ПродукцияДоработкиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,11 @@
 
+&amp;НаКлиенте
+Процедура ПродукцияДоработкиПриИзменении(Элемент)
+	
+	СтрокаДерева = ДеревоПроизводство.ПолучитьЭлементы()[0];
+	СтрокаДерева.ВыходноеИзделие = Объект.Продукция;
+	СтрокаДерева.Этап 			 = Объект.Продукция;
+	СтрокаДерева.Артикул		 = АртикулОбъектаНаСервере(Объект.Продукция);
+	СтрокаДерева.Количество		 = Объект.Количество;
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ПродукцияСтрокойНажатие" nameInSecondConfiguration="ПродукцияСтрокойНажатие">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПроставитьЧастиБЭГОВДетальныхЗаписейДерева" nameInSecondConfiguration="ПроставитьЧастиБЭГОВДетальныхЗаписейДерева">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПрочитатьДеревоПроизводство" nameInSecondConfiguration="ПрочитатьДеревоПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -15,14 +15,22 @@
 			ДеревоЗначение.Колонки.Добавить("Проверен", Новый ОписаниеТипов("Булево"), "Проверен");
 		КонецЕсли;	
 		
-		//Если ДеревоЗначение.Колонки.Найти("Замена") = Неопределено Тогда
-		//	ДеревоЗначение.Колонки.Добавить("Замена", Новый ОписаниеТипов("СправочникСсылка.Номенклатура"), "Замена");
-		//КонецЕсли;	
+		Если ДеревоЗначение.Колонки.Найти("КоличествоНаПартию") = Неопределено Тогда
+			ДеревоЗначение.Колонки.Добавить("КоличествоНаПартию", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(15,3)), "Количество на партию");
+		КонецЕсли;	
 		
 		Если ДеревоЗначение.Колонки.Найти("Артикул") = Неопределено Тогда
 			ДеревоЗначение.Колонки.Добавить("Артикул", Новый ОписаниеТипов("Строка"), "Артикул");
 		КонецЕсли;	
 		
+		Если ДеревоЗначение.Колонки.Найти("ИдСтроки") = Неопределено Тогда
+			ДеревоЗначение.Колонки.Добавить("ИдСтроки", Новый ОписаниеТипов("УникальныйИдентификатор"));
+		КонецЕсли;	
+		
+		Если ДеревоЗначение.Колонки.Найти("ЭтоУзелДоработки") = Неопределено Тогда
+			ДеревоЗначение.Колонки.Добавить("ЭтоУзелДоработки", Новый ОписаниеТипов("Булево"));
+		КонецЕсли;	
+
 		Если ДеревоЗначение.Колонки.Найти("Замены") = Неопределено Тогда
 			ДеревоЗначение.Колонки.Добавить("Замены", Новый ОписаниеТипов("ТаблицаЗначений"), "Замены");
 		КонецЕсли;	
@@ -66,4 +74,4 @@
 	
 	ПереименоватьСтрокиПолуфабрикатовДереваПроизводство(ДеревоПроизводство);
 	
-КонецПроцедуры // ПрочитатьДеревоПроизводство()
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ПылезащитаПоВерхнемуКлапануУШПриИзменении" nameInSecondConfiguration="ПылезащитаПоВерхнемуКлапануУШПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПылезащитаПоВсемШвамУШПриИзменении" nameInSecondConfiguration="ПылезащитаПоВсемШвамУШПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПылезащитаПоНизуУШПриИзменении" nameInSecondConfiguration="ПылезащитаПоНизуУШПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПылезащитаПоСтропамУШПриИзменении" nameInSecondConfiguration="ПылезащитаПоСтропамУШПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РадугаСУсилениемСтропыРадугойПриИзменении" nameInSecondConfiguration="РадугаСУсилениемСтропыРадугойПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазмерКарман2ПриИзменении" nameInSecondConfiguration="РазмерКарман2ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазмерКарман3ПриИзменении" nameInSecondConfiguration="РазмерКарман3ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазмерКарман4ПриИзменении" nameInSecondConfiguration="РазмерКарман4ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазмерКарманДругое1ПриИзменении" nameInSecondConfiguration="РазмерКарманДругое1ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазмерКарманДругое2ПриИзменении" nameInSecondConfiguration="РазмерКарманДругое2ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазмерКарманДругое3ПриИзменении" nameInSecondConfiguration="РазмерКарманДругое3ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазмерКарманДругое4ПриИзменении" nameInSecondConfiguration="РазмерКарманДругое4ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазмерЛоготипаПриИзменении" nameInSecondConfiguration="РазмерЛоготипаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазметкаСтроп" nameInSecondConfiguration="РазметкаСтроп">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазобратьПолуфабрикат">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,37 @@
 
+&amp;НаКлиенте
+Процедура РазобратьПолуфабрикат(Команда)
+	
+	ДанныеСтроки = Элементы.ДеревоПроизводство.ТекущиеДанные;
+	Если ДанныеСтроки = Неопределено Тогда
+		Возврат;
+	КонецЕсли;	
+	
+	Для каждого СтрокаДерева Из ДеревоПроизводство.ПолучитьЭлементы() Цикл
+		
+		СтрокиДерева = СтрокаДерева.ПолучитьЭлементы();
+		Для каждого СтрокаДерева_1 Из СтрокиДерева Цикл
+			Если СтрокаДерева_1.ВидСтроки = "Материалы" Тогда
+				СтрокиДереваМатериалы = СтрокаДерева_1.ПолучитьЭлементы();
+			ИначеЕсли СтрокаДерева_1.ВидСтроки = "Работы" Тогда
+				СтрокиДереваРаботы = СтрокаДерева_1.ПолучитьЭлементы();
+			КонецЕсли;	
+		КонецЦикла;	
+		
+	КонецЦикла;
+	
+	Для каждого СтрокаТекущейВетки Из ДанныеСтроки.ПолучитьЭлементы() Цикл
+		Если СтрокаТекущейВетки.ВидСтроки = "Материалы" Тогда
+			СкопироватьСтрокиИсточникаВСтрокиПриемника(СтрокаТекущейВетки.ПолучитьЭлементы(), СтрокиДереваМатериалы);
+		ИначеЕсли СтрокаТекущейВетки.ВидСтроки = "Работы" Тогда
+			СкопироватьСтрокиИсточникаВСтрокиПриемника(СтрокаТекущейВетки.ПолучитьЭлементы(), СтрокиДереваРаботы);
+		ИначеЕсли СтрокаТекущейВетки.ВидСтроки = "Полуфабрикат" Тогда
+			НоваяСтрокаПолуфабрикат = СтрокиДерева.Добавить();
+			ЗаполнитьЗначенияСвойств(НоваяСтрокаПолуфабрикат, СтрокаТекущейВетки,,"Замены");
+			СкопироватьСтрокиИсточникаВСтрокиПриемника(СтрокаТекущейВетки.ПолучитьЭлементы(), НоваяСтрокаПолуфабрикат.ПолучитьЭлементы());
+		КонецЕсли;	
+	КонецЦикла;
+	
+	ДанныеСтроки.ПолучитьРодителя().ПолучитьЭлементы().Удалить(ДанныеСтроки);
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="РазузловатьСтрокиДерева" nameInSecondConfiguration="РазузловатьСтрокиДерева">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазузловатьСтрокиДереваЗамен" nameInSecondConfiguration="РазузловатьСтрокиДереваЗамен">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РаскрытьДеревоВидоРабот" nameInSecondConfiguration="РаскрытьДеревоВидоРабот">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РаскрытьДеревоТехМатериалов" nameInSecondConfiguration="РаскрытьДеревоТехМатериалов">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РасположениеКарман1ПриИзменении" nameInSecondConfiguration="РасположениеКарман1ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РасположениеКарман2ПриИзменении" nameInSecondConfiguration="РасположениеКарман2ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РасположениеКарман3ПриИзменении" nameInSecondConfiguration="РасположениеКарман3ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РасположениеКарман4ПриИзменении" nameInSecondConfiguration="РасположениеКарман4ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РасположениеСтропСтропыРадугойПриИзменении" nameInSecondConfiguration="РасположениеСтропСтропыРадугойПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РассчитатьВесСтропы" nameInSecondConfiguration="РассчитатьВесСтропы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РассчитатьЗавязки" nameInSecondConfiguration="РассчитатьЗавязки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РассчитатьСтоимостьКлишеЛоготип" nameInSecondConfiguration="РассчитатьСтоимостьКлишеЛоготип">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РассчитатьСтрокуТЧНитейДляСтропы" nameInSecondConfiguration="РассчитатьСтрокуТЧНитейДляСтропы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РассчитатьСтропу" nameInSecondConfiguration="РассчитатьСтропу">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РасчетСтропЦветСтропыПриИзменении" nameInSecondConfiguration="РасчетСтропЦветСтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойДобавкойКлапанВерхПриИзменении" nameInSecondConfiguration="САнтистатическойДобавкойКлапанВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойДобавкойКлапанНизПриИзменении" nameInSecondConfiguration="САнтистатическойДобавкойКлапанНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойДобавкойНизПриИзменении" nameInSecondConfiguration="САнтистатическойДобавкойНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойДобавкойПанельВерхПриИзменении" nameInSecondConfiguration="САнтистатическойДобавкойПанельВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойДобавкойПанельНиз1ПриИзменении" nameInSecondConfiguration="САнтистатическойДобавкойПанельНиз1ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойДобавкойПанельНиз2ПриИзменении" nameInSecondConfiguration="САнтистатическойДобавкойПанельНиз2ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойДобавкойПанельНиз3ПриИзменении" nameInSecondConfiguration="САнтистатическойДобавкойПанельНиз3ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойДобавкойПанельНиз4ПриИзменении" nameInSecondConfiguration="САнтистатическойДобавкойПанельНиз4ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойДобавкойЮбкаНизПриИзменении" nameInSecondConfiguration="САнтистатическойДобавкойЮбкаНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойНитьюВерхКлапанПриИзменении" nameInSecondConfiguration="САнтистатическойНитьюВерхКлапанПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойНитьюКлапанНизПриИзменении" nameInSecondConfiguration="САнтистатическойНитьюКлапанНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойНитьюНизПриИзменении" nameInSecondConfiguration="САнтистатическойНитьюНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойНитьюПанельВерхПриИзменении" nameInSecondConfiguration="САнтистатическойНитьюПанельВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойНитьюПанельНиз1ПриИзменении" nameInSecondConfiguration="САнтистатическойНитьюПанельНиз1ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойНитьюПанельНиз2ПриИзменении" nameInSecondConfiguration="САнтистатическойНитьюПанельНиз2ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойНитьюПанельНиз3ПриИзменении" nameInSecondConfiguration="САнтистатическойНитьюПанельНиз3ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойНитьюПанельНиз4ПриИзменении" nameInSecondConfiguration="САнтистатическойНитьюПанельНиз4ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="САнтистатическойНитьюЮбкаНизПриИзменении" nameInSecondConfiguration="САнтистатическойНитьюЮбкаНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СЗащитнымУстройствомВерхПриИзменении" nameInSecondConfiguration="СЗащитнымУстройствомВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СкопироватьДеревоУзлаВДеревоПроизводство" nameInSecondConfiguration="СкопироватьДеревоУзлаВДеревоПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СкопироватьСтрокиИсточникаВСтрокиПриемника" nameInSecondConfiguration="СкопироватьСтрокиИсточникаВСтрокиПриемника">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СкопироватьТекущийУзелВДерево" nameInSecondConfiguration="СкопироватьТекущийУзелВДерево">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СЛипучкамиВерхПриИзменении" nameInSecondConfiguration="СЛипучкамиВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СЛипучкамиНизПриИзменении" nameInSecondConfiguration="СЛипучкамиНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьГотовуюПродукцию" nameInSecondConfiguration="СоздатьГотовуюПродукцию">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -23,7 +23,8 @@
 	Отказ = Ложь;
 	СтрокиДереваПроизводство = ДеревоПроизводство.ПолучитьЭлементы();
 	ОбнулитьПодобранныеСтроки();
-	ОтметитьПодбранныеМатериалыИРаботыСервер(СтрокиДереваПроизводство[0].ПолучитьИдентификатор(),Отказ);
+	ОтметитьПодбранныеМатериалыИРаботыСервер(,Отказ);
+	ПроверитьПолуфабрикатыИИхСпецификации(Отказ);
 	Если Отказ Тогда
 		Возврат;
 	КонецЕсли;	
</Patch>
								</Method>
								<Method name="СоздатьЗаготовкуЛоготип" nameInSecondConfiguration="СоздатьЗаготовкуЛоготип">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьЗаготовкуЛоготипНаСервере" nameInSecondConfiguration="СоздатьЗаготовкуЛоготипНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьЗаказПокупателяНаОсновании" nameInSecondConfiguration="СоздатьЗаказПокупателяНаОсновании">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьЗаказПокупателяНаОснованииНаСервере" nameInSecondConfiguration="СоздатьЗаказПокупателяНаОснованииНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьНовуюПозициюПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,8 @@
 
+&amp;НаКлиенте
+Процедура СоздатьНовуюПозициюПриИзменении(Элемент)
+	
+	УправлениеВидимостьюЭФ();
+	ФормированиеИмени();
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="СоздатьНовуюПозициюПродукцииСпецификации" nameInSecondConfiguration="СоздатьНовуюПозициюПродукцииСпецификации">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьНовуюПозициюСпецификации" nameInSecondConfiguration="СоздатьНовуюПозициюСпецификации">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -51,25 +51,32 @@
 	Если ДанныеСтроки = Неопределено Тогда //это замены
 		СтрокаСпецификации.Количество		  = Объект.Количество;
 		СтрокаСпецификации.КоличествоУпаковок = Объект.Количество;
+	ИначеЕсли Объект.ПошивКомплектовка = "Доработка" Тогда
+		СтрокаСпецификации.Количество 		  = Объект.Количество;
+		СтрокаСпецификации.КоличествоУпаковок = Объект.Количество;
 	Иначе
 		СтрокаСпецификации.Количество		  = 1;
 		СтрокаСпецификации.КоличествоУпаковок = 1;
 	КонецЕсли;	
 	
 	Для каждого СтрокаТЧ Из ТаблицаМатериалов Цикл
-		СтрокаСпецификации = ЭлементСпецификация.МатериалыИУслуги.Добавить();
+		Если СтрокаТЧ.Количество &lt; 0 Тогда
+			СтрокаСпецификации = ЭлементСпецификация.ВозвратныеОтходы.Добавить();
+			СтрокаТЧ.Количество = - СтрокаТЧ.Количество;
+		Иначе
+			СтрокаСпецификации = ЭлементСпецификация.МатериалыИУслуги.Добавить();
+			СтрокаСпецификации.СпособПолученияМатериала		  = Перечисления.СпособыПолученияМатериаловВСпецификации.Обеспечивать;
+			СтрокаСпецификации.ИсточникПолученияПолуфабриката = Справочники.РесурсныеСпецификации.ПустаяСсылка();
+			СтрокаСпецификации.ПроизводитсяВПроцессе		  = Истина;
+		КонецЕсли;	
 		СтрокаСпецификации.Номенклатура 	 			  = СтрокаТЧ.Объект;
 		СтрокаСпецификации.Количество   	 			  = СтрокаТЧ.Количество;
 		СтрокаСпецификации.КоличествоУпаковок			  = СтрокаТЧ.Количество;
 		СтрокаСпецификации.СтатьяКалькуляции 			  = СтатьяКалькуляцииМатериалы;
 		СтрокаСпецификации.СпособАвтовыбораХарактеристики = Перечисления.СпособыАвтовыбораХарактеристики.УточняетсяПриПроизводстве;
-		СтрокаСпецификации.СпособПолученияМатериала		  = Перечисления.СпособыПолученияМатериаловВСпецификации.Обеспечивать;
 		
 		Если ЗначениеЗаполнено(СтрокаТЧ.СпособПолученияМатериала) Тогда
 			СтрокаСпецификации.СтатьяКалькуляции 			  = Справочники.СтатьиКалькуляции.ПолуфабрикатыПроизводимыеВПроцессе;
-			СтрокаСпецификации.СпособПолученияМатериала		  = Перечисления.СпособыПолученияМатериаловВСпецификации.ПроизвестиПоСпецификации;
-			СтрокаСпецификации.ИсточникПолученияПолуфабриката = Справочники.РесурсныеСпецификации.ПустаяСсылка();
-			СтрокаСпецификации.ПроизводитсяВПроцессе		  = Истина;
 			СтрокаСпецификации.СпособАвтовыбораНоменклатуры   = Перечисления.СпособыАвтовыбораНоменклатуры.УказываетсяВНСИ;
 			СтрокаСпецификации.СпособАвтовыбораХарактеристики = Перечисления.СпособыАвтовыбораХарактеристики.УказываетсяВНСИ;	
 		КонецЕсли;	
@@ -124,4 +131,4 @@
 		Объект.СпецификацияЗамены = ЭлементСпецификация.Ссылка;
 	КонецЕсли;
 
-КонецПроцедуры // СоздатьНовуюПозициюСпецификации(ГруппаПродукции, СтруктураЗаполненныхЭлементовФормы, ТаблицаМатериалов, ТаблицаРабот, ДанныеСтроки);()
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="СоздатьНовуюПродукцию" nameInSecondConfiguration="СоздатьНовуюПродукцию">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьПолуфабрикат" nameInSecondConfiguration="СоздатьПолуфабрикат">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьПродукцию" nameInSecondConfiguration="СоздатьПродукцию">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьПродукциюПолуфабрикат" nameInSecondConfiguration="СоздатьПродукциюПолуфабрикат">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -19,7 +19,7 @@
 		
 		Если СтрокаДерева_1.ВидСтроки = "Полуфабрикат" Тогда
 			
-			Если СтрокаДерева_1.Количество &gt; 0 Тогда
+			Если СтрокаДерева_1.Количество &lt;&gt; 0 Тогда
 				СтрокаТЗ = ТаблицаМатериалов.Добавить();
 				СтрокаТЗ.Объект 	       = СтрокаДерева_1.ВыходноеИзделие;
 				СтрокаТЗ.Количество 	   = СтрокаДерева_1.Количество;
@@ -40,7 +40,7 @@
 		ИначеЕсли СтрокаДерева_1.ВидСтроки = "Материалы" Тогда
 			
 			Для каждого СтрокаДерева_2 Из СтрокаДерева_1.ПолучитьЭлементы() Цикл
-				Если СтрокаДерева_2.Количество &gt; 0 Тогда
+				Если СтрокаДерева_2.Количество &lt;&gt; 0 Тогда
 					СтрокаТЗ = ТаблицаМатериалов.Добавить();
 					СтрокаТЗ.Объект 	       = СтрокаДерева_2.Этап;
 					СтрокаТЗ.Количество 	   = СтрокаДерева_2.Количество;
@@ -51,7 +51,7 @@
 		ИначеЕсли СтрокаДерева_1.ВидСтроки = "Работы" Тогда
 			
 			Для каждого СтрокаДерева_2 Из СтрокаДерева_1.ПолучитьЭлементы() Цикл
-				Если СтрокаДерева_2.Количество &gt; 0 Тогда
+				Если СтрокаДерева_2.Количество &lt;&gt; 0 Тогда
 					СтрокаТЗ = ТаблицаРабот.Добавить();
 					СтрокаТЗ.Объект 	       = СтрокаДерева_2.Этап;
 					СтрокаТЗ.Количество 	   = СтрокаДерева_2.Количество;
@@ -163,7 +163,9 @@
 		НоменклатураСсылка = Справочники.Номенклатура.НайтиПоНаименованию(НаименованиеПродукции);
 		Если ЗначениеЗаполнено(НоменклатураСсылка) Тогда
 			Номенклатура = НоменклатураСсылка;
-		КонецЕсли;	
+		КонецЕсли;
+	ИначеЕсли Объект.ПошивКомплектовка = "Доработка" Тогда
+		Номенклатура = Объект.Продукция
 	Иначе
 		Выборка = Запрос.Выполнить().Выбрать();
 		Пока Выборка.Следующий() Цикл
@@ -239,7 +241,7 @@
 		Возврат;
 	КонецЕсли;	
 	
-	Если Объект.ПошивКомплектовка &lt;&gt; "Комплектовка" Тогда //Обновить тэги
+	Если Объект.ПошивКомплектовка &lt;&gt; "Комплектовка" И Объект.ПошивКомплектовка &lt;&gt; "Доработка" Тогда //Обновить тэги
 		ОбъектНоменклатура = Номенклатура.ПолучитьОбъект();
 		УстановитьТеги(ОбъектНоменклатура,"", СтруктураЗаполненныхЭлементовФормы);
 		ОбъектНоменклатура.Записать();
</Patch>
								</Method>
								<Method name="СоздатьСпецификациюДавальца" nameInSecondConfiguration="СоздатьСпецификациюДавальца">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьСпецификациюЗамены" nameInSecondConfiguration="СоздатьСпецификациюЗамены">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьСпецификациюЗаменыДавальца" nameInSecondConfiguration="СоздатьСпецификациюЗаменыДавальца">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьСпецификациюЗаменыСервер" nameInSecondConfiguration="СоздатьСпецификациюЗаменыСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокВыбораЦветовСтроп" nameInSecondConfiguration="СписокВыбораЦветовСтроп">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокТехМатериаловКоличествоПриИзменении" nameInSecondConfiguration="СписокТехМатериаловКоличествоПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокТехМатериаловНоменклатураПриИзменении" nameInSecondConfiguration="СписокТехМатериаловНоменклатураПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокТехМатериаловПередНачаломДобавления" nameInSecondConfiguration="СписокТехМатериаловПередНачаломДобавления">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокТехМатериаловПередОкончаниемРедактирования">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,9 @@
 
+&amp;НаКлиенте
+Процедура СписокТехМатериаловПередОкончаниемРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования, Отказ)
+	
+	Если НоваяСтрока Тогда
+		Элемент.ТекущиеДанные.ИдСтроки = Новый УникальныйИдентификатор;
+	КонецЕсли;	
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="СписокТехМатериаловПередУдалением" nameInSecondConfiguration="СписокТехМатериаловПередУдалением">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокТехМатериаловПриИзменении" nameInSecondConfiguration="СписокТехМатериаловПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -13,6 +13,7 @@
 	Если ЗначениеЗаполнено(Элемент.ТекущиеДанные.ЧастьБЭГА) Тогда
 		ТабличнаяЧастьВДеревоТехМатериалов("СписокТехМатериалов");
 		РаскрытьДеревоТехМатериалов();
+		ОтметитьПодбранныеМатериалыИРаботы();
 	КонецЕсли;	
 	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="СписокТехМатериаловПроизводствоНачалоПеретаскивания" nameInSecondConfiguration="СписокТехМатериаловПроизводствоНачалоПеретаскивания">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокТехМатериаловПроизводствоОкончаниеПеретаскивания" nameInSecondConfiguration="СписокТехМатериаловПроизводствоОкончаниеПеретаскивания">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокТехМатериаловЧастьБЭГАПриИзменении" nameInSecondConfiguration="СписокТехМатериаловЧастьБЭГАПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокТехОперацийКоличествоПриИзменении" nameInSecondConfiguration="СписокТехОперацийКоличествоПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокТехОперацийПередНачаломДобавления" nameInSecondConfiguration="СписокТехОперацийПередНачаломДобавления">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокТехОперацийПередОкончаниемРедактирования">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,9 @@
 
+&amp;НаКлиенте
+Процедура СписокТехОперацийПередОкончаниемРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования, Отказ)
+	
+	Если НоваяСтрока Тогда
+		Элемент.ТекущиеДанные.ИдСтроки = Новый УникальныйИдентификатор;
+	КонецЕсли;	
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="СписокТехОперацийПередУдалением" nameInSecondConfiguration="СписокТехОперацийПередУдалением">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокТехОперацийПриИзменении" nameInSecondConfiguration="СписокТехОперацийПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -13,6 +13,7 @@
 	Если ЗначениеЗаполнено(Элемент.ТекущиеДанные.ЧастьБЭГА) Тогда
 		ТабличнаяЧастьВДеревоВидовРабот("СписокТехОпераций");
 		РаскрытьДеревоВидоРабот();
+		ОтметитьПодбранныеМатериалыИРаботы();
 	КонецЕсли;	
 	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="СписокТехОперацийТехнологическаяОперацияПриИзменении" nameInSecondConfiguration="СписокТехОперацийТехнологическаяОперацияПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокТехОперацийЧастьБЭГАПриИзменении" nameInSecondConfiguration="СписокТехОперацийЧастьБЭГАПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СтоимостьКлишеЛоготипПриИзменении" nameInSecondConfiguration="СтоимостьКлишеЛоготипПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СтоимостьСантиметраКлишеПриИзменении" nameInSecondConfiguration="СтоимостьСантиметраКлишеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СтруктураПодчиненности" nameInSecondConfiguration="СтруктураПодчиненности">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТаблицаНезаполненныхРеквизитовВыбор" nameInSecondConfiguration="ТаблицаНезаполненныхРеквизитовВыбор">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТаблицаНезаполненныхРеквизитовЗаголовокНачалоВыбора" nameInSecondConfiguration="ТаблицаНезаполненныхРеквизитовЗаголовокНачалоВыбора">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТабличнаяЧастьВДеревоВидовРабот" nameInSecondConfiguration="ТабличнаяЧастьВДеревоВидовРабот">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -11,7 +11,8 @@
 	|	СписокРаботv11.КоличествоПодобрано КАК КоличествоПодобрано,
 	|	СписокРаботv11.Расценка КАК Расценка,
 	|	СписокРаботv11.ЦветаКрасок КАК ЦветаКрасок,
-	|	СписокРаботv11.Сумма КАК Сумма
+	|	СписокРаботv11.Сумма КАК Сумма,
+	|	СписокРаботv11.ИдСтроки КАК ИдСтроки
 	|ПОМЕСТИТЬ #ДанныеТабличнойЧасти
 	|ИЗ
 	|	&amp;ТаблицаДокумента КАК СписокРаботv11
@@ -28,7 +29,8 @@
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.Расценка, 0) КАК Расценка,
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ЦветаКрасок, """") КАК ЦветаКрасок,
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.Сумма, 0) КАК Сумма,
-	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ЧастьБЭГА.Порядок, РУБЭГ_ЧастиБЭГОВ.Порядок) КАК Сортировка
+	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ЧастьБЭГА.Порядок, РУБЭГ_ЧастиБЭГОВ.Порядок) КАК Сортировка,
+	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ИдСтроки, """") КАК ИдСтроки
 	|ИЗ
 	|	#ДанныеТабличнойЧасти КАК ДанныеТабличнойЧасти
 	|		ПОЛНОЕ СОЕДИНЕНИЕ Справочник.РУБЭГ_ЧастиБЭГОВ КАК РУБЭГ_ЧастиБЭГОВ
</Patch>
								</Method>
								<Method name="ТабличнаяЧастьВДеревоТехМатериалов" nameInSecondConfiguration="ТабличнаяЧастьВДеревоТехМатериалов">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -12,7 +12,8 @@
 	|	Числа_НоваяАнкетаСписокТехМатериаловNew.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
 	|	Числа_НоваяАнкетаСписокТехМатериаловNew.Расценка КАК Расценка,
 	|	Числа_НоваяАнкетаСписокТехМатериаловNew.ЦветаКрасок КАК ЦветаКрасок,
-	|	Числа_НоваяАнкетаСписокТехМатериаловNew.Сумма КАК Сумма
+	|	Числа_НоваяАнкетаСписокТехМатериаловNew.Сумма КАК Сумма,
+	|	Числа_НоваяАнкетаСписокТехМатериаловNew.ИдСтроки КАК ИдСтроки
 	|ПОМЕСТИТЬ #ДанныеТабличнойЧасти
 	|ИЗ
 	|	&amp;ТаблицаДокумента КАК Числа_НоваяАнкетаСписокТехМатериаловNew
@@ -29,7 +30,8 @@
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.Расценка, 0) КАК Расценка,
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ЦветаКрасок, """") КАК ЦветаКрасок,
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.Сумма, 0) КАК Сумма,
-	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ЧастьБЭГА.Порядок, РУБЭГ_ЧастиБЭГОВ.Порядок) КАК Сортировка
+	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ЧастьБЭГА.Порядок, РУБЭГ_ЧастиБЭГОВ.Порядок) КАК Сортировка,
+	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ИдСтроки, """") КАК ИдСтроки
 	|ИЗ
 	|	#ДанныеТабличнойЧасти КАК ДанныеТабличнойЧасти
 	|		ПОЛНОЕ СОЕДИНЕНИЕ Справочник.РУБЭГ_ЧастиБЭГОВ КАК РУБЭГ_ЧастиБЭГОВ
</Patch>
								</Method>
								<Method name="ТипВерхаПриИзменении" nameInSecondConfiguration="ТипВерхаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТипНизаПриИзменении" nameInSecondConfiguration="ТипНизаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТипНити1РукиПриИзменении" nameInSecondConfiguration="ТипНити1РукиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТипНити2РукиПриИзменении" nameInSecondConfiguration="ТипНити2РукиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТипРасположенияКарман1ПриИзменении" nameInSecondConfiguration="ТипРасположенияКарман1ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТипРасположенияКарман2ПриИзменении" nameInSecondConfiguration="ТипРасположенияКарман2ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТипРасположенияКарман3ПриИзменении" nameInSecondConfiguration="ТипРасположенияКарман3ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТипРасположенияКарман4ПриИзменении" nameInSecondConfiguration="ТипРасположенияКарман4ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТипТканиПриИзменении" nameInSecondConfiguration="ТипТканиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТипТканиПриИзмененииНаСервере" nameInSecondConfiguration="ТипТканиПриИзмененииНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТипШваПриИзменении" nameInSecondConfiguration="ТипШваПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТолькоПроизводство" nameInSecondConfiguration="ТолькоПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УдалитьМатериалыИРаботыУдаляемойСтроки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,71 @@
 
+&amp;НаСервере
+Процедура УдалитьМатериалыИРаботыУдаляемойСтроки(ИдСтроки, СтрокиКУдалениюМатериалы, СтрокиКУдалениюРаботы)
+	
+	УдаляемаяСтрока = ДеревоПроизводство.НайтиПоИдентификатору(ИдСтроки);
+	
+	Для каждого Строка Из УдаляемаяСтрока.ПолучитьЭлементы() Цикл
+		
+		Если Строка.ВидСтроки = "ДетальнаяЗапись" Тогда
+			
+			Если ТипЗнч(Строка.Этап) = Тип("СправочникСсылка.Номенклатура") Тогда
+				
+				СтрокиМатериалов = Объект.СписокТехМатериалов.НайтиСтроки(Новый Структура("Объект, ЧастьБЭГА, ИдСтроки", Строка.Этап, Строка.ЧастьБЭГА, Строка.ИдСтроки));
+				Если СтрокиМатериалов.Количество() Тогда
+					СтрокаМатериалов = СтрокиМатериалов[0];
+					СтрокаМатериалов.Количество = СтрокаМатериалов.Количество - Строка.КоличествоНаПартию;
+					СтрокаМатериалов.Сумма = СтрокаМатериалов.Количество*СтрокаМатериалов.Расценка;
+					Если СтрокаМатериалов.Количество = 0 Тогда
+						СтрокиКУдалениюМатериалы.Добавить(СтрокаМатериалов);
+					КонецЕсли;	
+				КонецЕсли;	
+				
+			ИначеЕсли ТипЗнч(Строка.Этап) = Тип("СправочникСсылка.ВидыРаботСотрудников") Тогда
+				
+				СтрокиРабот = Объект.СписокТехОпераций.НайтиСтроки(Новый Структура("Объект, ЧастьБЭГА, ИдСтроки", Строка.Этап, Строка.ЧастьБЭГА, Строка.ИдСтроки));
+				Если СтрокиРабот.Количество() Тогда
+					СтрокаРабот = СтрокиРабот[0];
+					СтрокаРабот.Количество = СтрокаРабот.Количество - Строка.КоличествоНаПартию;
+					СтрокаРабот.Сумма = СтрокаРабот.Количество*СтрокаРабот.Расценка;
+					Если СтрокаРабот.Количество = 0 Тогда
+						СтрокиКУдалениюРаботы.Добавить(СтрокаРабот);
+					КонецЕсли;	
+				КонецЕсли;	
+				
+			КонецЕсли;	
+		КонецЕсли;	
+		
+		УдалитьМатериалыИРаботыУдаляемойСтроки(Строка.ПолучитьИдентификатор(), СтрокиКУдалениюМатериалы, СтрокиКУдалениюРаботы);
+		
+	КонецЦикла;
+	
+	Если УдаляемаяСтрока.ВидСтроки = "ДетальнаяЗапись" Тогда
+		
+		Если ТипЗнч(УдаляемаяСтрока.Этап) = Тип("СправочникСсылка.Номенклатура") Тогда
+			
+			СтрокиМатериалов = Объект.СписокТехМатериалов.НайтиСтроки(Новый Структура("Объект, ЧастьБЭГА, ИдСтроки", УдаляемаяСтрока.Этап, УдаляемаяСтрока.ЧастьБЭГА, УдаляемаяСтрока.ИдСтроки));
+			Если СтрокиМатериалов.Количество() Тогда
+				СтрокаМатериалов = СтрокиМатериалов[0];
+				СтрокаМатериалов.Количество = СтрокаМатериалов.Количество - УдаляемаяСтрока.КоличествоНаПартию;
+				СтрокаМатериалов.Сумма = СтрокаМатериалов.Количество*СтрокаМатериалов.Расценка;
+				Если СтрокаМатериалов.Количество = 0 Тогда
+					СтрокиКУдалениюМатериалы.Добавить(СтрокаМатериалов);
+				КонецЕсли;	
+			КонецЕсли;	
+			
+		ИначеЕсли ТипЗнч(УдаляемаяСтрока.Этап) = Тип("СправочникСсылка.ВидыРаботСотрудников") Тогда
+			
+			СтрокиРабот = Объект.СписокТехОпераций.НайтиСтроки(Новый Структура("Объект, ЧастьБЭГА, ИдСтроки", УдаляемаяСтрока.Этап, УдаляемаяСтрока.ЧастьБЭГА, УдаляемаяСтрока.ИдСтроки));
+			Если СтрокиРабот.Количество() Тогда
+				СтрокаРабот = СтрокиРабот[0];
+				СтрокаРабот.Количество = СтрокаРабот.Количество - УдаляемаяСтрока.КоличествоНаПартию;
+				СтрокаРабот.Сумма = СтрокаРабот.Количество*СтрокаРабот.Расценка;
+				Если СтрокаРабот.Количество = 0 Тогда
+					СтрокиКУдалениюРаботы.Добавить(СтрокаРабот);
+				КонецЕсли;	
+			КонецЕсли;	
+			
+		КонецЕсли;	
+	КонецЕсли;	
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="Удлинение4СтропыЧерезУголПриИзменении" nameInSecondConfiguration="Удлинение4СтропыЧерезУголПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УдлиннениеДлинаКольцаПриИзменении" nameInSecondConfiguration="УдлиннениеДлинаКольцаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УдлиннениеПриИзменении" nameInSecondConfiguration="УдлиннениеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УпаковкаВариантПриИзменении" nameInSecondConfiguration="УпаковкаВариантПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -2,6 +2,10 @@
 &amp;НаКлиенте
 Процедура УпаковкаВариантПриИзменении(Элемент)
 	
+	Если Объект.ПошивКомплектовка = "Доработка" Тогда
+		ЗаполнитьМатериалыУпаковкиДляДоработки(ВыделенныйТекстЭлементовФормы());
+		РаскрытьДеревоТехМатериалов();
+	КонецЕсли;	
 	ФормированиеИмени();
 	УправлениеВидимостьюЭФГруппаУпаковка();
 	
</Patch>
								</Method>
								<Method name="УпаковкаМатериалПриИзменении" nameInSecondConfiguration="УпаковкаМатериалПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УправлениеВидимостьюЭФ" nameInSecondConfiguration="УправлениеВидимостьюЭФ">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -14,7 +14,7 @@
 	Элементы.ГруппаКарманДляДокументов.Видимость = Объект.ПошивКомплектовка = "Пошив" Или Объект.ПошивКомплектовка = "ПошивКомплектовка";
 	Элементы.ГруппаЛоготип.Видимость	 		 = Объект.ПошивКомплектовка = "Пошив" Или Объект.ПошивКомплектовка = "ПошивКомплектовка";
 	Элементы.ГруппаУплотнительныйШнур.Видимость  = Объект.ПошивКомплектовка = "Пошив" Или Объект.ПошивКомплектовка = "ПошивКомплектовка";
-	Элементы.ГруппаУпаковка.Видимость 			 = Объект.ПошивКомплектовка = "Пошив" Или Объект.ПошивКомплектовка = "ПошивКомплектовка" Или Объект.ПошивКомплектовка = "Комплектовка" ;
+	Элементы.ГруппаУпаковка.Видимость 			 = Объект.ПошивКомплектовка = "Пошив" Или Объект.ПошивКомплектовка = "ПошивКомплектовка" Или Объект.ПошивКомплектовка = "Комплектовка" Или Объект.ПошивКомплектовка = "Доработка";
 	Элементы.Комплектующие.Видимость 			 = Объект.ПошивКомплектовка = "Комплектовка" Или Объект.ПошивКомплектовка = "ПошивКомплектовка";
 	Элементы.ГруппаРасчетСтроп.Видимость		 = Объект.ПошивКомплектовка = "РасчетСтроп";
 	
@@ -61,6 +61,10 @@
 	Элементы.ЦветНити1Руки.Видимость = Объект.ПошивКомплектовка = "Пошив" Или Объект.ПошивКомплектовка = "ПошивКомплектовка";
 	Элементы.ЦветНити2Руки.Видимость = Объект.ПошивКомплектовка = "Пошив" Или Объект.ПошивКомплектовка = "ПошивКомплектовка";
 	
+	Элементы.СоздатьНовуюПозицию.Видимость = Объект.ПошивКомплектовка = "Доработка";
+	Элементы.ПродукцияДоработки.Видимость  = Объект.ПошивКомплектовка = "Доработка";
+	Элементы.ДеревоПроизводствоДобавитьПолуфабрикатДоработка.Видимость = Объект.ПошивКомплектовка = "Доработка";
+	
 	#Область УправлениеВидимостьюУплотнительныйШнур
 	
 	
</Patch>
								</Method>
								<Method name="УправлениеВидимостьюЭФВерх" nameInSecondConfiguration="УправлениеВидимостьюЭФВерх">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УправлениеВидимостьюЭФГруппаЛоготип" nameInSecondConfiguration="УправлениеВидимостьюЭФГруппаЛоготип">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УправлениеВидимостьюЭФГруппаСтропы" nameInSecondConfiguration="УправлениеВидимостьюЭФГруппаСтропы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УправлениеВидимостьюЭФГруппаУлотнительныйШнур" nameInSecondConfiguration="УправлениеВидимостьюЭФГруппаУлотнительныйШнур">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УправлениеВидимостьюЭФГруппаУпаковка" nameInSecondConfiguration="УправлениеВидимостьюЭФГруппаУпаковка">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УправлениеВидимостьюЭФНиз" nameInSecondConfiguration="УправлениеВидимостьюЭФНиз">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УправлениеДоступностьюЭФ" nameInSecondConfiguration="УправлениеДоступностьюЭФ">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УстановитьОбменДанными" nameInSecondConfiguration="УстановитьОбменДанными">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УстановитьПризнакНеактуальностиУРодительскойСтроки" nameInSecondConfiguration="УстановитьПризнакНеактуальностиУРодительскойСтроки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -3,9 +3,17 @@
 
 	СтрокаДерева = ДеревоПроизводство.НайтиПоИдентификатору(ИдСтрокиДерева);
 	СтрокаРодитель = СтрокаДерева.ПолучитьРодителя();
-	Если СтрокаРодитель.ВидСтроки = "Полуфабрикат" Или СтрокаРодитель.ВидСтроки = "Этап" Тогда
-		СтрокаРодитель.СтрокаНеактуальна = Истина;
-	КонецЕсли;	
+	Если Объект.ПошивКомплектовка = "Доработка" Тогда
+		Если СтрокаРодитель.ВидСтроки = "Полуфабрикат" Тогда
+			СтрокаРодитель.СтрокаНеактуальна = Истина;
+			СтрокаРодитель.ВыходноеИзделие = "";
+			СтрокаРодитель.Этап = "Полуфабрикат &lt;..&gt;";
+		КонецЕсли;	
+	Иначе
+		Если СтрокаРодитель.ВидСтроки = "Полуфабрикат" Или СтрокаРодитель.ВидСтроки = "Этап" Тогда
+			СтрокаРодитель.СтрокаНеактуальна = Истина;
+		КонецЕсли;	
+	КонецЕсли;
 	
 	РодительРодителя = СтрокаРодитель.ПолучитьРодителя();
 	Если РодительРодителя &lt;&gt; Неопределено Тогда
</Patch>
								</Method>
								<Method name="УстановитьРеквизитКодДляКомплектующих" nameInSecondConfiguration="УстановитьРеквизитКодДляКомплектующих">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УстановитьТег" nameInSecondConfiguration="УстановитьТег">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УстановитьТеги" nameInSecondConfiguration="УстановитьТеги">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УхоСверхуРазмер4СтропыДругоеПриИзменении" nameInSecondConfiguration="УхоСверхуРазмер4СтропыДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УхоСверхуРазмер4СтропыПриИзменении" nameInSecondConfiguration="УхоСверхуРазмер4СтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УхоСверхуРазмер4СтропыЧерезУголДругоеПриИзменении" nameInSecondConfiguration="УхоСверхуРазмер4СтропыЧерезУголДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УхоСверхуРазмер4СтропыЧерезУголПриИзменении" nameInSecondConfiguration="УхоСверхуРазмер4СтропыЧерезУголПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УхоСверхуСусилением4СтропыПриИзменении" nameInSecondConfiguration="УхоСверхуСусилением4СтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УхоСверхуСУсилением4СтропыЧерезУголПриИзменении" nameInSecondConfiguration="УхоСверхуСУсилением4СтропыЧерезУголПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УхоСнизуКоличество4СтропыПриИзменении" nameInSecondConfiguration="УхоСнизуКоличество4СтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УхоСнизуРазмер4СтропыДругоеПриИзменении" nameInSecondConfiguration="УхоСнизуРазмер4СтропыДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УхоСнизуРазмер4СтропыПриИзменении" nameInSecondConfiguration="УхоСнизуРазмер4СтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УхоСнизуРасположение4СтропыПриИзменении" nameInSecondConfiguration="УхоСнизуРасположение4СтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УхоСнизуСУсилением4СтропыПриИзменении" nameInSecondConfiguration="УхоСнизуСУсилением4СтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УхоСтропыПриИзменении" nameInSecondConfiguration="УхоСтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ФормированиеИмени" nameInSecondConfiguration="ФормированиеИмени">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -338,6 +338,16 @@
 	ИначеЕсли Объект.ПошивКомплектовка = "РасчетСтроп" Тогда
 		НаименованиеПродукции = "Стропа "+Объект.ШиринаСтропыРасчет+"см "+Формат(Объект.ГрузоподъемностьСтропы,"ЧГ=0")+"кгс"+" "+НРег(Объект.РасчетСтропЦветСтропы);
 		НаименованиеПродукцииПолное = "Стропа "+Объект.ШиринаСтропыРасчет+"см "+Формат(Объект.ГрузоподъемностьСтропы,"ЧГ=0")+"кгс"+" "+НРег(Объект.РасчетСтропЦветСтропы);
+	ИначеЕсли Объект.ПошивКомплектовка = "Доработка" Тогда
+		
+		Если Объект.СоздатьНовуюПозицию Тогда
+			НаименованиеПродукции 		= "&lt;..&gt;";
+			НаименованиеПродукцииПолное = "&lt;..&gt;";
+		Иначе
+			НаименованиеПродукции 		= Объект.Продукция.Наименование;
+			НаименованиеПродукцииПолное = Объект.Продукция.НаименованиеПолное;
+		КонецЕсли;	
+			
 	КонецЕсли;
 	
 	ЭлементыДерева = ДеревоПроизводство.ПолучитьЭлементы();
</Patch>
								</Method>
								<Method name="ЦветНити1РукиПриИзменении" nameInSecondConfiguration="ЦветНити1РукиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЦветНити2РукиПриИзменении" nameInSecondConfiguration="ЦветНити2РукиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЦветСтропы4СтропыПриИзменении" nameInSecondConfiguration="ЦветСтропы4СтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЦветСтропы4СтропыЧерезУголПриИзменении" nameInSecondConfiguration="ЦветСтропы4СтропыЧерезУголПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ШиринаКлапанВерхДругоеПриИзменении" nameInSecondConfiguration="ШиринаКлапанВерхДругоеПриИзменении">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ШиринаКлапанВерхПриИзменении" nameInSecondConfiguration="ШиринаКлапанВерхПриИзменении">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ШиринаНизДругоеПриИзменении" nameInSecondConfiguration="ШиринаНизДругоеПриИзменении">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ШиринаНизПриИзменении" nameInSecondConfiguration="ШиринаНизПриИзменении">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ШиринаОтпечаткаЛоготипПриИзменении" nameInSecondConfiguration="ШиринаОтпечаткаЛоготипПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ШиринаПриИзменении" nameInSecondConfiguration="ШиринаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ШиринаСтропыДругоеПриИзменении" nameInSecondConfiguration="ШиринаСтропыДругоеПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ШиринаСтропыПриИзменении" nameInSecondConfiguration="ШиринаСтропыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ШиринаСтропыРасчетПриИзменении" nameInSecondConfiguration="ШиринаСтропыРасчетПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ШнурЛентаУШПриИзменении" nameInSecondConfiguration="ШнурЛентаУШПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЮбкаЗавязанаВерхПриИзменении" nameInSecondConfiguration="ЮбкаЗавязанаВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЮбкаЗавязанаНизПриИзменении" nameInSecondConfiguration="ЮбкаЗавязанаНизПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЮбкаКрайПодшитВерхПриИзменении" nameInSecondConfiguration="ЮбкаКрайПодшитВерхПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<DirectiveArea name="АнализПотребностей" nameInSecondConfiguration="АнализПотребностей">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</DirectiveArea>
							</Methods>
						</Module>
					</FormModule>
				</Property>
			</Properties>
		</Object>
		<Object fullName="Document.Числа_НоваяАнкета.Form.ФормаСписка">
			<Properties>
				<Property name="Form">
					<MergeRule>DoNotMerge</MergeRule>
				</Property>
			</Properties>
		</Object>
		<Object fullName="Document.Числа_НоваяАнкета.Form.ФормаСозданияПолуфабриката">
			<Properties>
				<Property name="Form">
					<MergeRule>GetFromSecondConfiguration</MergeRule>
					<FormModule>
						<MergeRule>GetFromSecondConfiguration</MergeRule>
						<Module>
							<Methods>
								<Method name="ЕстьПолуфабрикат" nameInSecondConfiguration="ЕстьПолуфабрикат">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПолучитьГруппуПолуфабриката" nameInSecondConfiguration="ПолучитьГруппуПолуфабриката">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПолучитьДопРеквизит" nameInSecondConfiguration="ПолучитьДопРеквизит">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -18,6 +18,8 @@
 	Если Выборка.Следующий() Тогда
 		Если ТипЗнч(Выборка.Значение) = Тип("СправочникСсылка.ЗначенияСвойствОбъектов") Тогда
 			Возврат Выборка.Значение.Наименование;
+		Иначе
+			Возврат Выборка.Значение;
 		КонецЕсли;	
 	КонецЕсли;	
 	
</Patch>
								</Method>
								<Method name="ПолучитьЗначениеДопРеквизитов" nameInSecondConfiguration="ПолучитьЗначениеДопРеквизитов">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПолучитьЗначениеДопРеквизитовПолуфабриката" nameInSecondConfiguration="ПолучитьЗначениеДопРеквизитовПолуфабриката">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ПолучитьПолуфабрикат" nameInSecondConfiguration="ПолучитьПолуфабрикат">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -17,20 +17,32 @@
 	ТаблицаРабот.Колонки.Добавить("Объект", Новый ОписаниеТипов("СправочникСсылка.ВидыРаботСотрудников"));
 	ТаблицаРабот.Колонки.Добавить("Количество", Новый ОписаниеТипов("Число"));
 	
-	Материалы = ТаблицаПолуфабриката.НайтиСтроки(Новый Структура("ИмяТабЧастиСпецификации", "МатериалыИУслуги"));
-	Для каждого Элемент Из Материалы Цикл
-		СтрокаТЗ = ТаблицаМатериалов.Добавить();
-		СтрокаТЗ.Объект 	       	      = Элемент.НоменклатураРабота;
-		СтрокаТЗ.СпособПолученияМатериала = Элемент.СпособПолученияМатериала;
-		СтрокаТЗ.Количество 	   		  = Окр(Элемент.Количество/Количество,3);
-	КонецЦикла;		
+	Если ПересозданиеПолуфабриката Тогда
+		Для каждого Строка Из СоставСшивного Цикл
+			Если Строка.Количество &gt; 0 Тогда
+				Продолжить;
+			КонецЕсли;	
+			СтрокаТЗ = ТаблицаМатериалов.Добавить();
+			СтрокаТЗ.Объект 	       	      = Строка.Заготовка;
+			СтрокаТЗ.СпособПолученияМатериала = СтрокаТЗ.СпособПолученияМатериала;
+			СтрокаТЗ.Количество 	   		  = Окр(Строка.Количество/КоличествоНаПартию,3);
+		КонецЦикла;
+	Иначе	
+		Материалы = ТаблицаПолуфабриката.НайтиСтроки(Новый Структура("ИмяТабЧастиСпецификации", "МатериалыИУслуги"));
+		Для каждого Элемент Из Материалы Цикл
+			СтрокаТЗ = ТаблицаМатериалов.Добавить();
+			СтрокаТЗ.Объект 	       	      = Элемент.НоменклатураРабота;
+			СтрокаТЗ.СпособПолученияМатериала = Элемент.СпособПолученияМатериала;
+			СтрокаТЗ.Количество 	   		  = Элемент.Количество;
+		КонецЦикла;		
+	КонецЕсли;
 	ТаблицаМатериалов.Свернуть("Объект, СпособПолученияМатериала" ,"Количество");
 	
 	Работы = ТаблицаПолуфабриката.НайтиСтроки(Новый Структура("ИмяТабЧастиСпецификации", "Трудозатраты"));
 	Для каждого Элемент Из Работы Цикл
 		СтрокаТЗ = ТаблицаРабот.Добавить();
 		СтрокаТЗ.Объект 	       = Элемент.НоменклатураРабота;
-		СтрокаТЗ.Количество 	   = Окр(Элемент.Количество/Количество,3);
+		СтрокаТЗ.Количество 	   = Элемент.Количество;
 	КонецЦикла;
 	ТаблицаРабот.Свернуть("Объект", "Количество");
 	
</Patch>
								</Method>
								<Method name="ПолучитьСпецификацию" nameInSecondConfiguration="ПолучитьСпецификацию">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -2,7 +2,7 @@
 &amp;НаСервере
 Функция ПолучитьСпецификацию()
 	
-	ТаблицаПолуфабриката = ПолучитьИзВременногоХранилища(СтруктураПолуфабриката);
+	ТаблицаПолуфабриката = ПолучитьИзВременногоХранилища(СтруктураПолуфабриката.АдресСтруктурыПолуфабриката);
 	
 	ТаблицаМатериалов = Новый ТаблицаЗначений;
 	ТаблицаМатериалов.Колонки.Добавить("Объект", Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));
@@ -13,13 +13,25 @@
 	ТаблицаРабот.Колонки.Добавить("Объект", Новый ОписаниеТипов("СправочникСсылка.ВидыРаботСотрудников"));
 	ТаблицаРабот.Колонки.Добавить("Количество", Новый ОписаниеТипов("Число"));
 	
-	Материалы = ТаблицаПолуфабриката.НайтиСтроки(Новый Структура("ИмяТабЧастиСпецификации", "МатериалыИУслуги"));
-	Для каждого Элемент Из Материалы Цикл
-		СтрокаТЗ = ТаблицаМатериалов.Добавить();
-		СтрокаТЗ.Объект 	       	      = Элемент.НоменклатураРабота;
-		СтрокаТЗ.СпособПолученияМатериала = Элемент.СпособПолученияМатериала;
-		СтрокаТЗ.Количество 	   		  = Элемент.Количество;
-	КонецЦикла;		
+	Если ПересозданиеПолуфабриката Тогда
+		Для каждого Строка Из СоставСшивного Цикл
+			Если Строка.Количество &gt; 0 Тогда
+				Продолжить;
+			КонецЕсли;	
+			СтрокаТЗ = ТаблицаМатериалов.Добавить();
+			СтрокаТЗ.Объект 	       	      = Строка.Заготовка;
+			СтрокаТЗ.СпособПолученияМатериала = СтрокаТЗ.СпособПолученияМатериала;
+			СтрокаТЗ.Количество 	   		  = Окр(Строка.Количество/Количество,3);
+		КонецЦикла;
+	Иначе	
+		Материалы = ТаблицаПолуфабриката.НайтиСтроки(Новый Структура("ИмяТабЧастиСпецификации", "МатериалыИУслуги"));
+		Для каждого Элемент Из Материалы Цикл
+			СтрокаТЗ = ТаблицаМатериалов.Добавить();
+			СтрокаТЗ.Объект 	       	      = Элемент.НоменклатураРабота;
+			СтрокаТЗ.СпособПолученияМатериала = Элемент.СпособПолученияМатериала;
+			СтрокаТЗ.Количество 	   		  = Элемент.Количество;
+		КонецЦикла;	
+	КонецЕсли;
 	
 	Работы = ТаблицаПолуфабриката.НайтиСтроки(Новый Структура("ИмяТабЧастиСпецификации", "Трудозатраты"));
 	Для каждого Элемент Из Работы Цикл
</Patch>
								</Method>
								<Method name="ПроверитьЗаполнениеРеквизитов" nameInSecondConfiguration="ПроверитьЗаполнениеРеквизитов">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СтруктураПолуфабрикатаСервер" nameInSecondConfiguration="СтруктураПолуфабрикатаСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -3,6 +3,11 @@
 Функция СтруктураПолуфабрикатаСервер()
 	
 	Структура = Новый Структура("Артикул, Полуфабрикат, Спецификация, Количество, НаименованиеПолное, Проверен, ПолуфабрикатИзменен", Полуфабрикат.Артикул, Полуфабрикат, Спецификация, Количество, НаименованиеПолуфабриката, Полуфабрикат.Рубэг_Проверен, Полуфабрикат &lt;&gt; ИсходныйПолуфабрикат);	
+	Структура.Вставить("КоличествоНаПартию", КоличествоНаПартию);
+	Если ПересозданиеПолуфабриката Тогда
+		Структура.Вставить("СоставПерезаполняемого", СоставСшивного);
+	КонецЕсли;	
+	
 	Возврат Структура;
 	
 КонецФункции // СтруктураПолуфабрикатаСервер()
</Patch>
								</Method>
								<Method name="ВидЗаготовкиПриИзменении" nameInSecondConfiguration="ВидЗаготовкиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВысотаКлапанаПриИзменении" nameInSecondConfiguration="ВысотаКлапанаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВысотаПриИзменении" nameInSecondConfiguration="ВысотаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ГлубинаПриИзменении" nameInSecondConfiguration="ГлубинаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="Готово" nameInSecondConfiguration="Готово">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьЗначенияПоУмолчаниию" nameInSecondConfiguration="ЗаполнитьЗначенияПоУмолчаниию">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗУ1ПриИзменении" nameInSecondConfiguration="ЗУ1ПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗУПриИзменении" nameInSecondConfiguration="ЗУПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ИсключитьНитиПрошиваПоПериметру">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,42 @@
 
+&amp;НаСервере
+Процедура ИсключитьНитиПрошиваПоПериметру(МассивИсключений)
+
+	ПрошивПоПериметру = -ПериметрПрошива*2.7*КоличествоНаПартию;
+	ПрошивПоПериметру = ПрошивПоПериметру+ПрошивПоПериметру*0.01;
+	
+	Запрос = Новый Запрос;
+	Запрос.Текст = 
+	"ВЫБРАТЬ
+	|	Т.Заготовка КАК Заготовка
+	|ПОМЕСТИТЬ #СоставСшивного
+	|ИЗ
+	|	&amp;СоставСшивного КАК Т
+	|;
+	|
+	|////////////////////////////////////////////////////////////////////////////////
+	|ВЫБРАТЬ
+	|	СоставСшивного.Заготовка КАК Заготовка
+	|ИЗ
+	|	#СоставСшивного КАК СоставСшивного
+	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Числа_КонструкторБЭГОВ КАК Числа_КонструкторБЭГОВ
+	|		ПО СоставСшивного.Заготовка = Числа_КонструкторБЭГОВ.Владелец
+	|			И (Числа_КонструкторБЭГОВ.ФормулаРасчета ПОДОБНО ""%ПересчитыватьПрошивПоПериметру = Истина;%"")
+	|ГДЕ
+	|	НЕ СоставСшивного.Заготовка В (&amp;МассивИсключений)";
+	Запрос.УстановитьПараметр("СоставСшивного", СоставСшивного.Выгрузить());
+	Запрос.УстановитьПараметр("МассивИсключений", МассивИсключений);
+	
+	Выборка = Запрос.Выполнить().Выбрать();
+	Пока Выборка.Следующий() Цикл
+		СтрокиСоставаСшивного = СоставСшивного.НайтиСтроки(Новый Структура("Заготовка", Выборка.Заготовка));
+		Если СтрокиСоставаСшивного.Количество() Тогда
+			СтрокиСоставаСшивного[0].Количество = СтрокиСоставаСшивного[0].Количество + ПрошивПоПериметру;
+			НоваяСтрока = СоставСшивного.Добавить();
+			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокиСоставаСшивного[0]);
+			НоваяСтрока.Количество = ПрошивПоПериметру;
+			СоставСшивного.Сдвинуть(НоваяСтрока.ПолучитьИдентификатор(), -(НоваяСтрока.ПолучитьИдентификатор()-1));
+		КонецЕсли;	
+	КонецЦикла;
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="КлапанЗавязанПриИзменении" nameInSecondConfiguration="КлапанЗавязанПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="КоличествоПриИзменении" nameInSecondConfiguration="КоличествоПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЛоготипПриИзменении" nameInSecondConfiguration="ЛоготипПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="МатериалПриИзменении" nameInSecondConfiguration="МатериалПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбновитьТЭГИ" nameInSecondConfiguration="ОбновитьТЭГИ">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбновитьТЭГИНаСервере" nameInSecondConfiguration="ОбновитьТЭГИНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьКлапанаПриИзменении" nameInSecondConfiguration="ПлотностьКлапанаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьПанелиПриИзменении" nameInSecondConfiguration="ПлотностьПанелиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПлотностьТканиПриИзменении" nameInSecondConfiguration="ПлотностьТканиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПолуфабрикатНачалоВыбора" nameInSecondConfiguration="ПолуфабрикатНачалоВыбора">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПолуфабрикатОбработкаВыбора" nameInSecondConfiguration="ПолуфабрикатОбработкаВыбора">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПолуфабрикатПриИзменении" nameInSecondConfiguration="ПолуфабрикатПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПолуфабрикатПриИзмененииНаСервере" nameInSecondConfiguration="ПолуфабрикатПриИзмененииНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПриОткрытии" nameInSecondConfiguration="ПриОткрытии">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ПриСозданииНаСервере" nameInSecondConfiguration="ПриСозданииНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -18,9 +18,13 @@
 	ИсходныйПолуфабрикат   = Параметры.Полуфабрикат;
 	Спецификация		   = Параметры.Спецификация;
 	Количество			   = Параметры.Количество;
+	КоличествоНаПартию	   = Параметры.КоличествоНаПартию;
 	ЕстьПолуфабрикаты      = Параметры.ЕстьПолуфабрикаты;
 	АдресСтруктурыПолуфабриката = Параметры.АдресСтруктурыПолуфабриката;
 	ПараметрыТекущегоДокумента = Параметры.СтруктураТекущегоДокумента;
+	Если Параметры.Свойство("ПересозданиеПолуфабриката") Тогда
+		ПересозданиеПолуфабриката = Параметры.ПересозданиеПолуфабриката;
+	КонецЕсли;	
 	
 	Если ЗначениеЗаполнено(Полуфабрикат) Тогда
 		Аббревиатура			  = Полуфабрикат.Наименование;
</Patch>
								</Method>
								<Method name="ПрочитатьТэги" nameInSecondConfiguration="ПрочитатьТэги">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="РедактироватьАббревиатуру" nameInSecondConfiguration="РедактироватьАббревиатуру">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РедактироватьНаименование" nameInSecondConfiguration="РедактироватьНаименование">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СозадтьПолуфабрикат" nameInSecondConfiguration="СозадтьПолуфабрикат">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьНовуюПозициюПродукцииСпецификации" nameInSecondConfiguration="СоздатьНовуюПозициюПродукцииСпецификации">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -119,4 +119,4 @@
 	
 	Спецификация = ЭлементСпецификация.Ссылка;
 	
-КонецПроцедуры // СоздатьНовуюПозициюПродукцииСпецификации()
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="СпецификацияНачалоВыбора" nameInSecondConfiguration="СпецификацияНачалоВыбора">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СпецификацияОбработкаВыбора" nameInSecondConfiguration="СпецификацияОбработкаВыбора">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СПодгибомПриИзменении" nameInSecondConfiguration="СПодгибомПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СтропаПриИзменении" nameInSecondConfiguration="СтропаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СформироватьАвтонаименование" nameInSecondConfiguration="СформироватьАвтонаименование">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="ТаблицаСшивногоПриИзменении" nameInSecondConfiguration="ТаблицаСшивногоПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТипОтрезногоПриИзменении" nameInSecondConfiguration="ТипОтрезногоПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УплотнительныйШнурПриИзменении" nameInSecondConfiguration="УплотнительныйШнурПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УправлениеВидимостьюЭлементовФормы" nameInSecondConfiguration="УправлениеВидимостьюЭлементовФормы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УправлениеВидимостьюЭФ" nameInSecondConfiguration="УправлениеВидимостьюЭФ">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УправлениеДоступностьюЭлементовФормы" nameInSecondConfiguration="УправлениеДоступностьюЭлементовФормы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УстановитьТеги" nameInSecondConfiguration="УстановитьТеги">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch/>
								</Method>
								<Method name="фАнтистатическаяДобавкаПриИзменении" nameInSecondConfiguration="фАнтистатическаяДобавкаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="фАнтистатическаяНитьПриИзменении" nameInSecondConfiguration="фАнтистатическаяНитьПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="фДлинаПриИзменении" nameInSecondConfiguration="фДлинаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="фЛаминированнаяПриИзменении" nameInSecondConfiguration="фЛаминированнаяПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ФормированиеИмени" nameInSecondConfiguration="ФормированиеИмени">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ФормированиеНаименования" nameInSecondConfiguration="ФормированиеНаименования">
									<MergeRule>DoNotMerge</MergeRule>
									<Patch>@@ -13,11 +13,19 @@
 	Если ВидЗаготовки = "СшивнойПолуфабрикат" Тогда
 		
 		Аббревиатура = "";
+		Если ПересозданиеПолуфабриката Тогда
+			Аббревиатура = "R ";
+		КонецЕсли;	
+			
 		Первый = Истина;
 		Для каждого СтрокаТЗ Из СоставСшивного Цикл
 		
+			Если СтрокаТЗ.ВидСтроки &lt;&gt; "Полуфабрикат" Тогда
+				Продолжить;
+			КонецЕсли;	
+			
 			Если Первый Тогда
-				Аббревиатура = СтрокаТЗ.Заготовка.Наименование + ?(СтрокаТЗ.Количество &gt; 1,"("+СтрокаТЗ.Количество+")","");
+				Аббревиатура = Аббревиатура + СтрокаТЗ.Заготовка.Наименование + ?(СтрокаТЗ.Количество &gt; 1,"("+СтрокаТЗ.Количество+")","");
 			Иначе
 				Аббревиатура = Аббревиатура+" + "+СтрокаТЗ.Заготовка.Наименование + ?(СтрокаТЗ.Количество &gt; 1,"("+СтрокаТЗ.Количество+")","");
 			КонецЕсли;
</Patch>
								</Method>
								<Method name="фПерфорированнаяПриИзменении" nameInSecondConfiguration="фПерфорированнаяПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="фПлотностьЛаминацииПриИзменении" nameInSecondConfiguration="фПлотностьЛаминацииПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="фПлотностьПриИзменении" nameInSecondConfiguration="фПлотностьПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="фПринадлежностьПриИзменении" nameInSecondConfiguration="фПринадлежностьПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="фРукавПолотноПриИзменении" nameInSecondConfiguration="фРукавПолотноПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="фТипТканиПриИзменении" nameInSecondConfiguration="фТипТканиПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="фШиринаПриИзменении" nameInSecondConfiguration="фШиринаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ШиринаКлапанаПриИзменении" nameInSecondConfiguration="ШиринаКлапанаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ШиринаПриИзменении" nameInSecondConfiguration="ШиринаПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
							</Methods>
						</Module>
					</FormModule>
				</Property>
			</Properties>
		</Object>
		<Object fullName="Document.Числа_НоваяАнкета.Form.ФормаАналогов">
			<Properties>
				<Property name="Form">
					<MergeRule>GetFromSecondConfiguration</MergeRule>
					<FormModule>
						<MergeRule>GetFromSecondConfiguration</MergeRule>
						<Module>
							<Methods>
								<VariableDeclarationArea>
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</VariableDeclarationArea>
								<MainArea>
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</MainArea>
								<Method name="АртикулНаСервере" nameInSecondConfiguration="АртикулНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,10 +1,16 @@
 
 &amp;НаСервере
-Функция АртикулНаСервере(Элемент)
+Функция АртикулНаСервере(Элемент, БезРазделителей = Ложь)
 
 	Если ТипЗнч(Элемент) = Тип("СправочникСсылка.Номенклатура") Тогда
+		Если БезРазделителей Тогда
+			Возврат Элемент.Артикул;
+		КонецЕсли;	
 		Возврат "("+Элемент.Артикул+")";
 	ИначеЕсли ТипЗнч(Элемент) = Тип("СправочникСсылка.ВидыРаботСотрудников") Тогда
+		Если БезРазделителей Тогда
+			Возврат Элемент.Код;
+		КонецЕсли;	
 		Возврат "("+Элемент.Код+")";
 	КонецЕсли;	
 	
</Patch>
								</Method>
								<Method name="ЗначениеРеквизитаОбъектаСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,7 @@
 
+&amp;НаСервереБезКонтекста
+Функция ЗначениеРеквизитаОбъектаСервер(СсылкаНаОбъект, ИмяРеквизита)
+
+	Возврат СсылкаНаОбъект[ИмяРеквизита];
+
+КонецФункции
</Patch>
								</Method>
								<Method name="ОсновнаяСпецификацияПроизводствоВоронеж">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,29 @@
 
+&amp;НаСервере
+Функция ОсновнаяСпецификацияПроизводствоВоронеж(Номенклатура)
+
+	Запрос = Новый Запрос;
+	Запрос.Текст = 
+	"ВЫБРАТЬ
+	|	ОсновныеСпецификации.Спецификация КАК Спецификация
+	|ИЗ
+	|	РегистрСведений.ОсновныеСпецификации КАК ОсновныеСпецификации
+	|ГДЕ
+	|	ОсновныеСпецификации.Номенклатура = &amp;Номенклатура
+	|	И (ОсновныеСпецификации.Подразделение = &amp;Подразделение
+	|			ИЛИ ОсновныеСпецификации.Подразделение = ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка))
+	|	И ОсновныеСпецификации.Спецификация.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСпецификаций.Действует)";
+	Запрос.УстановитьПараметр("Номенклатура", Номенклатура);
+	Запрос.УстановитьПараметр("Подразделение", Справочники.Рубэг_Настройки.ПодразделениеПроизводствоВоронеж.ЗначениеНастройки);
+	
+	Выборка = Запрос.Выполнить().Выбрать();
+	Если Не Выборка.Следующий() Тогда
+		Сообщение = Новый СообщениеПользователю;
+		Сообщение.Текст = "Не найдено спецификции у указанного полуфабриката!";
+		Сообщение.Сообщить();
+		Возврат Неопределено;
+	КонецЕсли;	
+	
+	Возврат Выборка.Спецификация;
+
+КонецФункции
</Patch>
								</Method>
								<Method name="ПараметрыДереваСпецификаций">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,23 @@
 
+&amp;НаСервере
+Функция ПараметрыДереваСпецификаций(Номенклатура, Спецификация)
+	
+	ПараметрыДерева = УправлениеДаннымиОбИзделияхКлиентСервер.ПараметрыДереваСпецификаций();
+	
+	ПараметрыДерева.Номенклатура = Номенклатура;
+	//ПараметрыДерева.ХарактеристикаНоменклатуры = ДеревоХарактеристикаНоменклатуры;
+	
+	ПараметрыДерева.Спецификация = Спецификация;
+	ПараметрыДерева.Дата = Объект.Дата;
+	
+	ПараметрыДерева.ВыводитьЭтапы 				 = Ложь;
+	ПараметрыДерева.ВыводитьВыходныеИзделия 	 = Истина;
+	ПараметрыДерева.ВыводитьМатериалы 			 = Истина;
+	ПараметрыДерева.ВыводитьТрудозатраты 		 = Истина;
+	ПараметрыДерева.ВыводитьЗаголовкиГруппировок = Истина;
+	ПараметрыДерева.ДинамическоеСчитывание 		 = Ложь;
+	ПараметрыДерева.РазузловыватьПолуфабрикаты 	 = Истина;
+	
+	Возврат ПараметрыДерева;
+	
+КонецФункции
</Patch>
								</Method>
								<Method name="ПараметрыРазбиенияСтроки" nameInSecondConfiguration="ПараметрыРазбиенияСтроки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПодобранноеКоличествоВДеревоПроизводсиво" nameInSecondConfiguration="ПодобранноеКоличествоВДеревоПроизводсиво">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПолучитьДеревоСпецификацииДляРазузлования">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,36 @@
 
+&amp;НаСервере
+Функция ПолучитьДеревоСпецификацииДляРазузлования()
+
+	Дерево = Новый ДеревоЗначений;
+	
+	ОПНоменклатура = Новый Массив;
+	ОПНоменклатура.Добавить(Тип("СправочникСсылка.Номенклатура"));
+	ОПНоменклатура.Добавить(Тип("СправочникСсылка.ВидыРаботСотрудников"));
+	ОПНоменклатура.Добавить(Тип("Строка"));
+	Дерево.Колонки.Добавить("Номенклатура", Новый ОписаниеТипов(ОПНоменклатура));
+	
+	ОПСпецификция = Новый Массив;
+	ОПСпецификция.Добавить(Тип("СправочникСсылка.РесурсныеСпецификации"));
+	ОПСпецификция.Добавить(Тип("СправочникСсылка.МаршрутныеКарты"));
+	Дерево.Колонки.Добавить("Спецификация", Новый ОписаниеТипов(ОПСпецификция));
+	
+	Дерево.Колонки.Добавить("Количество", Новый ОписаниеТипов("Число"));
+	Дерево.Колонки.Добавить("Характеристика", Новый ОписаниеТипов("СправочникСсылка.ХарактеристикиНоменклатуры"));
+	Дерево.Колонки.Добавить("ВидСтроки", Новый ОписаниеТипов("ПеречислениеСсылка.ВидыСтрокДереваСпецификаций"));
+	Дерево.Колонки.Добавить("Идентификатор", Новый ОписаниеТипов("УникальныйИдентификатор"));
+	Дерево.Колонки.Добавить("ЕдиницаИзмерения", Новый ОписаниеТипов("СправочникСсылка.УпаковкиЕдиницыИзмерения"));
+	Дерево.Колонки.Добавить("ИндексКартинки", Новый ОписаниеТипов("Число"));
+	Дерево.Колонки.Добавить("ПроизводитсяВПроцессе", Новый ОписаниеТипов("Булево"));
+	Дерево.Колонки.Добавить("ПрименениеМатериалаРедактирование", Новый ОписаниеТипов("Строка"));
+	Дерево.Колонки.Добавить("ХарактеристикиИспользуются", Новый ОписаниеТипов("Булево"));
+	Дерево.Колонки.Добавить("СпособАвтовыбораНоменклатуры", Новый ОписаниеТипов("ПеречислениеСсылка.СпособыАвтовыбораНоменклатуры"));
+	Дерево.Колонки.Добавить("СпособАвтовыбораХарактеристики", Новый ОписаниеТипов("ПеречислениеСсылка.СпособыАвтовыбораХарактеристики"));
+	Дерево.Колонки.Добавить("КоличествоУпаковок", Новый ОписаниеТипов("Число"));
+	Дерево.Колонки.Добавить("Упаковка", Новый ОписаниеТипов("СправочникСсылка.УпаковкиЕдиницыИзмерения"));
+	Дерево.Колонки.Добавить("ЕстьСпецификация", Новый ОписаниеТипов("Булево"));
+	Дерево.Колонки.Добавить("СпецификацияПрочитана", Новый ОписаниеТипов("Булево"));
+	
+	Возврат Дерево;
+
+КонецФункции
</Patch>
								</Method>
								<Method name="ПолучитьСтруктуруДляВозратаРодительскойФорме" nameInSecondConfiguration="ПолучитьСтруктуруДляВозратаРодительскойФорме">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -7,6 +7,8 @@
 	Структура.Вставить("АдресМатериаловЗамены", ПоместитьВоВременноеХранилище(ДанныеФормыВЗначение(ДеревоМатериалов,Тип("ДеревоЗначений")), Новый УникальныйИдентификатор));
 	Структура.Вставить("АдресРаботЗамены", ПоместитьВоВременноеХранилище(ДанныеФормыВЗначение(ДеревоВидовРабот,Тип("ДеревоЗначений")), Новый УникальныйИдентификатор));
 	Структура.Вставить("ЦенаСУчетомЗамен", Объект.ЦенаСУчетомЗамен);
+	Структура.Вставить("СпецификацияЗамены", Объект.СпецификацияЗамены);
+	Структура.Вставить("СпецификацияЗаменыРубэг", Объект.СпецификацияЗаменыРубэг);
 	Возврат Структура;
 	
 КонецФункции
</Patch>
								</Method>
								<Method name="ПолучитьСтруктуруРеквизитовТекущегоДокумента" nameInSecondConfiguration="ПолучитьСтруктуруРеквизитовТекущегоДокумента">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПоместитьВоВременноеХранилищеТаблицуЗамен" nameInSecondConfiguration="ПоместитьВоВременноеХранилищеТаблицуЗамен">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -11,6 +11,7 @@
 	КопияТаблицы.Колонки.Добавить("Расценка");
 	КопияТаблицы.Колонки.Добавить("Объект");
 	КопияТаблицы.Колонки.Добавить("ИдентификаторСтроки");
+	КопияТаблицы.Колонки.Добавить("ИдСтроки");
 	
 	ТекущаяСтрока = Элементы[Таблица].ТекущаяСтрока;
 	Если Таблица = "ДеревоМатериалов" Тогда
</Patch>
								</Method>
								<Method name="ПоместитьВХранилищеСтруктуруПолуфабриката" nameInSecondConfiguration="ПоместитьВХранилищеСтруктуруПолуфабриката">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -14,6 +14,7 @@
 	СтруктураПолуфабриката.Колонки.Добавить("ЧастьБЭГА");
 	СтруктураПолуфабриката.Колонки.Добавить("ПорядокЧастьБЭГА");
 	СтруктураПолуфабриката.Колонки.Добавить("ПорядокРукавПолотно", Новый ОписаниеТипов("Число"));
+	СтруктураПолуфабриката.Колонки.Добавить("ИдентификаторСтроки");
 	СтруктураПолуфабриката.Колонки.Добавить("ЗУ");
 	
 	ДанныеСтроки = ДеревоПроизводство.НайтиПоИдентификатору(ТекущаяСтрока);
@@ -30,6 +31,7 @@
 			СтрокаСтруктуры.ЧастьБЭГА		   		 = СтрокаДерева.ЧастьБЭГА;
 			СтрокаСтруктуры.ПорядокЧастьБЭГА   		 = СтрокаДерева.ЧастьБЭГА.Порядок;
 			СтрокаСтруктуры.ПорядокРукавПолотно      = ПорядокСортировкиРукавПолотно(СтрокаСтруктуры.НоменклатураРабота, ДопРеквизитРукавПолотно);
+			СтрокаСтруктуры.ИдентификаторСтроки		 = СтрокаДерева.ПолучитьИдентификатор();
 			
 			Если СтрокаДерева.ЧастьБЭГА.Наименование = "Верх" Тогда
 				Если Объект.ЗащитноеУстройствоВерх = "ЗУГалена" Тогда
@@ -68,6 +70,7 @@
 				СтрокаСтруктуры.СпособПолученияМатериала = Перечисления.СпособыПолученияМатериаловВСпецификации.Обеспечивать;
 				СтрокаСтруктуры.ВидСтроки		   		 = СтрокаДерева_1.ВидСтроки;
 				СтрокаСтруктуры.ЧастьБЭГА				 = СтрокаДерева_1.ЧастьБЭГА;
+				СтрокаСтруктуры.ИдентификаторСтроки		 = СтрокаДерева_1.ПолучитьИдентификатор();
 			КонецЦикла;
 			
 		Иначе //Работы
@@ -80,6 +83,7 @@
 				СтрокаСтруктуры.Количество		   		 = СтрокаДерева_1.Количество;
 				СтрокаСтруктуры.ВидСтроки		   		 = СтрокаДерева_1.ВидСтроки;
 				СтрокаСтруктуры.ЧастьБЭГА				 = СтрокаДерева_1.ЧастьБЭГА;
+				СтрокаСтруктуры.ИдентификаторСтроки		 = СтрокаДерева_1.ПолучитьИдентификатор();
 				
 				Если СтрокаСтруктуры.НоменклатураРабота = ОперацияПокраска Тогда
 					ВидЗаготовки = "КрашеныйПолуфабрикат";	
</Patch>
								</Method>
								<Method name="ПорядокСортировкиРукавПолотно" nameInSecondConfiguration="ПорядокСортировкиРукавПолотно">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РасценкаРаботыСервер" nameInSecondConfiguration="РасценкаРаботыСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РасчитатьДопРасходы" nameInSecondConfiguration="РасчитатьДопРасходы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -23,7 +23,7 @@
 	|	И СтатьиРасходов.Ссылка В ИЕРАРХИИ(&amp;Группа)";
 	
 	Массив = Новый Массив;
-	Если СтруктураТекущегоДокумента.ПошивКомплектовка = "Пошив" Тогда
+	Если СтруктураТекущегоДокумента.ПошивКомплектовка = "Пошив" Или СтруктураТекущегоДокумента.ПошивКомплектовка = "Доработка" Тогда
 		Массив.Добавить(Справочники.РУБЭГ_СтатьиРасходов.НайтиПоКоду("000000001"));
 		Запрос.УстановитьПараметр("Группа", Массив);
 	ИначеЕсли СтруктураТекущегоДокумента.ПошивКомплектовка = "Комплектовка" Тогда
</Patch>
								</Method>
								<Method name="РасчитатьДопРасходыОскол" nameInSecondConfiguration="РасчитатьДопРасходыОскол">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -88,7 +88,7 @@
 		|ПО
 		|	ОБЩИЕ";
 		
-		Если СтруктураТекущегоДокумента.ПошивКомплектовка = "Пошив" Тогда
+		Если СтруктураТекущегоДокумента.ПошивКомплектовка = "Пошив" Или СтруктураТекущегоДокумента.ПошивКомплектовка = "Доработка" Тогда
 			Запрос.УстановитьПараметр("Группа", Справочники.РУБЭГ_СтатьиРасходов.НайтиПоКоду("000000001"));
 		ИначеЕсли СтруктураТекущегоДокумента.ПошивКомплектовка = "Комплектовка" Тогда
 			Запрос.УстановитьПараметр("Группа", Справочники.РУБЭГ_СтатьиРасходов.НайтиПоКоду("000000021"));
</Patch>
								</Method>
								<Method name="ТаблицаСвязанныхЧерезЗаменуСтрок">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,20 @@
 
+&amp;НаСервере
+Функция ТаблицаСвязанныхЧерезЗаменуСтрок(СтрокиДерева, ИдентификаторИсходнойСтроки)
+
+	Таблица = Новый ТаблицаЗначений;
+	ДеревоМатериаловЗначение = РеквизитФормыВЗначение("ДеревоМатериалов", Тип("ДеревоЗначений"));
+	Для каждого Колонка Из ДеревоМатериаловЗначение.Колонки Цикл
+		Таблица.Колонки.Добавить(Колонка.Имя, Колонка.ТипЗначения);
+	КонецЦикла;
+	
+	Для каждого Строка Из СтрокиДерева Цикл
+		Если Строка.ИдентификаторСтроки = ИдентификаторИсходнойСтроки Тогда
+			НоваяСтрока = Таблица.Добавить();
+			ЗаполнитьЗначенияСвойств(НоваяСтрока, Строка);
+		КонецЕсли;	
+	КонецЦикла;
+
+	Возврат Таблица;
+	
+КонецФункции
</Patch>
								</Method>
								<Method name="ЦенаНоменклатурыСервер" nameInSecondConfiguration="ЦенаНоменклатурыСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,6 +1,6 @@
 
 &amp;НаСервере
-Функция ЦенаНоменклатурыСервер(Номенклатура)
+Функция ЦенаНоменклатурыСервер(Номенклатура, Отказ = Ложь)
 
 	Запрос = Новый Запрос;
 	Запрос.Текст = 
@@ -21,15 +21,17 @@
 	Если Выборка.Следующий() Тогда
 		Если Выборка.Период &lt; НачалоДня(Объект.Дата)-35*86400 Тогда
 			Сообщение = Новый СообщениеПользователю;
-			Сообщение.Текст = "Цена устанавливалась более 35 дней назад!";
+			Сообщение.Текст = "Цена на "+Номенклатура+"устанавливалась более 35 дней назад!";
 			Сообщение.Сообщить();
+			Отказ = Истина;
 		КонецЕсли;	
 		Возврат Выборка.Цена;
 	КонецЕсли;	
 	
 	Сообщение = Новый СообщениеПользователю;
-	Сообщение.Текст = "Цена не устанавливалась!";
+	Сообщение.Текст = "Цена на "+Номенклатура+" не устанавливалась!";
 	Сообщение.Сообщить();
+	Отказ = Истина;
 	Возврат 0;
 	
 КонецФункции
</Patch>
								</Method>
								<Method name="ВвестиЗамену" nameInSecondConfiguration="ВвестиЗамену">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВопросИмпортироватьВсе" nameInSecondConfiguration="ВопросИмпортироватьВсе">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -4,12 +4,12 @@
 
 	Если Результат = КодВозвратаДиалога.Да Тогда
 		
-		Объект.СписокМатериаловЗамены.Очистить();	
-		ИмпортироватьМатериалыНаСервере();
+		ДеревоМатериалов.ПолучитьЭлементы().Очистить();
+		ДеревоЗначенийВДанныеФормыСервер(АдресДереваМатериалов, "ДеревоМатериалов");
 		РаскрытьДеревоМатериалов();
 		
-		Объект.СписокРаботЗамены.Очистить();
-		ИмпортироватьРаботыНаСервере();
+		ДеревоВидовРабот.ПолучитьЭлементы().Очистить();
+		ДеревоЗначенийВДанныеФормыСервер(АдресДереваРабот, "ДеревоРабот");
 		РаскрытьДеревоРабот();
 		
 		ИмпортироватьДеревоПроизводство();
</Patch>
								</Method>
								<Method name="ВопросПерезаполнениеСпискаМатериалов" nameInSecondConfiguration="ВопросПерезаполнениеСпискаМатериалов">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВопросПерезаполнениеСпискаРабот" nameInSecondConfiguration="ВопросПерезаполнениеСпискаРабот">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ВыборПолуфабрикатаДляЗамены">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,27 @@
 
+&amp;НаКлиенте
+Процедура ВыборПолуфабрикатаДляЗамены(Результат, ДополнительныеПараметры) Экспорт
+
+	Если ТипЗнч(Результат) = Тип("СправочникСсылка.Номенклатура") Тогда
+		
+		НомерТекущейСтроки  = Элементы.ДеревоМатериалов.ТекущаяСтрока;
+		ТекущаяСтрокаДерева = ДеревоМатериалов.НайтиПоИдентификатору(НомерТекущейСтроки);
+		
+		Если ТипЗнч(ТекущаяСтрокаДерева.КодНоменклатуры) = Тип("СправочникСсылка.РУБЭГ_ЧастиБЭГОВ") Тогда
+			СтрокиДерева = ТекущаяСтрокаДерева.ПолучитьЭлементы();
+		Иначе
+			СтрокиДерева = ТекущаяСтрокаДерева.ПолучитьРодителя().ПолучитьЭлементы(); 
+		КонецЕсли;	
+		
+		НоваяСтрока = СтрокиДерева.Добавить();
+		НоваяСтрока.Объект 		    = Результат;
+		НоваяСтрока.КодНоменклатуры = АртикулНаСервере(Результат, Истина);
+		НоваяСтрока.Расценка	    = ЦенаНоменклатурыСервер(Результат);
+		НоваяСтрока.Картинка 		= БиблиотекаКартинок.ТребуетсяОтметитьВыполненным;
+		НоваяСтрока.ЭтоПолуфабрикат = Истина;
+		
+		Элементы.ДеревоМатериалов.ТекущаяСтрока = НоваяСтрока.ПолучитьИдентификатор();
+		
+	КонецЕсли;	
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ВыборПолуфабрикатаДляЗаменыЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,10 @@
 
+&amp;НаКлиенте
+Процедура ВыборПолуфабрикатаДляЗаменыЗавершение(Результат, ДопПараметры) Экспорт
+
+	Если ТипЗнч(Результат) = Тип("СправочникСсылка.Номенклатура") Тогда
+		ДобавитьПолуфабрикатИРазузлованиеВДеревоПроизводствоСервер(Результат, ДопПараметры);
+		ОтметитьПодбранныеМатериалыИРаботы("");
+	КонецЕсли;	
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="Готово" nameInSecondConfiguration="Готово">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -2,6 +2,14 @@
 &amp;НаКлиенте
 Процедура Готово(Команда)
 	
+	Отказ = Ложь;
+	ПроверитьАктуальностьЦен(Отказ);
+	Если Отказ Тогда
+		Возврат;
+	КонецЕсли;	
+	
+	СоздатьСпецификациюЗаменыСервер();
+	СоздатьСпецификациюЗаменыДавальцаСервер();
 	СтруктураДляВозврата = ПолучитьСтруктуруДляВозратаРодительскойФорме();
 	Закрыть(СтруктураДляВозврата);
 	
</Patch>
								</Method>
								<Method name="ДеревоВидовРаботПриАктивизацииСтроки" nameInSecondConfiguration="ДеревоВидовРаботПриАктивизацииСтроки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоЗначенийВДанныеФормыСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,14 @@
 
+&amp;НаСервере
+Процедура ДеревоЗначенийВДанныеФормыСервер(АдресДерева, ИмяДереваДанныхФормы)
+
+	ДеревоЗначений = ПолучитьИзВременногоХранилища(АдресДерева);
+	Если ИмяДереваДанныхФормы = "ДеревоМатериалов" Тогда
+		ПереписатьДеревоЗначенийВДанныеФормы(ДеревоЗначений.Строки, ДеревоМатериалов.ПолучитьЭлементы(), ДеревоЗначений.Колонки);
+	ИначеЕсли ИмяДереваДанныхФормы = "ДеревоРабот" Тогда
+		ПереписатьДеревоЗначенийВДанныеФормы(ДеревоЗначений.Строки, ДеревоВидовРабот.ПолучитьЭлементы(), ДеревоЗначений.Колонки);
+	ИначеЕсли ИмяДереваДанныхФормы =  "ДеревоПроизводство" Тогда
+		ПереписатьДеревоЗначенийВДанныеФормы(ДеревоЗначений.Строки, ДеревоПроизводство.ПолучитьЭлементы(), ДеревоЗначений.Колонки);
+	КонецЕсли;
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ДеревоМатериаловПриАктивизацииСтроки" nameInSecondConfiguration="ДеревоМатериаловПриАктивизацииСтроки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоКоличествоНаПартиюПриИзменении" nameInSecondConfiguration="ДеревоПроизводствоКоличествоНаПартиюПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -5,18 +5,19 @@
 	ДанныеСтроки = Элементы.ДеревоПроизводство.ТекущиеДанные;
 	Если ДанныеСтроки.ВидСтроки = "Полуфабрикат" И ДанныеСтроки.КоличествоНапартию &lt;&gt; КоличествоНаПартиюДоИзменения Тогда
 		
+		Если ДанныеСтроки.ИдентификаторСтроки &lt;&gt; 0 Тогда
+			ИсходнаяСтрокаДерева = ДеревоПроизводство.НайтиПоИдентификатору(ДанныеСтроки.ИдентификаторСтроки);
+			КоличествоДельта = КоличествоНаПартиюДоИзменения - ДанныеСтроки.КоличествоНапартию;
+			КоэффициентПересчета = (ИсходнаяСтрокаДерева.КоличествоНаПартию + КоличествоДельта)/ИсходнаяСтрокаДерева.КоличествоНаПартию;
+			ИсходнаяСтрокаДерева.КоличествоНаПартию = ИсходнаяСтрокаДерева.КоличествоНаПартию + КоличествоДельта;
+			ПересчитатьРасходПодчиненныхСтрок(ИсходнаяСтрокаДерева.ПолучитьИдентификатор(), КоэффициентПересчета);
+		КонецЕсли;	
+		
 		КоэффициентПересчета = ДанныеСтроки.КоличествоНапартию/КоличествоНаПартиюДоИзменения;
 		ПересчитатьРасходПодчиненныхСтрок(Элементы.ДеревоПроизводство.ТекущаяСтрока, КоэффициентПересчета);
 		
 	КонецЕсли;	
 	
-	Если ДанныеСтроки.ВидСтроки = "ДетальнаяЗапись" Тогда
-		Если ДанныеСтроки.ПолучитьРодителя().ВидСтроки = "Материалы" Тогда
-			ДанныеСтроки.ПолучитьРодителя().ПолучитьРодителя().КоличествоНапартию = ДанныеСтроки.КоличествоНаПартию/ДанныеСтроки.Количество;
-		КонецЕсли;	
-	КонецЕсли;	
-	
-	ОбнулитьПодобранныеСтроки();
 	СтрокиДерева = ДеревоПроизводство.ПолучитьЭлементы();
 	Если СтрокиДерева.Количество() Тогда
 		ОтметитьПодбранныеМатериалыИРаботы(СтрокиДерева[0].ПолучитьИдентификатор());
</Patch>
								</Method>
								<Method name="ДеревоПроизводствоКоличествоПриИзменении" nameInSecondConfiguration="ДеревоПроизводствоКоличествоПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоПередНачаломИзменения" nameInSecondConfiguration="ДеревоПроизводствоПередНачаломИзменения">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоПередУдалением">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,8 @@
 
+&amp;НаКлиенте
+Процедура ДеревоПроизводствоПередУдалением(Элемент, Отказ)
+	
+	ТекущаяСтрока = Элементы.ДеревоПроизводство.ТекущиеДанные;
+	ОбработкаУдаленияСтрокиДереваПроизводство(ТекущаяСтрока);
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ДеревоПроизводствоПеретаскивание" nameInSecondConfiguration="ДеревоПроизводствоПеретаскивание">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -22,7 +22,16 @@
 			
 			СтрокаДереваПриемник = ДеревоПроизводство.НайтиПоИдентификатору(Строка);
 			
-			СтрокиТекущейСтроки = СтрокаДереваПриемник.ПолучитьЭлементы();
+			Если Элемент.ЭтоПолуфабрикат Тогда
+				РодительСтрокиПриемника = СтрокаДереваПриемник.ПолучитьРодителя();
+				Если РодительСтрокиПриемника = Неопределено Тогда
+					СтрокиТекущейСтроки = СтрокаДереваПриемник.ПолучитьЭлементы();
+				Иначе
+					СтрокиТекущейСтроки = СтрокаДереваПриемник.ПолучитьРодителя().ПолучитьЭлементы();
+				КонецЕсли;	
+			Иначе
+				СтрокиТекущейСтроки = СтрокаДереваПриемник.ПолучитьЭлементы();
+			КонецЕсли;	
 			
 			НоваяСтрокаДерева = СтрокиТекущейСтроки.Добавить();
 			НоваяСтрокаДерева.Этап 	 	      = Элемент.Объект;
@@ -33,19 +42,31 @@
 			НоваяСтрокаДерева.ЧастьБЭГА 	  = Элемент.ПолучитьРодителя().ЧастьБЭГА;
 			НоваяСтрокаДерева.КоличествоНаПартию = Элемент.КоличествоНаПартию;
 			
-			НоваяСтрокаДерева.ПолучитьРодителя().ПолучитьРодителя().ЧастьБЭГА = НоваяСтрокаДерева.ЧастьБЭГА;
+			Если Элемент.ЭтоПолуфабрикат Тогда
+				НоваяСтрокаДерева.ЧастьБЭГА = Элемент.ПолучитьРодителя().ЧастьБЭГА;
+			Иначе
+				НоваяСтрокаДерева.ПолучитьРодителя().ПолучитьРодителя().ЧастьБЭГА = НоваяСтрокаДерева.ЧастьБЭГА;
+			КонецЕсли;	
 			
 			Элемент.КоличествоПодобрано = НоваяСтрокаДерева.КоличествоНаПартию;
 			
-			Если НоваяСтрокаДерева.ПолучитьРодителя().ВидСтроки = "Материалы" Тогда
-				НоваяСтрокаДерева.ПолучитьРодителя().ПолучитьРодителя().КоличествоНапартию = НоваяСтрокаДерева.КоличествоНаПартию/НоваяСтрокаДерева.Количество;
+			РодительНовойСтроки = НоваяСтрокаДерева.ПолучитьРодителя();
+			Если РодительНовойСтроки.ВидСтроки = "Материалы" Тогда
+				КоличествоПолуфабрикатаНаПартию = 0;
+				Для каждого Строка Из РодительНовойСтроки.ПолучитьЭлементы() Цикл
+					КоличествоПолуфабрикатаНаПартию = КоличествоПолуфабрикатаНаПартию + Строка.КоличествоНаПартию/Строка.Количество;
+				КонецЦикла;
+				НоваяСтрокаДерева.ПолучитьРодителя().ПолучитьРодителя().КоличествоНапартию = Окр(КоличествоПолуфабрикатаНаПартию,0);
 			КонецЕсли;	
 
 			СтрокаВыходноеИзделие = НоваяСтрокаДерева.ПолучитьРодителя().ПолучитьРодителя();
-			//СтрокаВыходноеИзделие.ЧастьБЭГА = Элемент.ЧастьБЭГА;
-			//СтрокаВыходноеИзделие.Этап 		= "Выходное изделие ("+Элемент.ЧастьБЭГА+")";
 			
-			Элементы.ДеревоПроизводство.Развернуть(СтрокаДереваПриемник.ПолучитьИдентификатор(), Истина);
+			Если Элемент.ЭтоПолуфабрикат Тогда
+				НоваяСтрокаДерева.Картинка = БиблиотекаКартинок.ТребуетсяОтметитьВыполненным;
+				НоваяСтрокаДерева.ВыходноеИзделие = Элемент.Объект;
+			Иначе
+				Элементы.ДеревоПроизводство.Развернуть(СтрокаДереваПриемник.ПолучитьИдентификатор(), Истина);
+			КонецЕсли;	
 			
 		КонецЕсли;	
 	
</Patch>
								</Method>
								<Method name="ДеревоПроизводствоПослеУдаления" nameInSecondConfiguration="ДеревоПроизводствоПослеУдаления">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДеревоПроизводствоПриАктивизацииСтроки" nameInSecondConfiguration="ДеревоПроизводствоПриАктивизацииСтроки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -3,5 +3,6 @@
 Процедура ДеревоПроизводствоПриАктивизацииСтроки(Элемент)
 	
 	Элементы.ДеревоПроизводствоКонтекстноеМенюДобавитьРезаныйПолуфабрикат.Видимость = Элемент.ТекущиеДанные.ВидСтроки = "Полуфабрикат";
+	Элементы.ДеревоПроизводствоКонтекстноеМенюЭтоОплаченныйПолуфабрикат.Видимость   = Элемент.ТекущиеДанные.ВидСтроки = "Полуфабрикат";
 	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="ДеревоПроизводствоПроверкаПеретаскивания" nameInSecondConfiguration="ДеревоПроизводствоПроверкаПеретаскивания">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -15,6 +15,7 @@
 			
 			СтрокаИсточник    = ДеревоПроизводство.НайтиПоИдентификатору(ПараметрыПеретаскивания.Значение[0]);
 			СтрокаПриемник    = ДеревоПроизводство.НайтиПоИдентификатору(Строка);
+			
 			РодительПриемника = СтрокаПриемник.ПолучитьРодителя();
 			Если СтрокаИсточник.ВидСтроки = "Полуфабрикат" И СтрокаПриемник.ВидСтроки = "Полуфабрикат" Тогда
 			ИначеЕсли СтрокаИсточник.ВидСтроки = "Полуфабрикат" И СтрокаПриемник.ВидСтроки = "Этап" Тогда
@@ -25,14 +26,15 @@
 			
 		ИначеЕсли ТипЗнч(ПараметрыПеретаскивания.Значение[0].Объект) = Тип("СправочникСсылка.Номенклатура") Тогда // Перетаскивание материала
 			
+			СтрокаИсточник = ПараметрыПеретаскивания.Значение[0];
 			СтрокаПриемник = ДеревоПроизводство.НайтиПоИдентификатору(Строка);
-			Если СтрокаПриемник.ВидСтроки &lt;&gt; "Материалы" Тогда
+			Если СтрокаИсточник.ЭтоПолуфабрикат Тогда
+				Если СтрокаПриемник.ВидСтроки &lt;&gt; "Полуфабрикат" И СтрокаПриемник.ВидСтроки &lt;&gt; "Этап" Тогда
+					ПараметрыПеретаскивания.Действие = ДействиеПеретаскивания.Отмена;
+				КонецЕсли;	
+			ИначеЕсли СтрокаПриемник.ВидСтроки &lt;&gt; "Материалы" Тогда
 				ПараметрыПеретаскивания.Действие = ДействиеПеретаскивания.Отмена;
 			КонецЕсли;	
-			                                                    
-			//Если ПараметрыПеретаскивания.Значение[0].КоличествоПодобрано &lt;&gt; 0 Тогда
-			//	ПараметрыПеретаскивания.Действие = ДействиеПеретаскивания.Отмена;
-			//КонецЕсли;	
 			
 		ИначеЕсли ТипЗнч(ПараметрыПеретаскивания.Значение[0].Объект) = Тип("СправочникСсылка.ВидыРаботСотрудников") Тогда // Перетаскивание работы
 			
@@ -41,10 +43,6 @@
 				ПараметрыПеретаскивания.Действие = ДействиеПеретаскивания.Отмена;
 			КонецЕсли;	
 			
-			//Если ПараметрыПеретаскивания.Значение[0].КоличествоПодобрано &lt;&gt; 0 Тогда
-			//	ПараметрыПеретаскивания.Действие = ДействиеПеретаскивания.Отмена;
-			//КонецЕсли;	
-			
 		Иначе //Необрабатываемое перетаскивание
 			
 			ПараметрыПеретаскивания.Действие = ДействиеПеретаскивания.Отмена;
</Patch>
								</Method>
								<Method name="ДобавитьБлокСтрокВыходноеИзделие" nameInSecondConfiguration="ДобавитьБлокСтрокВыходноеИзделие">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьГотовыйПолуфабрикат">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,7 @@
 
+&amp;НаКлиенте
+Процедура ДобавитьГотовыйПолуфабрикат(Команда)
+	
+	ОткрытьФорму("Справочник.РУБЭГ_ЧастиБЭГОВ.Форма.ФормаВыбора", Новый Структура("Автозаголовок, Заголовок", Ложь, "К какой части бэга относится полуфабрикат?"),ЭтаФорма,,,, Новый ОписаниеОповещения("ПоказатьВыборЧастиБэгаЗавершение", ЭтаФорма));
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ДобавитьПолуфабрикатДоработкаЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьПолуфабрикатЗамену">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьПолуфабрикатИРазузлованиеВДеревоПроизводствоСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьПредопределеннуюСтрокуДереваПроизводство" nameInSecondConfiguration="ДобавитьПредопределеннуюСтрокуДереваПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьРезаныйПолуфабрикат" nameInSecondConfiguration="ДобавитьРезаныйПолуфабрикат">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -40,7 +40,7 @@
 	СтруктураПолуфабриката = Новый Структура("АдресСтруктурыПолуфабриката", Адрес);
 	
 	ПараметрыДляФормы = Новый Структура;
-	ПараметрыДляФормы.Вставить("СтруктураТекущегоДокумента", ПолучитьСтруктуруРеквизитовТекущегоДокумента());
+	ПараметрыДляФормы.Вставить("СтруктураТекущегоДокумента", СтруктураТекущегоДокумента);
 	ПараметрыДляФормы.Вставить("ВидЗаготовки", ВидЗаготовки);
 	ПараметрыДляФормы.Вставить("СтруктураПолуфабриката", СтруктураПолуфабриката);
 	ПараметрыДляФормы.Вставить("АдресСтруктурыПолуфабриката", Адрес);
@@ -48,6 +48,7 @@
 	ПараметрыДляФормы.Вставить("Спецификация", ДанныеСтроки.Спецификация);
 	ПараметрыДляФормы.Вставить("ЧастьБЭГА",    ДанныеСтроки.ЧастьБЭГА);
 	ПараметрыДляФормы.Вставить("Количество",   ?(ДанныеСтроки.Количество = 0, 1, ДанныеСтроки.Количество));
+	ПараметрыДляФормы.Вставить("КоличествоНаПартию",   ?(ДанныеСтроки.КоличествоНаПартию = 0, Объект.Количество, ДанныеСтроки.КоличествоНаПартию));
 	ПараметрыДляФормы.Вставить("ЕстьПолуфабрикаты", ЕстьПолуфабрикаты);
 	ПараметрыДляФормы.Вставить("Аббревиатура", "");
 	ПараметрыДляФормы.Вставить("НаименованиеПолуфабриката", "");
</Patch>
								</Method>
								<Method name="ДобавитьСтрокиДереваСлева">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ДобавитьСтрокуДеревоПроизводство" nameInSecondConfiguration="ДобавитьСтрокуДеревоПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаменитьНаДругойПолуфабрикат">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьТаблицыМатериаловРаботДляПоискаСпецификации">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьТаблицыМатериаловРаботДляПоискаСпецификацииДавальца">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЗаполнитьТаблицыСпецификацииДавальцаПоДеревуРекурсивно">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ИмпортироватьВсе" nameInSecondConfiguration="ИмпортироватьВсе">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -2,14 +2,16 @@
 &amp;НаКлиенте
 Процедура ИмпортироватьВсе(Команда)
 	
-	Если Объект.СписокМатериаловЗамены.Количество() Или Объект.СписокРаботЗамены.Количество() Или ДеревоПроизводство.ПолучитьЭлементы().Количество() Тогда
+	Если ДеревоМатериалов.ПолучитьЭлементы().Количество() Или ДеревоВидовРабот.Количество() Или ДеревоПроизводство.ПолучитьЭлементы().Количество() Тогда
 		ПоказатьВопрос(Новый ОписаниеОповещения("ВопросИмпортироватьВсе", ЭтаФорма), "Перед заполнением, табличные части будт очищены. Продолжить?", РежимДиалогаВопрос.ДаНетОтмена);
 	Иначе
 		
-		ИмпортироватьМатериалыНаСервере();
+		ДеревоМатериалов.ПолучитьЭлементы().Очистить();
+		ДеревоЗначенийВДанныеФормыСервер(АдресДереваМатериалов, "ДеревоМатериалов");
 		РаскрытьДеревоМатериалов();
 		
-		ИмпортироватьРаботыНаСервере();
+		ДеревоВидовРабот.ПолучитьЭлементы().Очистить();
+		ДеревоЗначенийВДанныеФормыСервер(АдресДереваРабот, "ДеревоРабот");
 		РаскрытьДеревоРабот();
 		
 		ИмпортироватьДеревоПроизводство();
</Patch>
								</Method>
								<Method name="ИмпортироватьДеревоПроизводство" nameInSecondConfiguration="ИмпортироватьДеревоПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -2,25 +2,14 @@
 &amp;НаСервере
 Процедура ИмпортироватьДеревоПроизводство()
 
-	ДеревоЗначение = ПолучитьИзВременногоХранилища(СтруктураТекущегоДокумента.АдресДерева);
-	Если ДеревоЗначение.Колонки.Найти("КоличествоНаПартию") = Неопределено Тогда
-		ДеревоЗначение.Колонки.Добавить("КоличествоНаПартию", Новый ОписаниеТипов("Число"));
-	КонецЕсли;	
-	Если ДеревоЗначение.Колонки.Найти("СуммаНаПартию") = Неопределено Тогда
-		ДеревоЗначение.Колонки.Добавить("СуммаНаПартию", Новый ОписаниеТипов("Число"));
-	КонецЕсли;	
-	Если ДеревоЗначение.Колонки.Найти("Расценка") = Неопределено Тогда
-		ДеревоЗначение.Колонки.Добавить("Расценка", Новый ОписаниеТипов("Число"));
-	КонецЕсли;	
-	Если ДеревоЗначение.Колонки.Найти("Артикул") = Неопределено Тогда
-		ДеревоЗначение.Колонки.Добавить("Артикул", Новый ОписаниеТипов("Число"));
-	КонецЕсли;	
-	ЗначениеВРеквизитФормы(ДеревоЗначение,"ДеревоПроизводство");
+	ДеревоПроизводство.ПолучитьЭлементы().Очистить();
+	ДеревоНормативное = ПолучитьИзВременногоХранилища(АдресДереваНормативного);
+	ПереписатьДеревоЗначенийВДанныеФормы(ДеревоНормативное.Строки, ДеревоПроизводство.ПолучитьЭлементы(), ДеревоНормативное.Колонки);
 	
 	ОбнулитьПодобранныеСтроки();
 	СтрокиДерева = ДеревоПроизводство.ПолучитьЭлементы();
 	СуммаНаПартиюИтого = 0;
-	ПересчитатьРасходНаПартиюДереваПроизводство(СтрокиДерева, СуммаНаПартиюИтого);
+	ПересчитатьРасходНаПартиюДереваПроизводство(СтрокиДерева, СуммаНаПартиюИтого, Ложь);
 	ОтметитьПодбранныеМатериалыИРаботы(СтрокиДерева[0]);
 	СтрокиДерева[0].СуммаНаПартию      = СуммаНаПартиюИтого;
 	СтрокиДерева[0].Расценка      	   = СуммаНаПартиюИтого/СтруктураТекущегоДокумента.Количество;
</Patch>
								</Method>
								<Method name="ИмпортироватьДеревоПроизводство1" nameInSecondConfiguration="ИмпортироватьДеревоПроизводство1">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ИмпортироватьМатериалы" nameInSecondConfiguration="ИмпортироватьМатериалы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ИмпортироватьМатериалыНаСервере" nameInSecondConfiguration="ИмпортироватьМатериалыНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ИмпортироватьРаботы" nameInSecondConfiguration="ИмпортироватьРаботы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ИмпортироватьРаботыНаСервере" nameInSecondConfiguration="ИмпортироватьРаботыНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="МатериалыРазбитьСтроку" nameInSecondConfiguration="МатериалыРазбитьСтроку">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбновитьЦенуНаСервере" nameInSecondConfiguration="ОбновитьЦенуНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбнулитьПодобранныеСтроки" nameInSecondConfiguration="ОбнулитьПодобранныеСтроки">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ОбработкаУдаленияСтрокиДереваПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,32 @@
 
+&amp;НаКлиенте
+Процедура ОбработкаУдаленияСтрокиДереваПроизводство(СтрокаДереваПроизводство)
+
+	Если СтрокаДереваПроизводство.ВидСтроки = "ДетальнаяЗапись" Тогда
+		УдалитьСвязанныеСтрокиДереваЛево(СтрокаДереваПроизводство);
+	КонецЕсли;	
+	
+	Для каждого Строка Из СтрокаДереваПроизводство.ПолучитьЭлементы() Цикл
+		Если Строка.ВидСтроки = "ДетальнаяЗапись" Тогда
+			УдалитьСвязанныеСтрокиДереваЛево(Строка);
+		КонецЕсли;	
+	КонецЦикла;
+
+	Если СтрокаДереваПроизводство.ВидСтроки = "Полуфабрикат" И СтрокаДереваПроизводство.ИдентификаторСтроки &lt;&gt; 0 Тогда
+		
+		КоличествоНаПартиюДоИзменения = СтрокаДереваПроизводство.КоличествоНаПартию;
+		
+		ИсходнаяСтрокаДерева = ДеревоПроизводство.НайтиПоИдентификатору(СтрокаДереваПроизводство.ИдентификаторСтроки);
+		КоличествоДельта = СтрокаДереваПроизводство.КоличествоНапартию;
+		КоэффициентПересчета = (ИсходнаяСтрокаДерева.КоличествоНаПартию + КоличествоДельта)/ИсходнаяСтрокаДерева.КоличествоНаПартию;
+		ИсходнаяСтрокаДерева.КоличествоНаПартию = ИсходнаяСтрокаДерева.КоличествоНаПартию + КоличествоДельта;
+		ПересчитатьРасходПодчиненныхСтрок(ИсходнаяСтрокаДерева.ПолучитьИдентификатор(), КоэффициентПересчета);
+		
+	КонецЕсли;	
+	
+	СтрокиДерева = ДеревоПроизводство.ПолучитьЭлементы();
+	Если СтрокиДерева.Количество() Тогда
+		ОтметитьПодбранныеМатериалыИРаботы(СтрокиДерева[0].ПолучитьИдентификатор());
+	КонецЕсли;
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ОповещениеОВыбореПолуфабриката" nameInSecondConfiguration="ОповещениеОВыбореПолуфабриката">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -14,6 +14,7 @@
 	ДанныеСтроки.ВыходноеИзделие   = ЗначениеВыбора.Полуфабрикат;
 	ДанныеСтроки.Спецификация      = ЗначениеВыбора.Спецификация;
 	ДанныеСтроки.Количество        = ЗначениеВыбора.Количество;
+	ДанныеСтроки.Артикул		   = ЗначениеВыбора.Артикул;
 	ДанныеСтроки.Этап			   = ЗначениеВыбора.НаименованиеПолное;
 	ДанныеСтроки.Проверен		   = ЗначениеВыбора.Проверен;
 	ДанныеСтроки.СтрокаНеактуальна = Ложь;
</Patch>
								</Method>
								<Method name="ОтметитьПодбранныеМатериалыИРаботы" nameInSecondConfiguration="ОтметитьПодбранныеМатериалыИРаботы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПереписатьДеревоЗначенийВДанныеФормы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПереписатьДеревоСпецификацииВДеревоПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПересчитатьВсеДерево" nameInSecondConfiguration="ПересчитатьВсеДерево">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПересчитатьМатериалы" nameInSecondConfiguration="ПересчитатьМатериалы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -3,7 +3,11 @@
 Процедура ПересчитатьМатериалы()
 
 	Для каждого СтрокаТЧ Из Объект.СписокМатериаловЗамены Цикл
-		СтрокаТЧ.КоличествоНаПартию  = Окр(СтрокаТЧ.Количество,3)*СтруктураТекущегоДокумента.Количество;
+		Если СтруктураТекущегоДокумента.ПошивКомплектовка = "Доработка" Тогда
+			СтрокаТЧ.КоличествоНаПартию  = СтрокаТЧ.Количество;
+		Иначе
+			СтрокаТЧ.КоличествоНаПартию  = Окр(СтрокаТЧ.Количество,3)*СтруктураТекущегоДокумента.Количество;
+		КонецЕсли;	
 		СтрокаТЧ.ИсходноеКоличество  = СтрокаТЧ.КоличествоНаПартию;
 		СтрокаТЧ.СуммаНаПартию       = СтрокаТЧ.КоличествоНаПартию*СтрокаТЧ.Расценка; 
 		СтрокаТЧ.КоличествоГотовых   = СтруктураТекущегоДокумента.Количество;
</Patch>
								</Method>
								<Method name="ПересчитатьРаботы" nameInSecondConfiguration="ПересчитатьРаботы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПересчитатьРасходНаПартиюДереваПроизводство" nameInSecondConfiguration="ПересчитатьРасходНаПартиюДереваПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -8,6 +8,8 @@
 			
 			Если ПересчитыватьКоличество Тогда
 				СтрокаДерева.КоличествоНаПартию = СтрокаДерева.Количество*СтруктураТекущегоДокумента.Количество;
+			Иначе
+				//СтрокаДерева.КоличествоНаПартию = СтрокаДерева.Количество;
 			КонецЕсли;	
 			Если СтрокаДерева.ПолучитьРодителя().ВидСтроки = "Материалы" Тогда
 				СтрокаТЧ = Объект.СписокМатериаловЗамены.НайтиСтроки(Новый Структура("ЧастьБЭГА, Объект", СтрокаДерева.ЧастьБЭГА, СтрокаДерева.Этап));
@@ -25,6 +27,8 @@
 		ИначеЕсли СтрокаДерева.ВидСтроки = "Полуфабрикат" Тогда
 			Если ПересчитыватьКоличество Тогда
 				СтрокаДерева.КоличествоНаПартию = СтрокаДерева.Количество*СтруктураТекущегоДокумента.Количество;
+			Иначе
+				//СтрокаДерева.КоличествоНаПартию = СтрокаДерева.Количество;
 			КонецЕсли;	
 			СтрокаДерева.Артикул = АртикулНаСервере(СтрокаДерева.ВыходноеИзделие);
 		ИначеЕсли СтрокаДерева.ВидСтроки = "Этап" Тогда
</Patch>
								</Method>
								<Method name="ПересчитатьРасходПодчиненныхСтрок" nameInSecondConfiguration="ПересчитатьРасходПодчиненныхСтрок">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -7,6 +7,9 @@
 		
 		Если ПодчиненнаяСтрока.ВидСтроки = "Полуфабрикат" Или ПодчиненнаяСтрока.ВидСтроки = "ДетальнаяЗапись" Тогда
 			ПодчиненнаяСтрока.КоличествоНаПартию = ПодчиненнаяСтрока.КоличествоНаПартию*КоэффициентПересчета;
+			Если ПодчиненнаяСтрока.ВидСтроки = "ДетальнаяЗапись" Тогда
+				СкорректироватьКоличествоВДеревеСлева(ПодчиненнаяСтрока);
+			КонецЕсли;	
 		КонецЕсли;	
 		
 		ПересчитатьРасходПодчиненныхСтрок(ПодчиненнаяСтрока.ПолучитьИдентификатор(), КоэффициентПересчета)
</Patch>
								</Method>
								<Method name="ПересчитатьСтрокуТабличнойЧастиМатериалов" nameInSecondConfiguration="ПересчитатьСтрокуТабличнойЧастиМатериалов">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПересчитатьСтрокуТабличнойЧастиРабот" nameInSecondConfiguration="ПересчитатьСтрокуТабличнойЧастиРабот">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПоказатьВыборЧастиБэгаЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,9 @@
 
+&amp;НаКлиенте
+Процедура ПоказатьВыборЧастиБэгаЗавершение(Результат, ДопПараметры) Экспорт
+
+	Если ТипЗнч(Результат) = Тип("СправочникСсылка.РУБЭГ_ЧастиБЭГОВ") Тогда
+		ОткрытьФорму("Справочник.Номенклатура.Форма.ФормаВыбора",,ЭтаФорма,,,,Новый ОписаниеОповещения("ДобавитьПолуфабрикатДоработкаЗавершение", ЭтаФорма, Результат));
+	КонецЕсли;	
+
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="ПоместитьТекущуюВеткуДереваВХранилище" nameInSecondConfiguration="ПоместитьТекущуюВеткуДереваВХранилище">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПриОткрытии" nameInSecondConfiguration="ПриОткрытии">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ПриСозданииНаСервере" nameInSecondConfiguration="ПриСозданииНаСервере">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -4,60 +4,26 @@
 	
 	СтруктураТекущегоДокумента = Параметры.СтруктураТекущегоДокумента;
 	
-	ТаблицаСписокТехМатериалов = ПолучитьИзВременногоХранилища(Параметры.СтруктураТекущегоДокумента.СписокТехМатериалов);
-	СоздатьКолонкиДанныхФормы("СписокТехМатериалов", ТаблицаСписокТехМатериалов.Колонки);
-	ЗначениеВРеквизитФормы(ТаблицаСписокТехМатериалов,"СписокТехМатериалов");
-	
-	ТаблицаСписокТехОпераций = ПолучитьИзВременногоХранилища(Параметры.СтруктураТекущегоДокумента.СписокТехОпераций);
-	СоздатьКолонкиДанныхФормы("СписокТехОпераций", ТаблицаСписокТехОпераций.Колонки);
-	ЗначениеВРеквизитФормы(ТаблицаСписокТехОпераций,"СписокТехОпераций");
-	
-	ТаблицаСписокМатериаловЗамены = ПолучитьИзВременногоХранилища(Параметры.СтруктураТекущегоДокумента.СписокМатериаловЗамены);
-	СоздатьКолонкиДанныхФормы("СписокМатериаловЗамены", ТаблицаСписокМатериаловЗамены.Колонки);
-	ЗначениеВРеквизитФормы(ТаблицаСписокМатериаловЗамены,"СписокМатериаловЗамены");
-	
-	ТаблицаСписокРаботЗамены = ПолучитьИзВременногоХранилища(Параметры.СтруктураТекущегоДокумента.СписокРаботЗамены);
-	СоздатьКолонкиДанныхФормы("СписокРаботЗамены", ТаблицаСписокРаботЗамены.Колонки);
-	ЗначениеВРеквизитФормы(ТаблицаСписокРаботЗамены,"СписокРаботЗамены");
-	
 	ДеревоЗначений = ПолучитьИзВременногоХранилища(Параметры.АдресДереваМатериаловЗамен);
-	Если ДеревоЗначений &lt;&gt; Неопределено Тогда
-   		ЗначениеВДанныеФормы(ДеревоЗначений, ДеревоМатериалов);
-	Иначе
-		ИмпортироватьМатериалыНаСервере();
-	КонецЕсли;
+	ПереписатьДеревоЗначенийВДанныеФормы(ДеревоЗначений.Строки, ДеревоМатериалов.ПолучитьЭлементы(), ДеревоЗначений.Колонки);
+	АдресДереваМатериалов = Параметры.АдресДереваМатериалов;
 	
 	ДеревоЗначений = ПолучитьИзВременногоХранилища(Параметры.АдресДереваРаботЗамен);
-	Если ДеревоЗначений &lt;&gt; Неопределено Тогда
-		ЗначениеВДанныеФормы(ДеревоЗначений, ДеревоВидовРабот);
-	Иначе
-		ИмпортироватьРаботыНаСервере(); 
-	КонецЕсли;	
+	ПереписатьДеревоЗначенийВДанныеФормы(ДеревоЗначений.Строки, ДеревоВидовРабот.ПолучитьЭлементы(), ДеревоЗначений.Колонки);
+	АдресДереваРабот = Параметры.АдресДереваРабот;
+	
+	ЭтоДоработка = СтруктураТекущегоДокумента.ПошивКомплектовка = "Доработка";
+	
+	АдресДереваЗамен 		= Параметры.АдресДереваЗамен;
+	АдресДереваНормативного = Параметры.АдресДереваНормативного;
+	ДеревоЗамен 	  = ПолучитьИзВременногоХранилища(АдресДереваЗамен);
+	ДеревоНормативное = ПолучитьИзВременногоХранилища(АдресДереваНормативного);
 	
-	ДеревоЗначение = ПолучитьИзВременногоХранилища(Параметры.АдресДереваАналогов);
-	ДеревоОсновное = ПолучитьИзВременногоХранилища(Параметры.АдресДерева);
-	Если ДеревоЗначение &lt;&gt; Неопределено Тогда
-		Если ДеревоЗначение.Колонки.Найти("КоличествоНаПартию") = Неопределено Тогда
-			ДеревоЗначение.Колонки.Добавить("КоличествоНаПартию", Новый ОписаниеТипов("Число"));
-		КонецЕсли;	
-		Если ДеревоЗначение.Колонки.Найти("СуммаНаПартию") = Неопределено Тогда
-			ДеревоЗначение.Колонки.Добавить("СуммаНаПартию", Новый ОписаниеТипов("Число"));
-		КонецЕсли;	
-		Если ДеревоЗначение.Колонки.Найти("Расценка") = Неопределено Тогда
-			ДеревоЗначение.Колонки.Добавить("Расценка", Новый ОписаниеТипов("Число"));
-		КонецЕсли;	
-		Если ДеревоЗначение.Колонки.Найти("Артикул") = Неопределено Тогда
-			ДеревоЗначение.Колонки.Добавить("Артикул", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(11)));
-		КонецЕсли;	
-		ЗначениеВРеквизитФормы(ДеревоЗначение,"ДеревоПроизводство");
-		Если ДеревоЗначение.Строки.Количество() = 0 Тогда
-			ДобавитьПредопределеннуюСтрокуДереваПроизводство();
-		КонецЕсли;	
-		СтрокаДерева = ДеревоПроизводство.ПолучитьЭлементы()[0];
-		ОтметитьПодбранныеМатериалыИРаботы(СтрокаДерева);
-	ИначеЕсли ДеревоОсновное &lt;&gt; Неопределено Тогда
-		ИмпортироватьДеревоПроизводство();
-	Иначе
+	Если ТипЗнч(ДеревоЗамен) = Тип("ДеревоЗначений") Тогда
+		ПереписатьДеревоЗначенийВДанныеФормы(ДеревоЗамен.Строки, ДеревоПроизводство.ПолучитьЭлементы(), ДеревоЗамен.Колонки);
+	ИначеЕсли ТипЗнч(ДеревоНормативное) = Тип("ДеревоЗначений") Тогда
+		ПереписатьДеревоЗначенийВДанныеФормы(ДеревоНормативное.Строки, ДеревоПроизводство.ПолучитьЭлементы(), ДеревоНормативное.Колонки);
+	Иначе 
 		ДобавитьПредопределеннуюСтрокуДереваПроизводство();
 	КонецЕсли;	
 	
</Patch>
								</Method>
								<Method name="ПроверитьАктуальностьЦен">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РаботыРазбитьСтроку" nameInSecondConfiguration="РаботыРазбитьСтроку">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РаботыРазбитьСтрокуКопия" nameInSecondConfiguration="РаботыРазбитьСтрокуКопия">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазбитьСтрокуДереваПроизводствоЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазбитьСтрокуЗавершение" nameInSecondConfiguration="РазбитьСтрокуЗавершение">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазбитьСтрокуЗавершениеРаботы" nameInSecondConfiguration="РазбитьСтрокуЗавершениеРаботы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазбитьСтрокуЗавершениеРаботыСервер" nameInSecondConfiguration="РазбитьСтрокуЗавершениеРаботыСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РазбитьСтрокуЗавершениеСервер" nameInSecondConfiguration="РазбитьСтрокуЗавершениеСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -6,49 +6,108 @@
 	СтрокаТЧ = ДеревоМатериалов.НайтиПоИдентификатору(Элементы.ДеревоМатериалов.ТекущаяСтрока);
 	СтрокиКУдалению = Новый Массив;
 	
+	
 	СтрокаРодитель = СтрокаТЧ.ПолучитьРодителя();
 	СтрокиТекущейВетки = СтрокаРодитель.ПолучитьЭлементы();
-	Индекс = 0;
-	сч = 0;
-	Для каждого СтрокаДерева Из СтрокиТекущейВетки Цикл
-		Если СтрокаДерева.ИдентификаторСтроки = Результат.ИдентификаторСтроки И Не СтрокаДерева.ПервичнаяСтрока Тогда
-			СтрокиКУдалению.Добавить(СтрокаДерева);
-		ИначеЕсли СтрокаДерева.ИдентификаторСтроки = Результат.ИдентификаторСтроки И СтрокаДерева.ПервичнаяСтрока Тогда
-			СтрокаИсходник = СтрокаДерева;
-			Индекс = сч+1;
-		КонецЕсли;	
-		сч = сч + 1;
-	КонецЦикла;
+	ТаблицаСвязанныхСтрок = ТаблицаСвязанныхЧерезЗаменуСтрок(СтрокиТекущейВетки, Результат.ИдентификаторСтроки);
 	
-	Для каждого Элемент Из СтрокиКУдалению Цикл
-		СтрокиТекущейВетки.Удалить(Элемент);
-	КонецЦикла;
+	Запрос = Новый Запрос;
+	Запрос.Текст = 
+	"ВЫБРАТЬ
+	|	ТаблицаЗамен.ТипСтроки КАК ТипСтроки,
+	|	ТаблицаЗамен.Материал КАК Материал,
+	|	ТаблицаЗамен.Расход КАК Расход,
+	|	ТаблицаЗамен.КоличествоГотовых КАК КоличествоГотовых,
+	|	ТаблицаЗамен.КоличествоНаПартию КАК КоличествоНаПартию,
+	|	ТаблицаЗамен.Расценка КАК Расценка,
+	|	ТаблицаЗамен.Работа КАК Работа,
+	|	ТаблицаЗамен.ИдСтроки КАК ИдСтроки
+	|ПОМЕСТИТЬ #ТаблицаЗамен
+	|ИЗ
+	|	&amp;ТаблицаЗамен КАК ТаблицаЗамен
+	|;
+	|
+	|////////////////////////////////////////////////////////////////////////////////
+	|ВЫБРАТЬ
+	|	ТаблицаСвязанныхСтрок.Объект КАК Объект,
+	|	ТаблицаСвязанныхСтрок.Количество КАК Количество,
+	|	ТаблицаСвязанныхСтрок.Расценка КАК Расценка,
+	|	ТаблицаСвязанныхСтрок.Сумма КАК Сумма,
+	|	ТаблицаСвязанныхСтрок.КодНоменклатуры КАК КодНоменклатуры,
+	|	ТаблицаСвязанныхСтрок.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
+	|	ТаблицаСвязанныхСтрок.ЧастьБЭГА КАК ЧастьБЭГА,
+	|	ТаблицаСвязанныхСтрок.КоличествоОсталосьПодобрать КАК КоличествоОсталосьПодобрать,
+	|	ТаблицаСвязанныхСтрок.ЦветаКрасок КАК ЦветаКрасок,
+	|	ТаблицаСвязанныхСтрок.ЭтоХарактеристика КАК ЭтоХарактеристика,
+	|	ТаблицаСвязанныхСтрок.КоличествоПодобрано КАК КоличествоПодобрано,
+	|	ТаблицаСвязанныхСтрок.КоличествоНаПартию КАК КоличествоНаПартию,
+	|	ТаблицаСвязанныхСтрок.СуммаНаПартию КАК СуммаНаПартию,
+	|	ТаблицаСвязанныхСтрок.ИдентификаторСтроки КАК ИдентификаторСтроки,
+	|	ТаблицаСвязанныхСтрок.КоличествоГотовых КАК КоличествоГотовых,
+	|	ТаблицаСвязанныхСтрок.ПервичнаяСтрока КАК ПервичнаяСтрока,
+	|	ТаблицаСвязанныхСтрок.ЭтоПолуфабрикат КАК ЭтоПолуфабрикат,
+	|	ТаблицаСвязанныхСтрок.ИдСтроки КАК ИдСтроки
+	|ПОМЕСТИТЬ #ТаблицаСвязанныхСтрок
+	|ИЗ
+	|	&amp;ТаблицаСвязанныхСтрок КАК ТаблицаСвязанныхСтрок
+	|;
+	|
+	|////////////////////////////////////////////////////////////////////////////////
+	|ВЫБРАТЬ
+	|	ЕСТЬNULL(ТаблицаСвязанныхСтрок.Объект, ТаблицаЗамен.Материал) КАК Объект,
+	|	ЕСТЬNULL(ТаблицаСвязанныхСтрок.Количество, ТаблицаЗамен.Расход) КАК Количество,
+	|	ЕСТЬNULL(ТаблицаСвязанныхСтрок.Расценка, ТаблицаЗамен.Расценка) КАК Расценка,
+	|	ЕСТЬNULL(ТаблицаСвязанныхСтрок.Сумма, ТаблицаЗамен.Расценка * ТаблицаЗамен.Расход) КАК Сумма,
+	|	ЕСТЬNULL(ТаблицаСвязанныхСтрок.КодНоменклатуры, ТаблицаЗамен.Материал.Артикул)  КАК КодНоменклатуры,
+	|	ЕСТЬNULL(ТаблицаСвязанныхСтрок.ЕдиницаИзмерения, ТаблицаЗамен.Материал.ЕдиницаИзмерения.Наименование) КАК ЕдиницаИзмерения,
+	|	ЕСТЬNULL(ТаблицаСвязанныхСтрок.ЭтоХарактеристика, ЛОЖЬ) КАК ЭтоХарактеристика,
+	|	ЕСТЬNULL(ТаблицаСвязанныхСтрок.КоличествоПодобрано, 0) КАК КоличествоПодобрано,
+	|	ТаблицаЗамен.КоличествоНаПартию КАК КоличествоНаПартию,
+	|	ТаблицаЗамен.КоличествоНаПартию * ТаблицаЗамен.Расход КАК СуммаНаПартию,
+	|	ТаблицаСвязанныхСтрок.ИдентификаторСтроки КАК ИдентификаторСтроки,
+	|	ТаблицаЗамен.КоличествоГотовых КАК КоличествоГотовых,
+	|	ТаблицаСвязанныхСтрок.ПервичнаяСтрока КАК ПервичнаяСтрока,
+	|	ЕСТЬNULL(ТаблицаСвязанныхСтрок.ИдСтроки, ТаблицаЗамен.ИдСтроки) КАК ИдСтроки,
+	|	ВЫБОР
+	|		КОГДА ТаблицаЗамен.ИдСтроки ЕСТЬ NULL
+	|			ТОГДА ""Удалить""
+	|		КОГДА ТаблицаСвязанныхСтрок.ИдСтроки ЕСТЬ NULL
+	|			ТОГДА ""Добавить""
+	|		ИНАЧЕ ""Изменить""
+	|	КОНЕЦ КАК ДействиеСоСтрокой
+	|ИЗ
+	|	#ТаблицаСвязанныхСтрок КАК ТаблицаСвязанныхСтрок
+	|		ПОЛНОЕ СОЕДИНЕНИЕ #ТаблицаЗамен КАК ТаблицаЗамен
+	|		ПО (ТаблицаСвязанныхСтрок.ИдентификаторСтроки = &amp;ИдентификаторИсходнойСтроки)
+	|			И ТаблицаСвязанныхСтрок.ИдСтроки = ТаблицаЗамен.ИдСтроки";
+	Запрос.УстановитьПараметр("ИдентификаторИсходнойСтроки", Результат.ИдентификаторСтроки);
+	Запрос.УстановитьПараметр("ТаблицаЗамен", ТаблицаЗамен);
+	Запрос.УстановитьПараметр("ТаблицаСвязанныхСтрок", ТаблицаСвязанныхСтрок);
 	
-	Для каждого Строка Из ТаблицаЗамен Цикл
+	Выборка = Запрос.Выполнить().Выбрать();
+	Пока Выборка.Следующий() Цикл
 		
-		Если Строка.ТипСтроки = "Исходная строка" Тогда
-			СтрокаИсходник.КоличествоГотовых  = Строка.КоличествоГотовых;
-			СтрокаИсходник.КоличествоНаПартию = Строка.КоличествоНаПартию;
-			СтрокаИсходник.Сумма 		 	  = СтрокаИсходник.Расценка*СтрокаИсходник.Количество;
-			СтрокаИсходник.СуммаНаПартию      = СтрокаИсходник.Расценка*СтрокаИсходник.КоличествоНаПартию;
+		Если Выборка.ДействиеСоСтрокой = "Изменить" Тогда
+			Для каждого Строка Из СтрокиТекущейВетки Цикл
+				Если Строка.ИдСтроки = Выборка.ИдСтроки Тогда
+					ЗаполнитьЗначенияСвойств(Строка, Выборка);
+					СкорректироватьСвязаннуюСтрокуДереваПроизводство(Выборка, ДеревоПроизводство.ПолучитьЭлементы());
+				КонецЕсли;	
+			КонецЦикла;
+		ИначеЕсли Выборка.ДействиеСоСтрокой = "Удалить" Тогда
+			Для каждого Строка Из СтрокиТекущейВетки Цикл
+				Если Строка.ИдСтроки = Выборка.ИдСтроки Тогда
+					СтрокиТекущейВетки.Удалить(Строка);
+					УдалитьСвязаннуюСтрокуДереваПроизводство(Выборка, ДеревоПроизводство.ПолучитьЭлементы());
+				КонецЕсли;	
+			КонецЦикла;
 		Иначе
-			НоваяСтрока = СтрокиТекущейВетки.Вставить(Индекс);
-			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаИсходник, "ЧастьБЭГА, ИдентификаторСтроки");
-			НоваяСтрока.Объект     		   = Строка.Материал;
-			НоваяСтрока.КодНоменклатуры    = Строка.Материал.Артикул;
-			НоваяСтрока.ЕдиницаИзмерения   = Строка.Материал.ЕдиницаИзмерения;
-			НоваяСтрока.Количество 		   = Строка.Расход;
-			НоваяСтрока.КоличествоГотовых  = Строка.КоличествоГотовых;
-			НоваяСтрока.КоличествоНаПартию = Строка.КоличествоНаПартию;
-			НоваяСтрока.Расценка		   = Строка.Расценка;
-			НоваяСтрока.Сумма 		 	   = НоваяСтрока.Расценка*НоваяСтрока.Количество;
-			НоваяСтрока.СуммаНаПартию 	   = НоваяСтрока.Расценка*НоваяСтрока.КоличествоНаПартию;
-			Индекс = Индекс + 1;
+			НоваяСтрока = СтрокиТекущейВетки.Добавить();
+			ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка);
+			НоваяСтрока.ИдентификаторСтроки = Результат.ИдентификаторСтроки;
 		КонецЕсли;	
-		
-	КонецЦикла;
 	
-	СкорректироватьДеревоПроизводство(ТаблицаЗамен);
+	КонецЦикла;
 	
 	ОбновитьЦенуНаСервере();
 	
</Patch>
								</Method>
								<Method name="РазбитьСтрокуПолуфабрикатаДеревоПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,1 +1,10 @@
 
+&amp;НаКлиенте
+Процедура РазбитьСтрокуПолуфабрикатаДеревоПроизводство(Команда)
+	
+	ДанныеСтроки = Элементы.ДеревоПроизводство.ТекущиеДанные;
+	КоличествоНаПартиюДоИзменения = ДанныеСтроки.КоличествоНаПартию;
+	
+	ПоказатьВводЧисла(Новый ОписаниеОповещения("РазбитьСтрокуДереваПроизводствоЗавершение", ЭтаФорма), ДанныеСтроки.КоличествоНаПартию, "Введите количество в новой строке",15,3);
+	
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="РаскрытьДеревоМатериалов" nameInSecondConfiguration="РаскрытьДеревоМатериалов">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РаскрытьДеревоПроизодство" nameInSecondConfiguration="РаскрытьДеревоПроизодство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РаскрытьДеревоРабот" nameInSecondConfiguration="РаскрытьДеревоРабот">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="РассчитатьЦену" nameInSecondConfiguration="РассчитатьЦену">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -2,6 +2,8 @@
 &amp;НаКлиенте
 Процедура РассчитатьЦену(Команда)
 	
+	Отказ = Ложь;
+	ПроверитьАктуальностьЦен(Отказ);
 	ОбновитьЦенуНаСервере();
 	
 КонецПроцедуры
</Patch>
								</Method>
								<Method name="СкопироватьСтрокиИсточникаВСтрокиПриемника" nameInSecondConfiguration="СкопироватьСтрокиИсточникаВСтрокиПриемника">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -1,14 +1,23 @@
 
 &amp;НаКлиенте
-Процедура СкопироватьСтрокиИсточникаВСтрокиПриемника(СтрокиИсточника, СтрокиПриемника)
+Процедура СкопироватьСтрокиИсточникаВСтрокиПриемника(СтрокиИсточника, СтрокиПриемника, КоэффициетПересчета = 0)
 
 	Для каждого Строка Из СтрокиИсточника Цикл
 		
 		НоваяСтрока = СтрокиПриемника.Добавить();
 		ЗаполнитьЗначенияСвойств(НоваяСтрока, Строка);
 		
-		СкопироватьСтрокиИсточникаВСтрокиПриемника(Строка.ПолучитьЭлементы(), НоваяСтрока.ПолучитьЭлементы());
+		Если КоэффициетПересчета &lt;&gt; 0 Тогда
+			ИсходноеКоличество = Строка.КоличествоНаПартию/КоэффициетПересчета;
+			НоваяСтрока.КоличествоНаПартию = ИсходноеКоличество-Строка.КоличествоНаПартию;
+			Если НоваяСтрока.ВидСтроки = "ДетальнаяЗапись" Тогда
+				НоваяСтрока.ИдСтроки = Новый УникальныйИдентификатор;
+				ДобавитьСтрокиДереваСлева(НоваяСтрока);
+			КонецЕсли;	
+		КонецЕсли;	
+		
+		СкопироватьСтрокиИсточникаВСтрокиПриемника(Строка.ПолучитьЭлементы(), НоваяСтрока.ПолучитьЭлементы(), КоэффициетПересчета);
 		
 	КонецЦикла;
 
-КонецПроцедуры // СкопироватьСтрокуИсточникаВСтрокуПриемника()
+КонецПроцедуры
</Patch>
								</Method>
								<Method name="СкорректироватьДеревоПроизводство" nameInSecondConfiguration="СкорректироватьДеревоПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СкорректироватьКоличествоВДеревеСлева">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СкорректироватьСвязаннуюСтрокуДереваПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьКолонкиДанныхФормы" nameInSecondConfiguration="СоздатьКолонкиДанныхФормы">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьНовуюПозициюСпецификации">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьНовуюПозициюСпецификацииДавальца">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьСпецификациюЗаменыДавальцаСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СоздатьСпецификациюЗаменыСервер">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокМатериаловЗаменыКоличествоНаПартиюПриИзменении" nameInSecondConfiguration="СписокМатериаловЗаменыКоличествоНаПартиюПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокМатериаловЗаменыКоличествоПриИзменении" nameInSecondConfiguration="СписокМатериаловЗаменыКоличествоПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокМатериаловЗаменыОбъектПриИзменении" nameInSecondConfiguration="СписокМатериаловЗаменыОбъектПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокМатериаловЗаменыПередНачаломДобавления" nameInSecondConfiguration="СписокМатериаловЗаменыПередНачаломДобавления">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокМатериаловЗаменыПередНачаломИзменения" nameInSecondConfiguration="СписокМатериаловЗаменыПередНачаломИзменения">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокМатериаловЗаменыПередОкончаниемРедактирования" nameInSecondConfiguration="СписокМатериаловЗаменыПередОкончаниемРедактирования">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокМатериаловЗаменыПередУдалением" nameInSecondConfiguration="СписокМатериаловЗаменыПередУдалением">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокМатериаловЗаменыПриИзменении" nameInSecondConfiguration="СписокМатериаловЗаменыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокМатериаловЗаменыПриНачалеРедактирования" nameInSecondConfiguration="СписокМатериаловЗаменыПриНачалеРедактирования">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокРаботЗаменыКоличествоНаПартиюПриИзменении" nameInSecondConfiguration="СписокРаботЗаменыКоличествоНаПартиюПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокРаботЗаменыКоличествоПриИзменении" nameInSecondConfiguration="СписокРаботЗаменыКоличествоПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокРаботЗаменыОбъектПриИзменении" nameInSecondConfiguration="СписокРаботЗаменыОбъектПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокРаботЗаменыПередНачаломИзменения" nameInSecondConfiguration="СписокРаботЗаменыПередНачаломИзменения">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокРаботЗаменыПередУдалением" nameInSecondConfiguration="СписокРаботЗаменыПередУдалением">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="СписокРаботЗаменыПриИзменении" nameInSecondConfiguration="СписокРаботЗаменыПриИзменении">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ТабличнаяЧастьВДеревоМатериалов" nameInSecondConfiguration="ТабличнаяЧастьВДеревоМатериалов">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -14,7 +14,8 @@
 	|	СписокМатериаловЗамены.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
 	|	СписокМатериаловЗамены.Расценка КАК Расценка,
 	|	СписокМатериаловЗамены.ЦветаКрасок КАК ЦветаКрасок,
-	|	СписокМатериаловЗамены.Сумма КАК Сумма
+	|	СписокМатериаловЗамены.Сумма КАК Сумма,
+	|	СписокМатериаловЗамены.ИдСтроки КАК ИдСтроки
 	|ПОМЕСТИТЬ #ДанныеТабличнойЧасти
 	|ИЗ
 	|	&amp;ТаблицаДокумента КАК СписокМатериаловЗамены
@@ -33,6 +34,7 @@
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.Расценка, 0) КАК Расценка,
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ЦветаКрасок, """") КАК ЦветаКрасок,
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.Сумма, 0) КАК Сумма,
+	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ИдСтроки, """") КАК ИдСтроки,
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ЧастьБЭГА.Порядок, РУБЭГ_ЧастиБЭГОВ.Порядок) КАК Сортировка
 	|ИЗ
 	|	#ДанныеТабличнойЧасти КАК ДанныеТабличнойЧасти
</Patch>
								</Method>
								<Method name="ТабличнаяЧастьВДеревоРабот" nameInSecondConfiguration="ТабличнаяЧастьВДеревоРабот">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
									<Patch>@@ -12,6 +12,7 @@
 	|	СписокРаботЗамены.КоличествоПодобрано КАК КоличествоПодобрано,
 	|	СписокРаботЗамены.Расценка КАК Расценка,
 	|	СписокРаботЗамены.ЦветаКрасок КАК ЦветаКрасок,
+	|	СписокРаботЗамены.ИдСтроки КАК ИдСтроки,
 	|	СписокРаботЗамены.Сумма КАК Сумма
 	|ПОМЕСТИТЬ #ДанныеТабличнойЧасти
 	|ИЗ
@@ -31,6 +32,7 @@
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.Расценка, 0) КАК Расценка,
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ЦветаКрасок, """") КАК ЦветаКрасок,
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.Сумма, 0) КАК Сумма,
+	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ИдСтроки, """") КАК ИдСтроки,
 	|	ЕСТЬNULL(ДанныеТабличнойЧасти.ЧастьБЭГА.Порядок, РУБЭГ_ЧастиБЭГОВ.Порядок) КАК Сортировка
 	|ИЗ
 	|	#ДанныеТабличнойЧасти КАК ДанныеТабличнойЧасти
</Patch>
								</Method>
								<Method name="УдалитьИзДереваПроизводствоСтрокуЗамен" nameInSecondConfiguration="УдалитьИзДереваПроизводствоСтрокуЗамен">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УдалитьМатериалыИРаботыВыбраннойСтрокиДерева">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УдалитьСвязаннуюСтрокуДереваПроизводство">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УдалитьСвязанныеСтрокиДереваЛево">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="УстановитьОтметкуУПодчиненныхСтрок">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
								<Method name="ЭтоОплаченныйПолуфабрикат">
									<MergeRule>GetFromSecondConfiguration</MergeRule>
								</Method>
							</Methods>
						</Module>
					</FormModule>
				</Property>
			</Properties>
		</Object>
		<Object fullName="Document.Рубэг_ПересчетТоваров.Form.ФормаДокумента">
			<Properties>
				<Property name="Form">
					<MergeRule>DoNotMerge</MergeRule>
				</Property>
			</Properties>
		</Object>
		<Object fullName="Document.Рубэг_ПересчетТоваров.TabularSection.Результат.Attribute.Излишек">
			<Properties>
				<Property name="Name">
					<MergeRule>DoNotMerge</MergeRule>
				</Property>
				<Property name="Synonym">
					<MergeRule>DoNotMerge</MergeRule>
				</Property>
			</Properties>
		</Object>
		<Object fullName="Report.Рубэг_ОстаткиРезервыПродажи">
			<Properties>
				<Property name="ObjectModule">
					<MergeRule>DoNotMerge</MergeRule>
				</Property>
			</Properties>
		</Object>
		<Object fullName="Report.Рубэг_ОстаткиРезервыПродажи.Template.ОсновнаяСхемаКомпоновкиДанных">
			<Properties>
				<Property name="Template">
					<MergeRule>DoNotMerge</MergeRule>
				</Property>
			</Properties>
		</Object>
		<Object fullName="Report.Рубэг_ПотребностьВМатериалах.Template.ОсновнаяСхемаКомпоновкиДанных">
			<Properties>
				<Property name="Template">
					<MergeRule>DoNotMerge</MergeRule>
				</Property>
			</Properties>
		</Object>
		<Object fullName="DataProcessor.Рубэг_ПотребностьМатериаловПФРасширенная">
			<Properties>
				<Property name="ManagerModule">
					<MergeRule>DoNotMerge</MergeRule>
				</Property>
			</Properties>
		</Object>
		<Object fullName="DataProcessor.Рубэг_ПотребностьМатериаловПФРасширенная.Form.Форма">
			<Properties>
				<Property name="Form">
					<MergeRule>DoNotMerge</MergeRule>
				</Property>
			</Properties>
		</Object>
		<Object fullNameInSecondConfiguration="DataProcessor.Рубэг_ПотребностьМатериаловПФРасширенная.Command.Потребности">
			<MergeRule>DoNotMerge</MergeRule>
		</Object>
		<Object fullNameInSecondConfiguration="InformationRegister.Рубэг_ВременныеДанныеДляРасчетаПотребности.Dimension.ЧастьБЭГА">
			<MergeRule>DoNotMerge</MergeRule>
		</Object>
	</Objects>
</Settings>